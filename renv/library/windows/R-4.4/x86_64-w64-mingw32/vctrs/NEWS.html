
<!DOCTYPE html>


<html lang="en" data-content_root="../../../../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>vctrs 0.6.5 &#8212; Chapter 3 Data Analysis</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'renv/library/windows/R-4.4/x86_64-w64-mingw32/vctrs/NEWS';</script>
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../../../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../../../../_static/Podocerus_bw.png" class="logo__image only-light" alt="Chapter 3 Data Analysis - Home"/>
    <img src="../../../../../../_static/Podocerus_bw.png" class="logo__image only-dark pst-js-only" alt="Chapter 3 Data Analysis - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../../../../intro.html">
                    Data Analysis of P. cristatus
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../../../scripts/Load_Packages.html">Load Packages</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../../../01_Population/01_intro.html">Question 1</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../01_Population/01_data_cleaning.html">Data Cleaning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../01_Population/Clustering.html">Cluster Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../01_Population/Population_structure.html">Population Structure Analysis</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../../../02_Occurrence/02_intro.html">Question 2</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../02_Occurrence/02_data_cleaning.html">Data Cleaning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../02_Occurrence/Model_1.html">Model 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../02_Occurrence/Model_2.html">Model 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../02_Occurrence/Model_3.html">Model 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../02_Occurrence/Model_exp.html">Substrate Experiment Model</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../../../03_Camouflage/03_intro.html">Question 3</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../03_Camouflage/03_data_cleaning.html">Data Cleaning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../03_Camouflage/Model_4.html">Model 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../03_Camouflage/Model_5.html">Model 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../03_Camouflage/Model_6.html">Model 6</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../../../04_Phylogenetic/04_intro.html">Question 4</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../04_Phylogenetic/Geneious_protocol.html">Geneious Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../04_Phylogenetic/Phylogenetic_analysis.html">Phylogenetic Analysis</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../../../../_sources/renv/library/windows/R-4.4/x86_64-w64-mingw32/vctrs/NEWS.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>vctrs 0.6.5</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">vctrs 0.6.5</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-6-4">vctrs 0.6.4</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-6-3">vctrs 0.6.3</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-6-2">vctrs 0.6.2</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-6-1">vctrs 0.6.1</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-6-0">vctrs 0.6.0</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-5-2">vctrs 0.5.2</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-5-1">vctrs 0.5.1</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-5-0">vctrs 0.5.0</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-4-2">vctrs 0.4.2</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-4-1">vctrs 0.4.1</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-4-0">vctrs 0.4.0</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-3-8">vctrs 0.3.8</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-3-7">vctrs 0.3.7</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-3-6">vctrs 0.3.6</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-3-5">vctrs 0.3.5</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-3-4">vctrs 0.3.4</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-3-3">vctrs 0.3.3</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-3-2">vctrs 0.3.2</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-3-1">vctrs 0.3.1</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cran-results">CRAN results</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-3-0">vctrs 0.3.0</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reverse-dependencies-troubleshooting">Reverse dependencies troubleshooting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#breaking-changes">Breaking changes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#type-system">Type system</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compatibility-and-fallbacks">Compatibility and fallbacks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#vector-operations">Vector operations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#classes">Classes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#indexing-and-names">Indexing and names</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conditions">Conditions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">CRAN results</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-2-4">vctrs 0.2.4</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-2-3">vctrs 0.2.3</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-2-2">vctrs 0.2.2</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-2-1">vctrs 0.2.1</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-2-0">vctrs 0.2.0</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Breaking changes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#new-features">New features</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#other-features-and-bug-fixes">Other features and bug fixes</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-6-5">
<h1>vctrs 0.6.5<a class="headerlink" href="#vctrs-0-6-5" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>Internal changes requested by CRAN around C level format strings (#1896).</p></li>
<li><p>Fixed tests related to changes to <code class="docutils literal notranslate"><span class="pre">dim&lt;-()</span></code> in R-devel (#1889).</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-6-4">
<h1>vctrs 0.6.4<a class="headerlink" href="#vctrs-0-6-4" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>Fixed a performance issue with <code class="docutils literal notranslate"><span class="pre">vec_c()</span></code> and ALTREP vectors (in particular,
the new ALTREP list vectors in R-devel) (#1884).</p></li>
<li><p>Fixed an issue with complex vector tests related to changes in R-devel
(#1883).</p></li>
<li><p>Added a class to the <code class="docutils literal notranslate"><span class="pre">vec_locate_matches()</span></code> error that is thrown when an
overflow would otherwise occur (#1845).</p></li>
<li><p>Fixed an issue with <code class="docutils literal notranslate"><span class="pre">vec_rank()</span></code> and 0-column data frames (#1863).</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-6-3">
<h1>vctrs 0.6.3<a class="headerlink" href="#vctrs-0-6-3" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>Fixed an issue where certain ALTREP row names were being materialized when
passed to <code class="docutils literal notranslate"><span class="pre">new_data_frame()</span></code>. We’ve fixed this by removing a safeguard in
<code class="docutils literal notranslate"><span class="pre">new_data_frame()</span></code> that performed a compatibility check when both <code class="docutils literal notranslate"><span class="pre">n</span></code> and
<code class="docutils literal notranslate"><span class="pre">row.names</span></code> were provided. Because this is a low level function designed for
performance, it is up to the caller to ensure these inputs are compatible
(tidyverse/dplyr#6596).</p></li>
<li><p>Fixed an issue where <code class="docutils literal notranslate"><span class="pre">vec_set_*()</span></code> used with data frames could accidentally
return an object with the type of the proxy rather than the type of the
original inputs (#1837).</p></li>
<li><p>Fixed a rare <code class="docutils literal notranslate"><span class="pre">vec_locate_matches()</span></code> bug that could occur when using a max/min
<code class="docutils literal notranslate"><span class="pre">filter</span></code> (tidyverse/dplyr#6835).</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-6-2">
<h1>vctrs 0.6.2<a class="headerlink" href="#vctrs-0-6-2" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>Fixed conditional S3 registration to avoid a CRAN check NOTE that appears in
R &gt;=4.3.0 (#1832).</p></li>
<li><p>Fixed tests to maintain compatibility with the next version of waldo (#1829).</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-6-1">
<h1>vctrs 0.6.1<a class="headerlink" href="#vctrs-0-6-1" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>Fixed a test related to <code class="docutils literal notranslate"><span class="pre">c.sfc()</span></code> changes in sf 1.0-10 (#1817).</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-6-0">
<h1>vctrs 0.6.0<a class="headerlink" href="#vctrs-0-6-0" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_run_sizes()</span></code> for computing the size of each run within a vector. It
is identical to the <code class="docutils literal notranslate"><span class="pre">times</span></code> column from <code class="docutils literal notranslate"><span class="pre">vec_unrep()</span></code>, but is faster if you
don’t need the run key (#1210).</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">sizes</span></code> argument to <code class="docutils literal notranslate"><span class="pre">vec_chop()</span></code> which allows you to partition a vector
using an integer vector describing the size of each expected slice. It is
particularly useful in combination with <code class="docutils literal notranslate"><span class="pre">vec_run_sizes()</span></code> and <code class="docutils literal notranslate"><span class="pre">list_sizes()</span></code>
(#1210, #1598).</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">obj_is_vector()</span></code>, <code class="docutils literal notranslate"><span class="pre">obj_check_vector()</span></code>, and <code class="docutils literal notranslate"><span class="pre">vec_check_size()</span></code> validation
helpers. We believe these are a better approach to vector validation than
<code class="docutils literal notranslate"><span class="pre">vec_assert()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_is()</span></code>, which have been marked as questioning because
the semantics of their <code class="docutils literal notranslate"><span class="pre">ptype</span></code> arguments are hard to define and can often be
replaced by <code class="docutils literal notranslate"><span class="pre">vec_cast()</span></code> or a type predicate function like
<code class="docutils literal notranslate"><span class="pre">rlang::is_logical()</span></code> (#1784).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_is_list()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_check_list()</span></code> have been renamed to <code class="docutils literal notranslate"><span class="pre">obj_is_list()</span></code>
and <code class="docutils literal notranslate"><span class="pre">obj_check_list()</span></code>, in line with the new <code class="docutils literal notranslate"><span class="pre">obj_is_vector()</span></code> helper. The
old functions have been silently deprecated, but an official deprecation
process will start in the next vctrs release (#1803).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_locate_matches()</span></code> gains a new <code class="docutils literal notranslate"><span class="pre">relationship</span></code> argument that holistically
handles multiple matches between <code class="docutils literal notranslate"><span class="pre">needles</span></code> and <code class="docutils literal notranslate"><span class="pre">haystack</span></code>. In particular,
<code class="docutils literal notranslate"><span class="pre">relationship</span> <span class="pre">=</span> <span class="pre">&quot;many-to-one&quot;</span></code> replaces <code class="docutils literal notranslate"><span class="pre">multiple</span> <span class="pre">=</span> <span class="pre">&quot;error&quot;</span></code> and
<code class="docutils literal notranslate"><span class="pre">multiple</span> <span class="pre">=</span> <span class="pre">&quot;warning&quot;</span></code>, which have been removed from the documentation and
silently soft-deprecated. Official deprecation for those options will start in
a future release (#1791).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_locate_matches()</span></code> has changed its default <code class="docutils literal notranslate"><span class="pre">needles_arg</span></code> and
<code class="docutils literal notranslate"><span class="pre">haystack_arg</span></code> values from <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> to <code class="docutils literal notranslate"><span class="pre">&quot;needles&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;haystack&quot;</span></code>, respectively.
This generally generates more informative error messages (#1792).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_chop()</span></code> has gained empty <code class="docutils literal notranslate"><span class="pre">...</span></code> between <code class="docutils literal notranslate"><span class="pre">x</span></code> and the optional <code class="docutils literal notranslate"><span class="pre">indices</span></code>
argument. For backwards compatibility, supplying <code class="docutils literal notranslate"><span class="pre">vec_chop(x,</span> <span class="pre">indices)</span></code>
without naming <code class="docutils literal notranslate"><span class="pre">indices</span></code> still silently works, but will be deprecated in a
future release (#1813).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_slice()</span></code> has gained an <code class="docutils literal notranslate"><span class="pre">error_call</span></code> argument (#1785).</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">numeric_version</span></code> type from base R is now better supported in equality,
comparison, and order based operations (tidyverse/dplyr#6680).</p></li>
<li><p>R &gt;=3.5.0 is now explicitly required. This is in line with the tidyverse
policy of supporting the <a class="reference external" href="https://www.tidyverse.org/blog/2019/04/r-version-support/">5 most recent versions of
R</a>.</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-5-2">
<h1>vctrs 0.5.2<a class="headerlink" href="#vctrs-0-5-2" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_expand_grid()</span></code>, which is a lower level helper that is similar to
<code class="docutils literal notranslate"><span class="pre">tidyr::expand_grid()</span></code> (#1325).</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_set_intersect()</span></code>, <code class="docutils literal notranslate"><span class="pre">vec_set_difference()</span></code>, <code class="docutils literal notranslate"><span class="pre">vec_set_union()</span></code>, and
<code class="docutils literal notranslate"><span class="pre">vec_set_symmetric_difference()</span></code> which compute set operations like
<code class="docutils literal notranslate"><span class="pre">intersect()</span></code>, <code class="docutils literal notranslate"><span class="pre">setdiff()</span></code>, and <code class="docutils literal notranslate"><span class="pre">union()</span></code>, but the vctrs variants don’t strip
attributes and work with data frames (#1755, #1765).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_identify_runs()</span></code> is now faster when used with data frames (#1684).</p></li>
<li><p>The maximum load factor of the internal dictionary was reduced from 77% to
50%, which improves performance of functions like <code class="docutils literal notranslate"><span class="pre">vec_match()</span></code>,
<code class="docutils literal notranslate"><span class="pre">vec_set_intersect()</span></code>, and <code class="docutils literal notranslate"><span class="pre">vec_unique()</span></code> in some cases (#1760).</p></li>
<li><p>Fixed a bug with the internal <code class="docutils literal notranslate"><span class="pre">vec_order_radix()</span></code> function related to matrix
columns (#1753).</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-5-1">
<h1>vctrs 0.5.1<a class="headerlink" href="#vctrs-0-5-1" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>Fix for CRAN checks.</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-5-0">
<h1>vctrs 0.5.0<a class="headerlink" href="#vctrs-0-5-0" title="Link to this heading">#</a></h1>
<ul>
<li><p>vctrs is now compliant with <code class="docutils literal notranslate"><span class="pre">-Wstrict-prototypes</span></code> as requested by CRAN
(#1729).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_ptype2()</span></code> now consistently falls back to bare data frame in
case of incompatible data frame subclasses. This is part of a
general move towards relaxed coercion rules.</p></li>
<li><p>Common type and cast errors now inherit from <code class="docutils literal notranslate"><span class="pre">&quot;vctrs_error_ptype2&quot;</span></code>
and <code class="docutils literal notranslate"><span class="pre">&quot;vctrs_error_cast&quot;</span></code> respectively. They are still both
subclasses from <code class="docutils literal notranslate"><span class="pre">&quot;vctrs_error_incompatible_type&quot;</span></code> (which used to be
their most specific class and is now a parent class).</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">list_all_size()</span></code> and <code class="docutils literal notranslate"><span class="pre">list_check_all_size()</span></code> to quickly determine if a
list contains elements of a particular <code class="docutils literal notranslate"><span class="pre">size</span></code> (#1582).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">list_unchop()</span></code> has gained empty <code class="docutils literal notranslate"><span class="pre">...</span></code> to force optional arguments to be
named (#1715).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_rep_each(times</span> <span class="pre">=</span> <span class="pre">0)</span></code> now works correctly with logical vectors that are
considered unspecified and with named vectors (#1673).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">list_of()</span></code> was relaxed to make it easier to combine. It is now
coercible with <code class="docutils literal notranslate"><span class="pre">list()</span></code> (#1161). When incompatible <code class="docutils literal notranslate"><span class="pre">list_of()</span></code> types
are combined, the result is now a bare <code class="docutils literal notranslate"><span class="pre">list()</span></code>.</p>
<p>Following this change, the role of <code class="docutils literal notranslate"><span class="pre">list_of()</span></code> is mainly to carry
type information for potential optimisations, rather than to
guarantee a certain type throughout an analysis.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">validate_list_of()</span></code> has been removed. It hasn’t proven to be practically
useful, and isn’t used by any packages on CRAN (#1697).</p></li>
<li><p>Directed calls to <code class="docutils literal notranslate"><span class="pre">vec_c()</span></code>, like <code class="docutils literal notranslate"><span class="pre">vec_c(.ptype</span> <span class="pre">=</span> <span class="pre">&lt;type&gt;)</span></code>, now mention the
position of the problematic argument when there are cast errors (#1690).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">list_unchop()</span></code> no longer drops names in some cases when <code class="docutils literal notranslate"><span class="pre">indices</span></code> were
supplied (#1689).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;unique_quiet&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;universal_quiet&quot;</span></code> are newly accepted by
<code class="docutils literal notranslate"><span class="pre">vec_as_names(repair</span> <span class="pre">=)</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_names2(repair</span> <span class="pre">=)</span></code>. These options exist to
help users who call these functions indirectly, via another function which
only exposes <code class="docutils literal notranslate"><span class="pre">repair</span></code> but not <code class="docutils literal notranslate"><span class="pre">quiet</span></code>. Specifying <code class="docutils literal notranslate"><span class="pre">repair</span> <span class="pre">=</span> <span class="pre">&quot;unique_quiet&quot;</span></code> is
like specifying <code class="docutils literal notranslate"><span class="pre">repair</span> <span class="pre">=</span> <span class="pre">&quot;unique&quot;,</span> <span class="pre">quiet</span> <span class="pre">=</span> <span class="pre">TRUE</span></code>. When the <code class="docutils literal notranslate"><span class="pre">&quot;*_quiet&quot;</span></code>
options are used, any setting of <code class="docutils literal notranslate"><span class="pre">quiet</span></code> is silently overridden (&#64;jennybc,
#1629).</p>
<p><code class="docutils literal notranslate"><span class="pre">&quot;unique_quiet&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;universal_quiet&quot;</span></code> are also newly accepted for the name
repair argument of several other functions that do not expose a <code class="docutils literal notranslate"><span class="pre">quiet</span></code>
argument: <code class="docutils literal notranslate"><span class="pre">data_frame()</span></code>, <code class="docutils literal notranslate"><span class="pre">df_list()</span></code>, <code class="docutils literal notranslate"><span class="pre">vec_c()</span></code>, <code class="docutils literal notranslate"><span class="pre">list_unchop()</span></code>,
<code class="docutils literal notranslate"><span class="pre">vec_interleave()</span></code>, <code class="docutils literal notranslate"><span class="pre">vec_rbind()</span></code>, and <code class="docutils literal notranslate"><span class="pre">vec_cbind()</span></code> (&#64;jennybc, #1716).</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">list_unchop()</span></code> has gained <code class="docutils literal notranslate"><span class="pre">error_call</span></code> and <code class="docutils literal notranslate"><span class="pre">error_arg</span></code> arguments (#1641,
#1692).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_c()</span></code> has gained <code class="docutils literal notranslate"><span class="pre">.error_call</span></code> and <code class="docutils literal notranslate"><span class="pre">.error_arg</span></code> arguments (#1641, #1692).</p></li>
<li><p>Improved the performance of list-of common type methods (#1686, #875).</p></li>
<li><p>The list-of method for <code class="docutils literal notranslate"><span class="pre">as_list_of()</span></code> now places the optional <code class="docutils literal notranslate"><span class="pre">.ptype</span></code>
argument after the <code class="docutils literal notranslate"><span class="pre">...</span></code> (#1686).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_rbind()</span></code> now applies <code class="docutils literal notranslate"><span class="pre">base::c()</span></code> fallback recursively within
packed df-cols (#1331, #1462, #1640).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_c()</span></code>, <code class="docutils literal notranslate"><span class="pre">vec_unchop()</span></code>, and <code class="docutils literal notranslate"><span class="pre">vec_rbind()</span></code> now proxy and restore
recursively (#1107). This prevents <code class="docutils literal notranslate"><span class="pre">vec_restore()</span></code> from being called
with partially filled vectors and improves performance (#1217,
#1496).</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_any_missing()</span></code> for quickly determining if a vector has any missing
values (#1672).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_equal_na()</span></code> has been renamed to <code class="docutils literal notranslate"><span class="pre">vec_detect_missing()</span></code> to align better
with vctrs naming conventions. <code class="docutils literal notranslate"><span class="pre">vec_equal_na()</span></code> will stick around for a few
minor versions, but has been formally soft-deprecated (#1672).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_c(outer</span> <span class="pre">=</span> <span class="pre">c(inner</span> <span class="pre">=</span> <span class="pre">1))</span></code> now produces correct error messages (#522).</p></li>
<li><p>If a data frame is returned as the proxy from <code class="docutils literal notranslate"><span class="pre">vec_proxy_equal()</span></code>,
<code class="docutils literal notranslate"><span class="pre">vec_proxy_compare()</span></code>, or <code class="docutils literal notranslate"><span class="pre">vec_proxy_order()</span></code>, then the corresponding proxy
function is now automatically applied recursively along all of the columns.
Additionally, packed data frame columns will be unpacked, and 1 column data
frames will be unwrapped. This ensures that the simplest possible types are
provided to the native C algorithms, improving both correctness and
performance (#1664).</p></li>
<li><p>When used with record vectors, <code class="docutils literal notranslate"><span class="pre">vec_proxy_compare()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_proxy_order()</span></code>
now call the correct proxy function while recursing over the fields (#1664).</p></li>
<li><p>The experimental function <code class="docutils literal notranslate"><span class="pre">vec_list_cast()</span></code> has been removed from
the package (#1382).</p></li>
<li><p>Native classes like dates and datetimes now accept dimensions (#1290, #1329).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_compare()</span></code> now throws a more informative error when attempting to compare
complex vectors (#1655).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_rep()</span></code> and friends gain <code class="docutils literal notranslate"><span class="pre">error_call</span></code>, <code class="docutils literal notranslate"><span class="pre">x_arg</span></code>, and <code class="docutils literal notranslate"><span class="pre">times_arg</span></code>
arguments so they can be embedded in frontends (#1303).</p></li>
<li><p>Record vectors now fail as expected when indexed along dimensions
greater than 1 (#1295).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_order()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_sort()</span></code> now have <code class="docutils literal notranslate"><span class="pre">...</span></code> between the required and
optional arguments to make them easier to extend (#1647).</p></li>
<li><p>S3 vignette was extended to show how to make the polynomial class
atomic instead of a list (#1030).</p></li>
<li><p>The experimental <code class="docutils literal notranslate"><span class="pre">n</span></code> argument of <code class="docutils literal notranslate"><span class="pre">vec_restore()</span></code> has been
removed. It was only used to inform on the size of data frames in
case a bare list is restored. It is now expected that bare lists be
initialised to data frame so that the size is carried through row
attributes. This makes the generic simpler and fixes some
performance issues (#650).</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">anyNA()</span></code> method for <code class="docutils literal notranslate"><span class="pre">vctrs_vctr</span></code> (and thus <code class="docutils literal notranslate"><span class="pre">vctrs_list_of</span></code>) now
supports the <code class="docutils literal notranslate"><span class="pre">recursive</span></code> argument (#1278).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_as_location()</span></code> and <code class="docutils literal notranslate"><span class="pre">num_as_location()</span></code> have gained a <code class="docutils literal notranslate"><span class="pre">missing</span> <span class="pre">=</span> <span class="pre">&quot;remove&quot;</span></code>
option (#1595).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_as_location()</span></code> no longer matches <code class="docutils literal notranslate"><span class="pre">NA_character_</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> indices if
those invalid names appear in <code class="docutils literal notranslate"><span class="pre">names</span></code> (#1489).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_unchop()</span></code> has been renamed to <code class="docutils literal notranslate"><span class="pre">list_unchop()</span></code> to better indicate that it
requires list input. <code class="docutils literal notranslate"><span class="pre">vec_unchop()</span></code> will stick around for a few minor
versions, but has been formally soft-deprecated (#1209).</p></li>
<li><p>Lossy cast errors during scalar subscript validation now have the
correct message (#1606).</p></li>
<li><p>Fixed confusing error message with logical <code class="docutils literal notranslate"><span class="pre">[[</span></code> subscripts (#1608).</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_rank()</span></code> to compute various types of sample ranks (#1600).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_as_location()</span></code> now throws the right error when there are out-of-bounds
negative values and <code class="docutils literal notranslate"><span class="pre">oob</span> <span class="pre">=</span> <span class="pre">&quot;extend&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">negative</span> <span class="pre">=</span> <span class="pre">&quot;ignore&quot;</span></code> are set
(#1614, #1630).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_as_location()</span></code> now works correctly when a combination of <code class="docutils literal notranslate"><span class="pre">zero</span> <span class="pre">=</span> <span class="pre">&quot;error&quot;</span></code>
and <code class="docutils literal notranslate"><span class="pre">negative</span> <span class="pre">=</span> <span class="pre">&quot;invert&quot;</span></code> are used (#1612).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data_frame()</span></code> and <code class="docutils literal notranslate"><span class="pre">df_list()</span></code> have gained <code class="docutils literal notranslate"><span class="pre">.error_call</span></code> arguments (#1610).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_locate_matches()</span></code> has gained an <code class="docutils literal notranslate"><span class="pre">error_call</span></code> argument (#1611).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;select&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;relocate&quot;</span></code> have been added as valid subscript actions to
support tidyselect and dplyr (#1596).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_as_location()</span></code> has a new <code class="docutils literal notranslate"><span class="pre">oob</span> <span class="pre">=</span> <span class="pre">&quot;remove&quot;</span></code> argument to remove
out-of-bounds locations (#1595).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_rbind()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_cbind()</span></code> now have <code class="docutils literal notranslate"><span class="pre">.error_call</span></code> arguments (#1597).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df_list()</span></code> has gained a new <code class="docutils literal notranslate"><span class="pre">.unpack</span></code> argument to optionally disable data
frame unpacking (#1616).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_check_list(arg</span> <span class="pre">=</span> <span class="pre">&quot;&quot;)</span></code> now throws the correct error (#1604).</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">difftime</span></code> to <code class="docutils literal notranslate"><span class="pre">difftime</span></code> <code class="docutils literal notranslate"><span class="pre">vec_cast()</span></code> method now standardizes the internal
storage type to double, catching potentially corrupt integer storage
<code class="docutils literal notranslate"><span class="pre">difftime</span></code> vectors (#1602).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_as_location2()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_as_subscript2()</span></code> more correctly utilize their
<code class="docutils literal notranslate"><span class="pre">call</span></code> arguments (#1605).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_count(sort</span> <span class="pre">=</span> <span class="pre">&quot;count&quot;)</span></code> now uses a stable sorting method. This ensures
that different keys with the same count are sorted in the order that they
originally appeared in (#1588).</p></li>
<li><p>Lossy cast error conditions now show the correct message when
<code class="docutils literal notranslate"><span class="pre">conditionMessage()</span></code> is called on them (#1592).</p></li>
<li><p>Fixed inconsistent reporting of conflicting inputs in
<code class="docutils literal notranslate"><span class="pre">vec_ptype_common()</span></code> (#1570).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_ptype_abbr()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_ptype_full()</span></code> now suffix 1d arrays
with <code class="docutils literal notranslate"><span class="pre">[1d]</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_ptype_abbr()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_ptype_full()</span></code> methods are no longer
inherited (#1549).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_cast()</span></code> now throws the correct error when attempting to cast a subclassed
data frame to a non-data frame type (#1568).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_locate_matches()</span></code> now uses a more conservative heuristic when taking the
joint ordering proxy. This allows it to work correctly with sf’s sfc vectors
and the classes from the bignum package (#1558).</p></li>
<li><p>An sfc method for <code class="docutils literal notranslate"><span class="pre">vec_proxy_order()</span></code> was added to better support the sf
package. These vectors are generally treated like list-columns even though
they don’t explicitly have a <code class="docutils literal notranslate"><span class="pre">&quot;list&quot;</span></code> class, and the <code class="docutils literal notranslate"><span class="pre">vec_proxy_order()</span></code>
method now forwards to the list method to reflect that (#1558).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_proxy_compare()</span></code> now works correctly for raw vectors wrapped in <code class="docutils literal notranslate"><span class="pre">I()</span></code>.
<code class="docutils literal notranslate"><span class="pre">vec_proxy_order()</span></code> now works correctly for raw and list vectors wrapped in
<code class="docutils literal notranslate"><span class="pre">I()</span></code> (#1557).</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-4-2">
<h1>vctrs 0.4.2<a class="headerlink" href="#vctrs-0-4-2" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>HTML documentation fixes for CRAN checks.</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-4-1">
<h1>vctrs 0.4.1<a class="headerlink" href="#vctrs-0-4-1" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>OOB errors with <code class="docutils literal notranslate"><span class="pre">character()</span></code> indexes use “that don’t exist” instead
of “past the end” (#1543).</p></li>
<li><p>Fixed memory protection issues related to common type
determination (#1551, tidyverse/tidyr#1348).</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-4-0">
<h1>vctrs 0.4.0<a class="headerlink" href="#vctrs-0-4-0" title="Link to this heading">#</a></h1>
<ul>
<li><p>New experimental <code class="docutils literal notranslate"><span class="pre">vec_locate_sorted_groups()</span></code> for returning the locations of
groups in sorted order. This is equivalent to, but faster than, calling
<code class="docutils literal notranslate"><span class="pre">vec_group_loc()</span></code> and then sorting by the <code class="docutils literal notranslate"><span class="pre">key</span></code> column of the result.</p></li>
<li><p>New experimental <code class="docutils literal notranslate"><span class="pre">vec_locate_matches()</span></code> for locating where each observation
in one vector matches one or more observations in another vector. It is
similar to <code class="docutils literal notranslate"><span class="pre">vec_match()</span></code>, but returns all matches by default (rather than just
the first), and can match on binary conditions other than equality. The
algorithm is inspired by data.table’s very fast binary merge procedure.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">vec_proxy_equal()</span></code>, <code class="docutils literal notranslate"><span class="pre">vec_proxy_compare()</span></code>, and <code class="docutils literal notranslate"><span class="pre">vec_proxy_order()</span></code>
methods for <code class="docutils literal notranslate"><span class="pre">vctrs_rcrd</span></code> are now applied recursively over the fields (#1503).</p></li>
<li><p>Lossy cast errors now inherit from incompatible type errors.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_is_list()</span></code> now returns <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> for <code class="docutils literal notranslate"><span class="pre">AsIs</span></code> lists (#1463).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_assert()</span></code>, <code class="docutils literal notranslate"><span class="pre">vec_ptype2()</span></code>, <code class="docutils literal notranslate"><span class="pre">vec_cast()</span></code>, and <code class="docutils literal notranslate"><span class="pre">vec_as_location()</span></code>
now use <code class="docutils literal notranslate"><span class="pre">caller_arg()</span></code> to infer a default <code class="docutils literal notranslate"><span class="pre">arg</span></code> value from the
caller.</p>
<p>This may result in unhelpful arguments being mentioned in error
messages. In general, you should consider snapshotting vctrs error
messages thrown in your package and supply <code class="docutils literal notranslate"><span class="pre">arg</span></code> and <code class="docutils literal notranslate"><span class="pre">call</span></code>
arguments if the error context is not adequately reported to your
users.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_ptype_common()</span></code>, <code class="docutils literal notranslate"><span class="pre">vec_cast_common()</span></code>, <code class="docutils literal notranslate"><span class="pre">vec_size_common()</span></code>, and
<code class="docutils literal notranslate"><span class="pre">vec_recycle_common()</span></code> gain <code class="docutils literal notranslate"><span class="pre">call</span></code> and <code class="docutils literal notranslate"><span class="pre">arg</span></code> arguments for
specifying an error context.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_compare()</span></code> can now compare zero column data frames (#1500).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">new_data_frame()</span></code> now errors on negative and missing <code class="docutils literal notranslate"><span class="pre">n</span></code> values (#1477).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_order()</span></code> now correctly orders zero column data frames (#1499).</p></li>
<li><p>vctrs now depends on cli to help with error message generation.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_check_list()</span></code> and <code class="docutils literal notranslate"><span class="pre">list_check_all_vectors()</span></code> input
checkers, and an accompanying <code class="docutils literal notranslate"><span class="pre">list_all_vectors()</span></code> predicate.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_interleave()</span></code> for combining multiple vectors together, interleaving
their elements in the process (#1396).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_equal_na(NULL)</span></code> now returns <code class="docutils literal notranslate"><span class="pre">logical(0)</span></code> rather than erroring (#1494).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_as_location(missing</span> <span class="pre">=</span> <span class="pre">&quot;error&quot;)</span></code> now fails with <code class="docutils literal notranslate"><span class="pre">NA</span></code> and <code class="docutils literal notranslate"><span class="pre">NA_character_</span></code>
in addition to <code class="docutils literal notranslate"><span class="pre">NA_integer_</span></code> (#1420, &#64;krlmlr).</p></li>
<li><p>Starting with rlang 1.0.0, errors are displayed with the contextual
function call. Several vctrs operations gain a <code class="docutils literal notranslate"><span class="pre">call</span></code> argument that
makes it possible to report the correct context in error messages.
This concerns:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vec_cast()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_ptype2()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_default_cast()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_default_ptype2()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_assert()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_as_names()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stop_</span></code> constructors like <code class="docutils literal notranslate"><span class="pre">stop_incompatible_type()</span></code></p></li>
</ul>
<p>Note that default <code class="docutils literal notranslate"><span class="pre">vec_cast()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_ptype2()</span></code> methods
automatically support this if they pass <code class="docutils literal notranslate"><span class="pre">...</span></code> to the corresponding
<code class="docutils literal notranslate"><span class="pre">vec_default_</span></code> functions. If you throw a non-internal error from a
non-default method, add a <code class="docutils literal notranslate"><span class="pre">call</span> <span class="pre">=</span> <span class="pre">caller_env()</span></code> argument in the
method and pass it to <code class="docutils literal notranslate"><span class="pre">rlang::abort()</span></code>.</p>
</li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">NA_character_</span></code> is specified as a name for <code class="docutils literal notranslate"><span class="pre">vctrs_vctr</span></code> objects, it is
now automatically repaired to <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> (#780).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> is now an allowed name for <code class="docutils literal notranslate"><span class="pre">vctrs_vctr</span></code> objects and all its
subclasses (<code class="docutils literal notranslate"><span class="pre">vctrs_list_of</span></code> in particular) (#780).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">list_of()</span></code> is now much faster when many values are provided.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_as_location()</span></code> evaluates <code class="docutils literal notranslate"><span class="pre">arg</span></code> only in case of error, for performance
(#1150, &#64;krlmlr).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">levels.vctrs_vctr()</span></code> now returns <code class="docutils literal notranslate"><span class="pre">NULL</span></code> instead of failing (#1186, &#64;krlmlr).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_assert()</span></code> produces a more informative error when <code class="docutils literal notranslate"><span class="pre">size</span></code> is invalid
(#1470).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_duplicate_detect()</span></code> is a bit faster when there are many unique values.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_proxy_order()</span></code> is described in <code class="docutils literal notranslate"><span class="pre">vignette(&quot;s3-vectors&quot;)</span></code> (#1373, &#64;krlmlr).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_chop()</span></code> now materializes ALTREP vectors before chopping, which is more
efficient than creating many small ALTREP pieces (#1450).</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">list_drop_empty()</span></code> for removing empty elements from a list (#1395).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">list_sizes()</span></code> now propagates the names of the list onto the result.</p></li>
<li><p>Name repair messages are now signaled by <code class="docutils literal notranslate"><span class="pre">rlang::names_inform_repair()</span></code>. This
means that the messages are now sent to stdout by default rather than to
stderr, resulting in prettier messages. Additionally, name repair messages can
now be silenced through the global option <code class="docutils literal notranslate"><span class="pre">rlib_name_repair_verbosity</span></code>, which
is useful for testing purposes. See <code class="docutils literal notranslate"><span class="pre">?names_inform_repair</span></code> for more
information (#1429).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vctrs_vctr</span></code> methods for <code class="docutils literal notranslate"><span class="pre">na.omit()</span></code>, <code class="docutils literal notranslate"><span class="pre">na.exclude()</span></code>, and <code class="docutils literal notranslate"><span class="pre">na.fail()</span></code> have
been added (#1413).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_init()</span></code> is now slightly faster (#1423).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_set_names()</span></code> no longer corrupts <code class="docutils literal notranslate"><span class="pre">vctrs_rcrd</span></code> types (#1419).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_detect_complete()</span></code> now computes completeness for <code class="docutils literal notranslate"><span class="pre">vctrs_rcrd</span></code> types in
the same way as data frames, which means that if any field is missing, the
entire record is considered incomplete (#1386).</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">na_value</span></code> argument of <code class="docutils literal notranslate"><span class="pre">vec_order()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_sort()</span></code> now correctly
respect missing values in lists (#1401).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_rep()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_rep_each()</span></code> are much faster for <code class="docutils literal notranslate"><span class="pre">times</span> <span class="pre">=</span> <span class="pre">0</span></code> and
<code class="docutils literal notranslate"><span class="pre">times</span> <span class="pre">=</span> <span class="pre">1</span></code> (&#64;mgirlich, #1392).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_equal_na()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_fill_missing()</span></code> now work with integer64 vectors
(#1304).</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">xtfrm()</span></code> method for vctrs_vctr objects no longer accidentally breaks
ties (#1354).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min()</span></code>, <code class="docutils literal notranslate"><span class="pre">max()</span></code> and <code class="docutils literal notranslate"><span class="pre">range()</span></code> no longer throw an error if <code class="docutils literal notranslate"><span class="pre">na.rm</span> <span class="pre">=</span> <span class="pre">TRUE</span></code> is
set and all values are <code class="docutils literal notranslate"><span class="pre">NA</span></code> (&#64;gorcha, #1357). In this case, and where an empty
input is given, it will return <code class="docutils literal notranslate"><span class="pre">Inf</span></code>/<code class="docutils literal notranslate"><span class="pre">-Inf</span></code>, or <code class="docutils literal notranslate"><span class="pre">NA</span></code> if <code class="docutils literal notranslate"><span class="pre">Inf</span></code> can’t be cast
to the input type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_group_loc()</span></code>, used for grouping in dplyr, now correctly handles
vectors with billions of elements (up to <code class="docutils literal notranslate"><span class="pre">.Machine$integer.max</span></code>) (#1133).</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-3-8">
<h1>vctrs 0.3.8<a class="headerlink" href="#vctrs-0-3-8" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>Compatibility with next version of rlang.</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-3-7">
<h1>vctrs 0.3.7<a class="headerlink" href="#vctrs-0-3-7" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vec_ptype_abbr()</span></code> gains arguments to control whether to indicate
named vectors with a prefix (<code class="docutils literal notranslate"><span class="pre">prefix_named</span></code>) and indicate shaped
vectors with a suffix (<code class="docutils literal notranslate"><span class="pre">suffix_shape</span></code>) (#781, &#64;krlmlr).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_ptype()</span></code> is now an optional <em>performance</em> generic. It is not necessary
to implement, but if your class has a static prototype, you might consider
implementing a custom <code class="docutils literal notranslate"><span class="pre">vec_ptype()</span></code> method that returns a constant to
improve performance in some cases (such as common type imputation).</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_detect_complete()</span></code>, inspired by <code class="docutils literal notranslate"><span class="pre">stats::complete.cases()</span></code>. For most
vectors, this is identical to <code class="docutils literal notranslate"><span class="pre">!vec_equal_na()</span></code>. For data frames and
matrices, this detects rows that only contain non-missing values.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_order()</span></code> can now order complex vectors (#1330).</p></li>
<li><p>Removed dependency on digest in favor of <code class="docutils literal notranslate"><span class="pre">rlang::hash()</span></code>.</p></li>
<li><p>Fixed an issue where <code class="docutils literal notranslate"><span class="pre">vctrs_rcrd</span></code> objects were not being proxied correctly
when used as a data frame column (#1318).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">register_s3()</span></code> is now licensed with the “unlicense” which makes it very
clear that it’s fine to copy and paste into your own package
(&#64;maxheld83, #1254).</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-3-6">
<h1>vctrs 0.3.6<a class="headerlink" href="#vctrs-0-3-6" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>Fixed an issue with tibble 3.0.0 where removing column names with
<code class="docutils literal notranslate"><span class="pre">names(x)</span> <span class="pre">&lt;-</span> <span class="pre">NULL</span></code> is now deprecated (#1298).</p></li>
<li><p>Fixed a GCC 11 issue revealed by CRAN checks.</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-3-5">
<h1>vctrs 0.3.5<a class="headerlink" href="#vctrs-0-3-5" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>New experimental <code class="docutils literal notranslate"><span class="pre">vec_fill_missing()</span></code> for filling in missing values with
the previous or following value. It is similar to <code class="docutils literal notranslate"><span class="pre">tidyr::fill()</span></code>, but
also works with data frames and has an additional <code class="docutils literal notranslate"><span class="pre">max_fill</span></code> argument to
limit the number of sequential missing values to fill.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_unrep()</span></code> to compress a vector with repeated values. It is very
similar to run length encoding, and works nicely alongside <code class="docutils literal notranslate"><span class="pre">vec_rep_each()</span></code>
as a way to invert the compression.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_cbind()</span></code> with only empty data frames now preserves the common size of
the inputs in the result (#1281).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_c()</span></code> now correctly returns a named result with named empty inputs
(#1263).</p></li>
<li><p>vctrs has been relicensed as MIT (#1259).</p></li>
<li><p>Functions that make comparisons within a single vector, such as
<code class="docutils literal notranslate"><span class="pre">vec_unique()</span></code>, or between two vectors, such as <code class="docutils literal notranslate"><span class="pre">vec_match()</span></code>, now
convert all character input to UTF-8 before making comparisons (#1246).</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_identify_runs()</span></code> which returns a vector of identifiers for the
elements of <code class="docutils literal notranslate"><span class="pre">x</span></code> that indicate which run of repeated values they fall in
(#1081).</p></li>
<li><p>Fixed an encoding translation bug with lists containing data frames which
have columns where <code class="docutils literal notranslate"><span class="pre">vec_size()</span></code> is different from the low level
<code class="docutils literal notranslate"><span class="pre">Rf_length()</span></code> (#1233).</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-3-4">
<h1>vctrs 0.3.4<a class="headerlink" href="#vctrs-0-3-4" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>Fixed a GCC sanitiser error revealed by CRAN checks.</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-3-3">
<h1>vctrs 0.3.3<a class="headerlink" href="#vctrs-0-3-3" title="Link to this heading">#</a></h1>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">table</span></code> class is now implemented as a wrapper type that
delegates its coercion methods. It used to be restricted to integer
tables (#1190).</p></li>
<li><p>Named one-dimensional arrays now behave consistently with simple
vectors in <code class="docutils literal notranslate"><span class="pre">vec_names()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_rbind()</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">new_rcrd()</span></code> now uses <code class="docutils literal notranslate"><span class="pre">df_list()</span></code> to validate the fields. This makes
it more flexible as the fields can now be of any type supported by
vctrs, including data frames.</p></li>
<li><p>Thanks to the previous change the <code class="docutils literal notranslate"><span class="pre">[[</span></code> method of records now
preserves list fields (#1205).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_data()</span></code> now preserves data frames. This is consistent with the
notion that data frames are a primitive vector type in vctrs. This
shouldn’t affect code that uses <code class="docutils literal notranslate"><span class="pre">[[</span></code> and <code class="docutils literal notranslate"><span class="pre">length()</span></code> to manipulate
the data. On the other hand, the vctrs primitives like <code class="docutils literal notranslate"><span class="pre">vec_slice()</span></code>
will now operate rowwise when <code class="docutils literal notranslate"><span class="pre">vec_data()</span></code> returns a data frame.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outer</span></code> is now passed unrecycled to name specifications. Instead,
the return value is recycled (#1099).</p></li>
<li><p>Name specifications can now return <code class="docutils literal notranslate"><span class="pre">NULL</span></code>. The names vector will
only be allocated if the spec function returns non-<code class="docutils literal notranslate"><span class="pre">NULL</span></code> during the
concatenation. This makes it possible to ignore outer names without
having to create an empty names vector when there are no inner
names:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">zap_outer_spec</span> <span class="o">&lt;-</span> <span class="n">function</span><span class="p">(</span><span class="n">outer</span><span class="p">,</span> <span class="n">inner</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">is_character</span><span class="p">(</span><span class="n">inner</span><span class="p">))</span> <span class="n">inner</span>

<span class="c1"># `NULL` names rather than a vector of &quot;&quot;</span>
<span class="n">names</span><span class="p">(</span><span class="n">vec_c</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="o">.</span><span class="n">name_spec</span> <span class="o">=</span> <span class="n">zap_outer_spec</span><span class="p">))</span>
<span class="c1">#&gt; NULL</span>

<span class="c1"># Names are allocated when inner names exist</span>
<span class="n">names</span><span class="p">(</span><span class="n">vec_c</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="p">(</span><span class="n">b</span> <span class="o">=</span> <span class="mi">3</span><span class="n">L</span><span class="p">),</span> <span class="o">.</span><span class="n">name_spec</span> <span class="o">=</span> <span class="n">zap_outer_spec</span><span class="p">))</span>
<span class="c1">#&gt; [1] &quot;&quot;  &quot;&quot;  &quot;b&quot;</span>
</pre></div>
</div>
</li>
<li><p>Fixed several performance issues in <code class="docutils literal notranslate"><span class="pre">vec_c()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_unchop()</span></code>
with named vectors.</p></li>
<li><p>The restriction that S3 lists must have a list-based proxy to be considered
lists by <code class="docutils literal notranslate"><span class="pre">vec_is_list()</span></code> has been removed (#1208).</p></li>
<li><p>New performant <code class="docutils literal notranslate"><span class="pre">data_frame()</span></code> constructor for creating data frames in a way
that follows tidyverse semantics. Among other things, inputs are recycled
using tidyverse recycling rules, strings are never converted to factors,
list-columns are easier to create, and unnamed data frame input is
automatically spliced.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">df_list()</span></code> for safely and consistently constructing the data structure
underlying a data frame, a named list of equal-length vectors. It is useful
in combination with <code class="docutils literal notranslate"><span class="pre">new_data_frame()</span></code> for creating user-friendly
constructors for data frame subclasses that use the tidyverse rules for
recycling and determining types.</p></li>
<li><p>Fixed performance issue with <code class="docutils literal notranslate"><span class="pre">vec_order()</span></code> on classed vectors which
affected <code class="docutils literal notranslate"><span class="pre">dplyr::group_by()</span></code> (tidyverse/dplyr#5423).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_set_names()</span></code> no longer alters the input in-place (#1194).</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_proxy_order()</span></code> that provides an ordering proxy for use in
<code class="docutils literal notranslate"><span class="pre">vec_order()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_sort()</span></code>. The default method falls through to
<code class="docutils literal notranslate"><span class="pre">vec_proxy_compare()</span></code>. Lists are special cased, and return an integer
vector proxy that orders by first appearance.</p></li>
<li><p>List columns in data frames are no longer comparable through <code class="docutils literal notranslate"><span class="pre">vec_compare()</span></code>.</p></li>
<li><p>The experimental <code class="docutils literal notranslate"><span class="pre">relax</span></code> argument has been removed from
<code class="docutils literal notranslate"><span class="pre">vec_proxy_compare()</span></code>.</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-3-2">
<h1>vctrs 0.3.2<a class="headerlink" href="#vctrs-0-3-2" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>Fixed a performance issue in <code class="docutils literal notranslate"><span class="pre">bind_rows()</span></code> with S3 columns (#1122,
#1124, #1151, tidyverse/dplyr#5327).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_slice()</span></code> now checks sizes of data frame columns in case the
data structure is corrupt (#552).</p></li>
<li><p>The native routines in vctrs now dispatch and evaluate in the vctrs
namespace. This improves the continuity of evaluation in backtraces.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">new_data_frame()</span></code> is now twice as fast when <code class="docutils literal notranslate"><span class="pre">class</span></code> is supplied.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_names2()</span></code>, <code class="docutils literal notranslate"><span class="pre">vec_names()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_set_names()</span></code> (#1173).</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-3-1">
<h1>vctrs 0.3.1<a class="headerlink" href="#vctrs-0-3-1" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vec_slice()</span></code> no longer restores attributes of foreign objects for
which a <code class="docutils literal notranslate"><span class="pre">[</span></code> method exist. This fixes an issue with <code class="docutils literal notranslate"><span class="pre">ts</span></code> objects
which were previously incorrectly restored.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">as.list()</span></code> method for <code class="docutils literal notranslate"><span class="pre">vctrs_rcrd</span></code> objects has been removed in favor
of directly using the method for <code class="docutils literal notranslate"><span class="pre">vctrs_vctr</span></code>, which calls <code class="docutils literal notranslate"><span class="pre">vec_chop()</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_c()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_rbind()</span></code> now fall back to <code class="docutils literal notranslate"><span class="pre">base::c()</span></code> if the
inputs have a common class hierarchy for which a <code class="docutils literal notranslate"><span class="pre">c()</span></code> method is
implemented but no self-to-self <code class="docutils literal notranslate"><span class="pre">vec_ptype2()</span></code> method is
implemented.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_rbind()</span></code> now internally calls <code class="docutils literal notranslate"><span class="pre">vec_proxy()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_restore()</span></code> on
the data frame common type that is used to create the output (#1109).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_as_location2(&quot;0&quot;)</span></code> now works correctly (#1131).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">?reference-faq-compatibility</span></code> is a new reference guide on vctrs
primitives. It includes an overview of the fallbacks to base R
generics implemented in vctrs for compatibility with existing
classes.</p></li>
<li><p>The documentation of vctrs functions now includes a Dependencies
section to reference which other vctrs operations are called from
that function. By following the dependencies links recursively, you
will find the vctrs primitives on which an operation relies.</p></li>
</ul>
<section id="cran-results">
<h2>CRAN results<a class="headerlink" href="#cran-results" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Fixed type declaration mismatches revealed by LTO build.</p></li>
<li><p>Fixed r-devel issue with new <code class="docutils literal notranslate"><span class="pre">c.factor()</span></code> method.</p></li>
</ul>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-3-0">
<h1>vctrs 0.3.0<a class="headerlink" href="#vctrs-0-3-0" title="Link to this heading">#</a></h1>
<p>This version features an overhaul of the coercion system to make it
more consistent and easier to implement. See the <em>Breaking changes</em>
and <em>Type system</em> sections for details.</p>
<p>There are three new documentation topics if you’d like to learn how to
implement coercion methods to make your class compatible with
tidyverse packages like dplyr:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://vctrs.r-lib.org/reference/theory-faq-coercion.html">https://vctrs.r-lib.org/reference/theory-faq-coercion.html</a> for an
overview of the coercion mechanism in vctrs.</p></li>
<li><p><a class="reference external" href="https://vctrs.r-lib.org/reference/howto-faq-coercion.html">https://vctrs.r-lib.org/reference/howto-faq-coercion.html</a> for a
practical guide about implementing methods for vectors.</p></li>
<li><p><a class="reference external" href="https://vctrs.r-lib.org/reference/howto-faq-coercion-data-frame.html">https://vctrs.r-lib.org/reference/howto-faq-coercion-data-frame.html</a>
for a practical guide about implementing methods for data frames.</p></li>
</ul>
<section id="reverse-dependencies-troubleshooting">
<h2>Reverse dependencies troubleshooting<a class="headerlink" href="#reverse-dependencies-troubleshooting" title="Link to this heading">#</a></h2>
<p>The following errors are caused by breaking changes.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;Can't</span> <span class="pre">convert</span> <span class="pre">&lt;character&gt;</span> <span class="pre">to</span> <span class="pre">&lt;list&gt;.&quot;</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">vec_cast()</span></code> no longer converts to list. Use <code class="docutils literal notranslate"><span class="pre">vec_chop()</span></code> or
<code class="docutils literal notranslate"><span class="pre">as.list()</span></code> instead.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;Can't</span> <span class="pre">convert</span> <span class="pre">&lt;integer&gt;</span> <span class="pre">to</span> <span class="pre">&lt;character&gt;.&quot;</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">vec_cast()</span></code> no longer converts to character. Use <code class="docutils literal notranslate"><span class="pre">as.character()</span></code>to
deparse objects.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;names</span> <span class="pre">for</span> <span class="pre">target</span> <span class="pre">but</span> <span class="pre">not</span> <span class="pre">for</span> <span class="pre">current&quot;</span></code></p>
<p>Names of list-columns are now preserved by <code class="docutils literal notranslate"><span class="pre">vec_rbind()</span></code>. Adjust
tests accordingly.</p>
</li>
</ul>
</section>
<section id="breaking-changes">
<h2>Breaking changes<a class="headerlink" href="#breaking-changes" title="Link to this heading">#</a></h2>
<ul>
<li><p>Double-dispatch methods for <code class="docutils literal notranslate"><span class="pre">vec_ptype2()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_cast()</span></code> are no
longer inherited (#710). Class implementers must implement one set
of methods for each compatible class.</p>
<p>For example, a tibble subclass no longer inherits from the
<code class="docutils literal notranslate"><span class="pre">vec_ptype2()</span></code> methods between <code class="docutils literal notranslate"><span class="pre">tbl_df</span></code> and <code class="docutils literal notranslate"><span class="pre">data.frame</span></code>. This means
that you explicitly need to implement <code class="docutils literal notranslate"><span class="pre">vec_ptype2()</span></code> methods with
<code class="docutils literal notranslate"><span class="pre">tbl_df</span></code> and <code class="docutils literal notranslate"><span class="pre">data.frame</span></code>.</p>
<p>This change requires a bit more work from class maintainers but is
safer because the coercion hierarchies are generally different from
class hierarchies. See the S3 dispatch section of <code class="docutils literal notranslate"><span class="pre">?vec_ptype2</span></code> for
more information.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_cast()</span></code> is now restricted to the same conversions as
<code class="docutils literal notranslate"><span class="pre">vec_ptype2()</span></code> methods (#606, #741). This change is motivated by
safety and performance:</p>
<ul class="simple">
<li><p>It is generally sloppy to generically convert arbitrary inputs to
one type. Restricted coercions are more predictable and allow your
code to fail earlier when there is a type issue.</p></li>
<li><p>When unrestricted conversions are useful, this is generally
towards a known type. For example, <code class="docutils literal notranslate"><span class="pre">glue::glue()</span></code> needs to convert
arbitrary inputs to the known character type. In this case, using
double dispatch instead of a single dispatch generic like
<code class="docutils literal notranslate"><span class="pre">as.character()</span></code> is wasteful.</p></li>
<li><p>To implement the useful semantics of coercible casts (already used
in <code class="docutils literal notranslate"><span class="pre">vec_assign()</span></code>), two double dispatch were needed. Now it can be
done with one double dispatch by calling <code class="docutils literal notranslate"><span class="pre">vec_cast()</span></code> directly.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">stop_incompatible_cast()</span></code> now throws an error of class
<code class="docutils literal notranslate"><span class="pre">vctrs_error_incompatible_type</span></code> rather than <code class="docutils literal notranslate"><span class="pre">vctrs_error_incompatible_cast</span></code>.
This means that <code class="docutils literal notranslate"><span class="pre">vec_cast()</span></code> also throws errors of this class, which better
aligns it with <code class="docutils literal notranslate"><span class="pre">vec_ptype2()</span></code> now that they are restricted to the same
conversions.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">y</span></code> argument of <code class="docutils literal notranslate"><span class="pre">stop_incompatible_cast()</span></code> has been renamed to <code class="docutils literal notranslate"><span class="pre">to</span></code> to
better match <code class="docutils literal notranslate"><span class="pre">to_arg</span></code>.</p></li>
</ul>
</section>
<section id="type-system">
<h2>Type system<a class="headerlink" href="#type-system" title="Link to this heading">#</a></h2>
<ul>
<li><p>Double-dispatch methods for <code class="docutils literal notranslate"><span class="pre">vec_ptype2()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_cast()</span></code> are now
easier to implement. They no longer need any the boiler plate.
Implementing a method for classes <code class="docutils literal notranslate"><span class="pre">foo</span></code> and <code class="docutils literal notranslate"><span class="pre">bar</span></code> is now as simple as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#&#39; @export</span>
<span class="n">vec_ptype2</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">bar</span> <span class="o">&lt;-</span> <span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span> <span class="n">new_foo</span><span class="p">()</span>
</pre></div>
</div>
<p>vctrs also takes care of implementing the default and unspecified
methods. If you have implemented these methods, they are no longer
called and can now be removed.</p>
<p>One consequence of the new dispatch mechanism is that <code class="docutils literal notranslate"><span class="pre">NextMethod()</span></code>
is now completely unsupported. This is for the best as it never
worked correctly in a double-dispatch setting. Parent methods must
now be called manually.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_ptype2()</span></code> methods now get zero-size prototypes as inputs. This
guarantees that methods do not peek at the data to determine the
richer type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_is_list()</span></code> no longer allows S3 lists that implement a <code class="docutils literal notranslate"><span class="pre">vec_proxy()</span></code>
method to automatically be considered lists. A S3 list must explicitly
inherit from <code class="docutils literal notranslate"><span class="pre">&quot;list&quot;</span></code> in the base class to be considered a list.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_restore()</span></code> no longer restores row names if the target is not a
data frame. This fixes an issue where <code class="docutils literal notranslate"><span class="pre">POSIXlt</span></code> objects would carry
a <code class="docutils literal notranslate"><span class="pre">row.names</span></code> attribute after a proxy/restore roundtrip.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_cast()</span></code> to and from data frames preserves the row names of
inputs.</p></li>
<li><p>The internal function <code class="docutils literal notranslate"><span class="pre">vec_names()</span></code> now returns row names if the
input is a data frame. Similarly, <code class="docutils literal notranslate"><span class="pre">vec_set_names()</span></code> sets row names
on data frames. This is part of a general effort at making row names
the vector names of data frames in vctrs.</p>
<p>If necessary, the row names are repaired verbosely but without error
to make them unique. This should be a mostly harmless change for
users, but it could break unit tests in packages if they make
assumptions about the row names.</p>
</li>
</ul>
</section>
<section id="compatibility-and-fallbacks">
<h2>Compatibility and fallbacks<a class="headerlink" href="#compatibility-and-fallbacks" title="Link to this heading">#</a></h2>
<ul>
<li><p>With the double dispatch changes, the coercion methods are no longer
inherited from parent classes. This is because the coercion
hierarchy is in principle different from the S3 hierarchy. A
consequence of this change is that subclasses that don’t implement
coercion methods are now in principle incompatible.</p>
<p>This is particularly problematic with subclasses of data frames for
which throwing incompatible errors would be too incovenient for
users. To work around this, we have implemented a fallback to the
relevant base data frame class (either <code class="docutils literal notranslate"><span class="pre">data.frame</span></code> or <code class="docutils literal notranslate"><span class="pre">tbl_df</span></code>) in
coercion methods (#981). This fallback is silent unless you set the
<code class="docutils literal notranslate"><span class="pre">vctrs:::warn_on_fallback</span></code> option to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>.</p>
<p>In the future we may extend this fallback principle to other base
types when they are explicitly included in the class vector (such as
<code class="docutils literal notranslate"><span class="pre">&quot;list&quot;</span></code>).</p>
</li>
<li><p>Improved support for foreign classes in the combining operations
<code class="docutils literal notranslate"><span class="pre">vec_c()</span></code>, <code class="docutils literal notranslate"><span class="pre">vec_rbind()</span></code>, and <code class="docutils literal notranslate"><span class="pre">vec_unchop()</span></code>. A foreign class is a
class that doesn’t implement <code class="docutils literal notranslate"><span class="pre">vec_ptype2()</span></code>. When all the objects to
combine have the same foreign class, one of these fallbacks is invoked:</p>
<ul class="simple">
<li><p>If the class implements a <code class="docutils literal notranslate"><span class="pre">base::c()</span></code> method, the method is used
for the combination. (FIXME: <code class="docutils literal notranslate"><span class="pre">vec_rbind()</span></code> currently doesn’t use
this fallback.)</p></li>
<li><p>Otherwise if the objects have identical attributes and the same
base type, we consider them to be compatible. The vectors are
concatenated and the attributes are restored (#776).</p></li>
</ul>
<p>These fallbacks do not make your class completely compatible with
vctrs-powered packages, but they should help in many simple cases.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_c()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_unchop()</span></code> now fall back to <code class="docutils literal notranslate"><span class="pre">base::c()</span></code> for S4 objects if
the object doesn’t implement <code class="docutils literal notranslate"><span class="pre">vec_ptype2()</span></code> but sets an S4 <code class="docutils literal notranslate"><span class="pre">c()</span></code>
method (#919).</p></li>
</ul>
</section>
<section id="vector-operations">
<h2>Vector operations<a class="headerlink" href="#vector-operations" title="Link to this heading">#</a></h2>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_rbind()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_c()</span></code> with data frame inputs now consistently
preserve the names of list-columns, df-columns, and matrix-columns
(#689). This can cause some false positives in unit tests, if they
are sensitive to internal names (#1007).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_rbind()</span></code> now repairs row names silently to avoid confusing
messages when the row names are not informative and were not created
on purpose.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_rbind()</span></code> gains option to treat input names as row names. This
is disabled by default (#966).</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_rep()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_rep_each()</span></code> for repeating an entire vector
and elements of a vector, respectively. These two functions provide
a clearer interface for the functionality of <code class="docutils literal notranslate"><span class="pre">vec_repeat()</span></code>, which
is now deprecated.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_cbind()</span></code> now calls <code class="docutils literal notranslate"><span class="pre">vec_restore()</span></code> on inputs emptied of their
columns before computing the common type. This has
consequences for data frame classes with special columns that
devolve into simpler classes when the columns are subsetted
out. These classes are now always simplified by <code class="docutils literal notranslate"><span class="pre">vec_cbind()</span></code>.</p>
<p>For instance, column-binding a grouped data frame with a data frame
now produces a tibble (the simplified class of a grouped data
frame).</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_match()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_in()</span></code> gain parameters for argument tags (#944).</p></li>
<li><p>The internal version of <code class="docutils literal notranslate"><span class="pre">vec_assign()</span></code> now has support for assigning
names and inner names. For data frames, the names are assigned
recursively.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_assign()</span></code> gains <code class="docutils literal notranslate"><span class="pre">x_arg</span></code> and <code class="docutils literal notranslate"><span class="pre">value_arg</span></code> parameters (#918).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_group_loc()</span></code>, which powers <code class="docutils literal notranslate"><span class="pre">dplyr::group_by()</span></code>, now has more
efficient vector access (#911).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_ptype()</span></code> gained an <code class="docutils literal notranslate"><span class="pre">x_arg</span></code> argument.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">list_sizes()</span></code> for computing the size of every element in a list.
<code class="docutils literal notranslate"><span class="pre">list_sizes()</span></code> is to <code class="docutils literal notranslate"><span class="pre">vec_size()</span></code> as <code class="docutils literal notranslate"><span class="pre">lengths()</span></code> is to <code class="docutils literal notranslate"><span class="pre">length()</span></code>, except
that it only supports lists. Atomic vectors and data frames result in an
error.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">new_data_frame()</span></code> infers size from row names when <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">=</span> <span class="pre">NULL</span></code> (#894).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_c()</span></code> now accepts <code class="docutils literal notranslate"><span class="pre">rlang::zap()</span></code> as <code class="docutils literal notranslate"><span class="pre">.name_spec</span></code> input. The
returned vector is then always unnamed, and the names do not cause
errors when they can’t be combined. They are still used to create
more informative messages when the inputs have incompatible types (#232).</p></li>
</ul>
</section>
<section id="classes">
<h2>Classes<a class="headerlink" href="#classes" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>vctrs now supports the <code class="docutils literal notranslate"><span class="pre">data.table</span></code> class. The common type of a data
frame and a data table is a data table.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">new_vctr()</span></code> now always appends a base <code class="docutils literal notranslate"><span class="pre">&quot;list&quot;</span></code> class to list <code class="docutils literal notranslate"><span class="pre">.data</span></code> to
be compatible with changes to <code class="docutils literal notranslate"><span class="pre">vec_is_list()</span></code>. This affects <code class="docutils literal notranslate"><span class="pre">new_list_of()</span></code>,
which now returns an object with a base class of <code class="docutils literal notranslate"><span class="pre">&quot;list&quot;</span></code>.</p></li>
<li><p>dplyr methods are now implemented for <code class="docutils literal notranslate"><span class="pre">vec_restore()</span></code>,
<code class="docutils literal notranslate"><span class="pre">vec_ptype2()</span></code>, and <code class="docutils literal notranslate"><span class="pre">vec_cast()</span></code>. The user-visible consequence (and
breaking change) is that row-binding a grouped data frame and a data
frame or tibble now returns a grouped data frame. It would
previously return a tibble.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">is.na&lt;-()</span></code> method for <code class="docutils literal notranslate"><span class="pre">vctrs_vctr</span></code> now supports numeric and
character subscripts to indicate where to insert missing values (#947).</p></li>
<li><p>Improved support for vector-like S4 objects (#550, #551).</p></li>
<li><p>The base classes <code class="docutils literal notranslate"><span class="pre">AsIs</span></code> and <code class="docutils literal notranslate"><span class="pre">table</span></code> have vctrs methods (#904, #906).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">POSIXlt</span></code> and <code class="docutils literal notranslate"><span class="pre">POSIXct</span></code> vectors are handled more consistently (#901).</p></li>
<li><p>Ordered factors that do not have identical levels are now incompatible.
They are now incompatible with all factors.</p></li>
</ul>
</section>
<section id="indexing-and-names">
<h2>Indexing and names<a class="headerlink" href="#indexing-and-names" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vec_as_subscript()</span></code> now fails when the subscript is a matrix or an
array, consistently with <code class="docutils literal notranslate"><span class="pre">vec_as_location()</span></code>.</p></li>
<li><p>Improved error messages in <code class="docutils literal notranslate"><span class="pre">vec_as_location()</span></code> when subscript is a
matrix or array (#936).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_as_location2()</span></code> properly picks up <code class="docutils literal notranslate"><span class="pre">subscript_arg</span></code>
(tidyverse/tibble#735).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_as_names()</span></code> now has more informative error messages when names
are not unique (#882).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_as_names()</span></code> gains a <code class="docutils literal notranslate"><span class="pre">repair_arg</span></code> argument that when set will cause
<code class="docutils literal notranslate"><span class="pre">repair</span> <span class="pre">=</span> <span class="pre">&quot;check_unique&quot;</span></code> to generate an informative hint (#692).</p></li>
</ul>
</section>
<section id="conditions">
<h2>Conditions<a class="headerlink" href="#conditions" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">stop_incompatible_type()</span></code> now has an <code class="docutils literal notranslate"><span class="pre">action</span></code> argument for customizing
whether the coercion error came from <code class="docutils literal notranslate"><span class="pre">vec_ptype2()</span></code> or <code class="docutils literal notranslate"><span class="pre">vec_cast()</span></code>.
<code class="docutils literal notranslate"><span class="pre">stop_incompatible_cast()</span></code> is now a thin wrapper around
<code class="docutils literal notranslate"><span class="pre">stop_incompatible_type(action</span> <span class="pre">=</span> <span class="pre">&quot;convert&quot;)</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stop_</span></code> functions now take <code class="docutils literal notranslate"><span class="pre">details</span></code> after the dots. This argument
can no longer be passed by position.</p></li>
<li><p>Supplying both <code class="docutils literal notranslate"><span class="pre">details</span></code> and <code class="docutils literal notranslate"><span class="pre">message</span></code> to the <code class="docutils literal notranslate"><span class="pre">stop_</span></code> functions is
now an internal error.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x_arg</span></code>, <code class="docutils literal notranslate"><span class="pre">y_arg</span></code>, and <code class="docutils literal notranslate"><span class="pre">to_arg</span></code> are now compulsory arguments in
<code class="docutils literal notranslate"><span class="pre">stop_</span></code> functions like <code class="docutils literal notranslate"><span class="pre">stop_incompatible_type()</span></code>.</p></li>
<li><p>Lossy cast errors are now considered internal. Please don’t test for
the class or explicitly handle them.</p></li>
<li><p>New argument <code class="docutils literal notranslate"><span class="pre">loss_type</span></code> for the experimental function
<code class="docutils literal notranslate"><span class="pre">maybe_lossy_cast()</span></code>. It can take the values “precision” or
“generality” to indicate in the error message which kind of loss is
the error about (double to integer loses precision, character to
factor loses generality).</p></li>
<li><p>Coercion and recycling errors are now more consistent.</p></li>
</ul>
</section>
<section id="id1">
<h2>CRAN results<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Fixed clang-UBSAN error “nan is outside the range of representable
values of type ‘int’” (#902).</p></li>
<li><p>Fixed compilation of stability vignette following the date
conversion changes on R-devel.</p></li>
</ul>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-2-4">
<h1>vctrs 0.2.4<a class="headerlink" href="#vctrs-0-2-4" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>Factors and dates methods are now implemented in C for efficiency.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">new_data_frame()</span></code> now correctly updates attributes and supports merging
of the <code class="docutils literal notranslate"><span class="pre">&quot;names&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;row.names&quot;</span></code> arguments (#883).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_match()</span></code> gains an <code class="docutils literal notranslate"><span class="pre">na_equal</span></code> argument (#718).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_chop()</span></code>’s <code class="docutils literal notranslate"><span class="pre">indices</span></code> argument has been restricted to positive integer
vectors. Character and logical subscripts haven’t proven useful, and this
aligns <code class="docutils literal notranslate"><span class="pre">vec_chop()</span></code> with <code class="docutils literal notranslate"><span class="pre">vec_unchop()</span></code>, for which only positive integer
vectors make sense.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_unchop()</span></code> for combining a list of vectors into a single vector. It
is similar to <code class="docutils literal notranslate"><span class="pre">vec_c()</span></code>, but gives greater control over how the elements
are placed in the output through the use of a secondary <code class="docutils literal notranslate"><span class="pre">indices</span></code> argument.</p></li>
<li><p>Breaking change: When <code class="docutils literal notranslate"><span class="pre">.id</span></code> is supplied, <code class="docutils literal notranslate"><span class="pre">vec_rbind()</span></code> now creates
the identifier column at the start of the data frame rather than at
the end.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">numeric_version</span></code> and <code class="docutils literal notranslate"><span class="pre">package_version</span></code> lists are now treated as
vectors (#723).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_slice()</span></code> now properly handles symbols and S3 subscripts.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_as_location()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_as_subscript()</span></code> are now fully
implemented in C for efficiency.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_as_location()</span></code> gains a new argument, <code class="docutils literal notranslate"><span class="pre">zero</span></code>, for controlling whether
to <code class="docutils literal notranslate"><span class="pre">&quot;remove&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;ignore&quot;</span></code>, or <code class="docutils literal notranslate"><span class="pre">&quot;error&quot;</span></code> on zero values (#852).</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-2-3">
<h1>vctrs 0.2.3<a class="headerlink" href="#vctrs-0-2-3" title="Link to this heading">#</a></h1>
<ul>
<li><p>The main feature of this release is considerable performance
improvements with factors and dates.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_c()</span></code> now falls back to <code class="docutils literal notranslate"><span class="pre">base::c()</span></code> if the vector doesn’t
implement <code class="docutils literal notranslate"><span class="pre">vec_ptype2()</span></code> but implements <code class="docutils literal notranslate"><span class="pre">c()</span></code>. This should improve
the compatibility of vctrs-based functions with foreign classes
(#801).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">new_data_frame()</span></code> is now faster.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_is_list()</span></code> for detecting if a vector is a list in the vctrs sense.
For instance, objects of class <code class="docutils literal notranslate"><span class="pre">lm</span></code> are not lists. In general, classes need
to explicitly inherit from <code class="docutils literal notranslate"><span class="pre">&quot;list&quot;</span></code> to be considered as lists by vctrs.</p></li>
<li><p>Unspecified vectors of <code class="docutils literal notranslate"><span class="pre">NA</span></code> can now be assigned into a list (#819).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="nb">list</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">vec_slice</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">NA</span>
<span class="n">x</span>
<span class="c1">#&gt; [[1]]</span>
<span class="c1">#&gt; NULL</span>
<span class="c1">#&gt;</span>
<span class="c1">#&gt; [[2]]</span>
<span class="c1">#&gt; 2</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_ptype()</span></code> now errors on scalar inputs (#807).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_ptype_finalise()</span></code> is now recursive over all data frame types, ensuring
that unspecified columns are correctly finalised to logical (#800).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_ptype()</span></code> now correctly handles unspecified columns in data frames, and
will always return an unspecified column type (#800).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_slice()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_chop()</span></code> now work correctly with <code class="docutils literal notranslate"><span class="pre">bit64::integer64()</span></code>
objects when an <code class="docutils literal notranslate"><span class="pre">NA</span></code> subscript is supplied. By extension, this means that
<code class="docutils literal notranslate"><span class="pre">vec_init()</span></code> now works with these objects as well (#813).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_rbind()</span></code> now binds row names. When named inputs are supplied
and <code class="docutils literal notranslate"><span class="pre">names_to</span></code> is <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, the names define row names. If <code class="docutils literal notranslate"><span class="pre">names_to</span></code>
is supplied, they are assigned in the column name as before.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_cbind()</span></code> now uses the row names of the first named input.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">c()</span></code> method for <code class="docutils literal notranslate"><span class="pre">vctrs_vctr</span></code> now throws an error when
<code class="docutils literal notranslate"><span class="pre">recursive</span></code> or <code class="docutils literal notranslate"><span class="pre">use.names</span></code> is supplied (#791).</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-2-2">
<h1>vctrs 0.2.2<a class="headerlink" href="#vctrs-0-2-2" title="Link to this heading">#</a></h1>
<ul>
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_as_subscript()</span></code> function to cast inputs to the base type
of a subscript (logical, numeric, or character). <code class="docutils literal notranslate"><span class="pre">vec_as_index()</span></code>
has been renamed to <code class="docutils literal notranslate"><span class="pre">vec_as_location()</span></code>. Use <code class="docutils literal notranslate"><span class="pre">num_as_location()</span></code> if
you need more options to control how numeric subscripts are
converted to a vector of locations.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_as_subscript2()</span></code>, <code class="docutils literal notranslate"><span class="pre">vec_as_location2()</span></code>, and
<code class="docutils literal notranslate"><span class="pre">num_as_location2()</span></code> variants for validating scalar subscripts and
locations (e.g. for indexing with <code class="docutils literal notranslate"><span class="pre">[[</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_as_location()</span></code> now preserves names of its inputs if possible.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_ptype2()</span></code> methods for base classes now prevent
inheritance. This makes sense because the subtyping graph created by
<code class="docutils literal notranslate"><span class="pre">vec_ptype2()</span></code> methods is generally not the same as the inheritance
relationships defined by S3 classes. For instance, subclasses are
often a richer type than their superclasses, and should often be
declared as supertypes (e.g. <code class="docutils literal notranslate"><span class="pre">vec_ptype2()</span></code> should return the
subclass).</p>
<p>We introduced this breaking change in a patch release because
<code class="docutils literal notranslate"><span class="pre">new_vctr()</span></code> now adds the base type to the class vector by default,
which caused <code class="docutils literal notranslate"><span class="pre">vec_ptype2()</span></code> to dispatch erroneously to the methods
for base types. We’ll finish switching to this approach in vctrs
0.3.0 for the rest of the base S3 classes (dates, data frames, …).</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_equal_na()</span></code> now works with complex vectors.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vctrs_vctr</span></code> class gains an <code class="docutils literal notranslate"><span class="pre">as.POSIXlt()</span></code> method (#717).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_is()</span></code> now ignores names and row names (#707).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_slice()</span></code> now support Altvec vectors (&#64;jimhester, #696).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_proxy_equal()</span></code> is now applied recursively across the columns of
data frames (#641).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_split()</span></code> no longer returns the <code class="docutils literal notranslate"><span class="pre">val</span></code> column as a <code class="docutils literal notranslate"><span class="pre">list_of</span></code>. It is now
returned as a bare list (#660).</p></li>
<li><p>Complex numbers are now coercible with integer and double (#564).</p></li>
<li><p>zeallot has been moved from Imports to Suggests, meaning that <code class="docutils literal notranslate"><span class="pre">%&lt;-%</span></code> is no
longer re-exported from vctrs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_equal()</span></code> no longer propagates missing values when comparing list
elements. This means that <code class="docutils literal notranslate"><span class="pre">vec_equal(list(NULL),</span> <span class="pre">list(NULL))</span></code> will continue to
return <code class="docutils literal notranslate"><span class="pre">NA</span></code> because <code class="docutils literal notranslate"><span class="pre">NULL</span></code> is the missing element for a list, but now
<code class="docutils literal notranslate"><span class="pre">vec_equal(list(NA),</span> <span class="pre">list(NA))</span></code> returns <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> because the <code class="docutils literal notranslate"><span class="pre">NA</span></code> values are
compared directly without checking for missingness.</p></li>
<li><p>Lists of expressions are now supported in <code class="docutils literal notranslate"><span class="pre">vec_equal()</span></code> and functions that
compare elements, such as <code class="docutils literal notranslate"><span class="pre">vec_unique()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_match()</span></code>. This ensures that
they work with the result of modeling functions like <code class="docutils literal notranslate"><span class="pre">glm()</span></code> and <code class="docutils literal notranslate"><span class="pre">mgcv::gam()</span></code>
which store “family” objects containing expressions (#643).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">new_vctr()</span></code> gains an experimental <code class="docutils literal notranslate"><span class="pre">inherit_base_type</span></code> argument
which determines whether or not the class of the underlying type
will be included in the class.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">list_of()</span></code> now inherits explicitly from “list” (#593).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_ptype()</span></code> has relaxed default behaviour for base types; now if two
vectors both inherit from (e.g.) “character”, the common type is also
“character” (#497).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_equal()</span></code> now correctly treats <code class="docutils literal notranslate"><span class="pre">NULL</span></code> as the missing value element for
lists (#653).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_cast()</span></code> now casts data frames to lists rowwise, i.e. to a list of
data frames of size 1. This preserves the invariant of
<code class="docutils literal notranslate"><span class="pre">vec_size(vec_cast(x,</span> <span class="pre">to))</span> <span class="pre">==</span> <span class="pre">vec_size(x)</span></code> (#639).</p></li>
<li><p>Positive and negative 0 are now considered equivalent by all functions that
check for equality or uniqueness (#637).</p></li>
<li><p>New experimental functions <code class="docutils literal notranslate"><span class="pre">vec_group_rle()</span></code> for returning run
length encoded groups; <code class="docutils literal notranslate"><span class="pre">vec_group_id()</span></code> for constructing group
identifiers from a vector; <code class="docutils literal notranslate"><span class="pre">vec_group_loc()</span></code> for computing the
locations of unique groups in a vector (#514).</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_chop()</span></code> for repeatedly slicing a vector. It efficiently captures
the pattern of <code class="docutils literal notranslate"><span class="pre">map(indices,</span> <span class="pre">vec_slice,</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">x)</span></code>.</p></li>
<li><p>Support for multiple character encodings has been added to functions that
compare elements within a single vector, such as <code class="docutils literal notranslate"><span class="pre">vec_unique()</span></code>, and across
multiple vectors, such as <code class="docutils literal notranslate"><span class="pre">vec_match()</span></code>. When multiple encodings are
encountered, a translation to UTF-8 is performed before any comparisons are
made (#600, #553).</p></li>
<li><p>Equality and ordering methods are now implemented for raw and
complex vectors (&#64;romainfrancois).</p></li>
</ul>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-2-1">
<h1>vctrs 0.2.1<a class="headerlink" href="#vctrs-0-2-1" title="Link to this heading">#</a></h1>
<p>Maintenance release for CRAN checks.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="vctrs-0-2-0">
<h1>vctrs 0.2.0<a class="headerlink" href="#vctrs-0-2-0" title="Link to this heading">#</a></h1>
<p>With the 0.2.0 release, many vctrs functions have been rewritten with
native C code to improve performance. Functions like <code class="docutils literal notranslate"><span class="pre">vec_c()</span></code> and
<code class="docutils literal notranslate"><span class="pre">vec_rbind()</span></code> should now be fast enough to be used in packages. This
is an ongoing effort, for instance the handling of factors and dates
has not been rewritten yet. These classes still slow down vctrs
primitives.</p>
<p>The API in 0.2.0 has been updated, please see a list of breaking
changes below. vctrs has now graduated from experimental to a maturing
package.
Please note that API changes are still planned for future releases,
for instance <code class="docutils literal notranslate"><span class="pre">vec_ptype2()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_cast()</span></code> might need to return a
sentinel instead of failing with an error when there is no common type
or possible cast.</p>
<section id="id2">
<h2>Breaking changes<a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<ul>
<li><p>Lossy casts now throw errors of type <code class="docutils literal notranslate"><span class="pre">vctrs_error_cast_lossy</span></code>.
Previously these were warnings. You can suppress these errors
selectively with <code class="docutils literal notranslate"><span class="pre">allow_lossy_cast()</span></code> to get the partial cast
results. To implement your own lossy cast operation, call the new
exported function <code class="docutils literal notranslate"><span class="pre">maybe_lossy_cast()</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_c()</span></code> now fails when an input is supplied with a name but has
internal names or is length &gt; 1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vec_c</span><span class="p">(</span><span class="n">foo</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span>
<span class="c1">#&gt; Error: Can&#39;t merge the outer name `foo` with a named vector.</span>
<span class="c1">#&gt; Please supply a `.name_spec` specification.</span>

<span class="n">vec_c</span><span class="p">(</span><span class="n">foo</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<span class="c1">#&gt; Error: Can&#39;t merge the outer name `foo` with a vector of length &gt; 1.</span>
<span class="c1">#&gt; Please supply a `.name_spec` specification.</span>
</pre></div>
</div>
<p>You can supply a name specification that describes how to combine
the external name of the input with its internal names or positions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Name spec as glue string:</span>
<span class="n">vec_c</span><span class="p">(</span><span class="n">foo</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">),</span> <span class="o">.</span><span class="n">name_spec</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{outer}</span><span class="s2">_</span><span class="si">{inner}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Name spec as a function:</span>
<span class="n">vec_c</span><span class="p">(</span><span class="n">foo</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">),</span> <span class="o">.</span><span class="n">name_spec</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">outer</span><span class="p">,</span> <span class="n">inner</span><span class="p">)</span> <span class="n">paste</span><span class="p">(</span><span class="n">outer</span><span class="p">,</span> <span class="n">inner</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="p">))</span>
<span class="n">vec_c</span><span class="p">(</span><span class="n">foo</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">),</span> <span class="o">.</span><span class="n">name_spec</span> <span class="o">=</span> <span class="o">~</span> <span class="n">paste</span><span class="p">(</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_empty()</span></code> has been renamed to <code class="docutils literal notranslate"><span class="pre">vec_is_empty()</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_dim()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_dims()</span></code> are no longer exported.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_na()</span></code> has been renamed to <code class="docutils literal notranslate"><span class="pre">vec_init()</span></code>, as the primary use case
is to initialize an output container.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_slice&lt;-</span></code> is now type stable (#140). It always returns the same
type as the LHS. If needed, the RHS is cast to the correct type, but
only if both inputs are coercible. See examples in <code class="docutils literal notranslate"><span class="pre">?vec_slice</span></code>.</p></li>
<li><p>We have renamed the <code class="docutils literal notranslate"><span class="pre">type</span></code> particle to <code class="docutils literal notranslate"><span class="pre">ptype</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vec_type()</span></code> =&gt; <code class="docutils literal notranslate"><span class="pre">vec_ptype()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_type2()</span></code> =&gt; <code class="docutils literal notranslate"><span class="pre">vec_ptype2()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_type_common()</span></code> =&gt; <code class="docutils literal notranslate"><span class="pre">vec_ptype_common()</span></code></p></li>
</ul>
<p>Consequently, <code class="docutils literal notranslate"><span class="pre">vec_ptype()</span></code> was renamed to <code class="docutils literal notranslate"><span class="pre">vec_ptype_show()</span></code>.</p>
</li>
</ul>
</section>
<section id="new-features">
<h2>New features<a class="headerlink" href="#new-features" title="Link to this heading">#</a></h2>
<ul>
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_proxy()</span></code> generic. This is the main customisation point in
vctrs along with <code class="docutils literal notranslate"><span class="pre">vec_restore()</span></code>. You should only implement it when
your type is designed around a non-vector class (atomic vectors,
bare lists, data frames). In this case, <code class="docutils literal notranslate"><span class="pre">vec_proxy()</span></code> should return
such a vector class. The vctrs operations will be applied on the
proxy and <code class="docutils literal notranslate"><span class="pre">vec_restore()</span></code> is called to restore the original
representation of your type.</p>
<p>The most common case where you need to implement <code class="docutils literal notranslate"><span class="pre">vec_proxy()</span></code> is
for S3 lists. In vctrs, S3 lists are treated as scalars by
default. This way we don’t treat objects like model fits as
vectors. To prevent vctrs from treating your S3 list as a scalar,
unclass it from the <code class="docutils literal notranslate"><span class="pre">vec_proxy()</span></code> method. For instance here is the
definition for <code class="docutils literal notranslate"><span class="pre">list_of</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#&#39; @export</span>
<span class="n">vec_proxy</span><span class="o">.</span><span class="n">vctrs_list_of</span> <span class="o">&lt;-</span> <span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">unclass</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you inherit from <code class="docutils literal notranslate"><span class="pre">vctrs_vctr</span></code> or <code class="docutils literal notranslate"><span class="pre">vctrs_rcrd</span></code> you don’t need to
implement <code class="docutils literal notranslate"><span class="pre">vec_proxy()</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_c()</span></code>, <code class="docutils literal notranslate"><span class="pre">vec_rbind()</span></code>, and <code class="docutils literal notranslate"><span class="pre">vec_cbind()</span></code> gain a <code class="docutils literal notranslate"><span class="pre">.name_repair</span></code>
argument (#227, #229).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_c()</span></code>, <code class="docutils literal notranslate"><span class="pre">vec_rbind()</span></code>, <code class="docutils literal notranslate"><span class="pre">vec_cbind()</span></code>, and all functions relying
on <code class="docutils literal notranslate"><span class="pre">vec_ptype_common()</span></code> now have more informative error messages
when some of the inputs have nested data frames that are not
convergent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span> <span class="o">&lt;-</span> <span class="n">tibble</span><span class="p">(</span><span class="n">foo</span> <span class="o">=</span> <span class="n">tibble</span><span class="p">(</span><span class="n">bar</span> <span class="o">=</span> <span class="n">tibble</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">letters</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">])))</span>
<span class="n">df2</span> <span class="o">&lt;-</span> <span class="n">tibble</span><span class="p">(</span><span class="n">foo</span> <span class="o">=</span> <span class="n">tibble</span><span class="p">(</span><span class="n">bar</span> <span class="o">=</span> <span class="n">tibble</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">)))</span>

<span class="n">vec_rbind</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">)</span>
<span class="c1">#&gt; Error: No common type for `..1$foo$bar$y` &lt;character&gt; and `..2$foo$bar$y` &lt;integer&gt;.</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_cbind()</span></code> now turns named data frames to packed columns.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tibble</span><span class="o">::</span><span class="nf">tibble</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">letters</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">])</span>
<span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">vec_cbind</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">packed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="n">data</span>
<span class="c1"># A tibble: 3 x 3</span>
<span class="w">      </span><span class="n">x</span><span class="w"> </span><span class="n">y</span><span class="w">     </span><span class="n">packed</span><span class="o">$</span><span class="n">x</span><span class="w"> </span><span class="o">$</span><span class="n">y</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">int</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">chr</span><span class="o">&gt;</span><span class="w">    </span><span class="o">&lt;</span><span class="n">int</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">chr</span><span class="o">&gt;</span>
<span class="m">1</span><span class="w">     </span><span class="m">1</span><span class="w"> </span><span class="n">a</span><span class="w">            </span><span class="m">1</span><span class="w"> </span><span class="n">a</span>
<span class="m">2</span><span class="w">     </span><span class="m">2</span><span class="w"> </span><span class="n">b</span><span class="w">            </span><span class="m">2</span><span class="w"> </span><span class="n">b</span>
<span class="m">3</span><span class="w">     </span><span class="m">3</span><span class="w"> </span><span class="n">c</span><span class="w">            </span><span class="m">3</span><span class="w"> </span><span class="n">c</span>
</pre></div>
</div>
<p>Packed data frames are nested in a single column. This makes it
possible to access it through a single name:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">$</span><span class="n">packed</span>
<span class="c1"># A tibble: 3 x 2</span>
<span class="w">      </span><span class="n">x</span><span class="w"> </span><span class="n">y</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">int</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">chr</span><span class="o">&gt;</span>
<span class="m">1</span><span class="w">     </span><span class="m">1</span><span class="w"> </span><span class="n">a</span>
<span class="m">2</span><span class="w">     </span><span class="m">2</span><span class="w"> </span><span class="n">b</span>
<span class="m">3</span><span class="w">     </span><span class="m">3</span><span class="w"> </span><span class="n">c</span>
</pre></div>
</div>
<p>We are planning to use this syntax more widely in the tidyverse.</p>
</li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_is()</span></code> function to check whether a vector conforms to a
prototype and/or a size. Unlike <code class="docutils literal notranslate"><span class="pre">vec_assert()</span></code>, it doesn’t throw
errors but returns <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> or <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> (#79).</p>
<p>Called without a specific type or size, <code class="docutils literal notranslate"><span class="pre">vec_assert()</span></code> tests whether
an object is a data vector or a scalar. S3 lists are treated as
scalars by default. Implement a <code class="docutils literal notranslate"><span class="pre">vec_is_vector()</span></code> for your class to
override this property (or derive from <code class="docutils literal notranslate"><span class="pre">vctrs_vctr</span></code>).</p>
</li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_order()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_sort()</span></code> for ordering and sorting
generalised vectors.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">.names_to</span></code> parameter for <code class="docutils literal notranslate"><span class="pre">vec_rbind()</span></code>. If supplied, this
should be the name of a column where the names of the inputs are
copied. This is similar to the <code class="docutils literal notranslate"><span class="pre">.id</span></code> parameter of
<code class="docutils literal notranslate"><span class="pre">dplyr::bind_rows()</span></code>.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_seq_along()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_init_along()</span></code> create useful sequences (#189).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_slice()</span></code> now preserves character row names, if present.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_split(x,</span> <span class="pre">by)</span></code> is a generalisation of <code class="docutils literal notranslate"><span class="pre">split()</span></code> that can divide
a vector into groups formed by the unique values of another vector. Returns
a two-column data frame containing unique values of <code class="docutils literal notranslate"><span class="pre">by</span></code> aligned with
matching <code class="docutils literal notranslate"><span class="pre">x</span></code> values (#196).</p></li>
</ul>
</section>
<section id="other-features-and-bug-fixes">
<h2>Other features and bug fixes<a class="headerlink" href="#other-features-and-bug-fixes" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Using classed errors of class <code class="docutils literal notranslate"><span class="pre">&quot;vctrs_error_assert&quot;</span></code> for failed
assertions, and of class <code class="docutils literal notranslate"><span class="pre">&quot;vctrs_error_incompatible&quot;</span></code> (with
subclasses <code class="docutils literal notranslate"><span class="pre">_type</span></code>, <code class="docutils literal notranslate"><span class="pre">_cast</span></code> and <code class="docutils literal notranslate"><span class="pre">_op</span></code>) for errors on incompatible
types (#184).</p></li>
<li><p>Character indexing is now only supported for named objects, an error
is raised for unnamed objects (#171).</p></li>
<li><p>Predicate generics now consistently return logical vectors when
passed a <code class="docutils literal notranslate"><span class="pre">vctrs_vctr</span></code> class. They used to restore the output to
their input type (#251).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">list_of()</span></code> now has an <code class="docutils literal notranslate"><span class="pre">as.character()</span></code> method. It uses
<code class="docutils literal notranslate"><span class="pre">vec_ptype_abbr()</span></code> to collapse complex objects into their type
representation (tidyverse/tidyr#654).</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">stop_incompatible_size()</span></code> to signal a failure due to mismatched sizes.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">validate_list_of()</span></code> (#193).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_arith()</span></code> is consistent with base R when combining <code class="docutils literal notranslate"><span class="pre">difftime</span></code>
and <code class="docutils literal notranslate"><span class="pre">date</span></code>, with a warning if casts are lossy (#192).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_c()</span></code> and <code class="docutils literal notranslate"><span class="pre">vec_rbind()</span></code> now handle data.frame columns properly
(&#64;yutannihilation, #182).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_cast(x,</span> <span class="pre">data.frame())</span></code> preserves the number of rows in <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_equal()</span></code> now handles missing values symmetrically (#204).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_equal_na()</span></code> now returns <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> for data frames and records when
every component is missing, not when <em>any</em> component is missing
(#201).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_init()</span></code> checks input is a vector.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_proxy_compare()</span></code> gains an experimental <code class="docutils literal notranslate"><span class="pre">relax</span></code> argument, which
allows data frames to be orderable even if all their columns are not
(#210).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_size()</span></code> now works with positive short row names. This fixes
issues with data frames created with jsonlite (#220).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_slice&lt;-</span></code> now has a <code class="docutils literal notranslate"><span class="pre">vec_assign()</span></code> alias. Use <code class="docutils literal notranslate"><span class="pre">vec_assign()</span></code>
when you don’t want to modify the original input.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_slice()</span></code> now calls <code class="docutils literal notranslate"><span class="pre">vec_restore()</span></code> automatically. Unlike the
default <code class="docutils literal notranslate"><span class="pre">[</span></code> method from base R, attributes are preserved by default.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_slice()</span></code> can correct slice 0-row data frames (#179).</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">vec_repeat()</span></code> for repeating each element of a vector the same number
of times.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vec_type2(x,</span> <span class="pre">data.frame())</span></code> ensures that the returned object has
names that are a length-0 character vector.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./renv\library\windows\R-4.4\x86_64-w64-mingw32\vctrs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">vctrs 0.6.5</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-6-4">vctrs 0.6.4</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-6-3">vctrs 0.6.3</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-6-2">vctrs 0.6.2</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-6-1">vctrs 0.6.1</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-6-0">vctrs 0.6.0</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-5-2">vctrs 0.5.2</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-5-1">vctrs 0.5.1</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-5-0">vctrs 0.5.0</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-4-2">vctrs 0.4.2</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-4-1">vctrs 0.4.1</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-4-0">vctrs 0.4.0</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-3-8">vctrs 0.3.8</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-3-7">vctrs 0.3.7</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-3-6">vctrs 0.3.6</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-3-5">vctrs 0.3.5</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-3-4">vctrs 0.3.4</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-3-3">vctrs 0.3.3</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-3-2">vctrs 0.3.2</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-3-1">vctrs 0.3.1</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cran-results">CRAN results</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-3-0">vctrs 0.3.0</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reverse-dependencies-troubleshooting">Reverse dependencies troubleshooting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#breaking-changes">Breaking changes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#type-system">Type system</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compatibility-and-fallbacks">Compatibility and fallbacks</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#vector-operations">Vector operations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#classes">Classes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#indexing-and-names">Indexing and names</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conditions">Conditions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">CRAN results</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-2-4">vctrs 0.2.4</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-2-3">vctrs 0.2.3</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-2-2">vctrs 0.2.2</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-2-1">vctrs 0.2.1</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#vctrs-0-2-0">vctrs 0.2.0</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Breaking changes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#new-features">New features</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#other-features-and-bug-fixes">Other features and bug fixes</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Brittany Cummings
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>