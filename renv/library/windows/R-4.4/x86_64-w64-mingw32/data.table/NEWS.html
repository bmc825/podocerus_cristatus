
<!DOCTYPE html>


<html lang="en" data-content_root="../../../../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>data.table v1.16.4 4 December 2024 &#8212; Chapter 3 Data Analysis</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'renv/library/windows/R-4.4/x86_64-w64-mingw32/data.table/NEWS';</script>
    <link rel="index" title="Index" href="../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../../../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../../../../_static/Podocerus_bw.png" class="logo__image only-light" alt="Chapter 3 Data Analysis - Home"/>
    <img src="../../../../../../_static/Podocerus_bw.png" class="logo__image only-dark pst-js-only" alt="Chapter 3 Data Analysis - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../../../../intro.html">
                    Data Analysis of P. cristatus
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../../../scripts/Load_Packages.html">Load Packages</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../../../01_Population/01_intro.html">Question 1</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../01_Population/01_data_cleaning.html">Data Cleaning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../01_Population/Clustering.html">Cluster Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../01_Population/Population_structure.html">Population Structure Analysis</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../../../02_Occurrence/02_intro.html">Question 2</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../02_Occurrence/02_data_cleaning.html">Data Cleaning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../02_Occurrence/Model_1.html">Model 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../02_Occurrence/Model_2.html">Model 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../02_Occurrence/Model_3.html">Model 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../02_Occurrence/Model_exp.html">Substrate Experiment Model</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../../../03_Camouflage/03_intro.html">Question 3</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../03_Camouflage/03_data_cleaning.html">Data Cleaning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../03_Camouflage/Model_4.html">Model 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../03_Camouflage/Model_5.html">Model 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../03_Camouflage/Model_6.html">Model 6</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../../../../04_Phylogenetic/04_intro.html">Question 4</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../04_Phylogenetic/Geneious_protocol.html">Geneious Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../../../04_Phylogenetic/Phylogenetic_analysis.html">Phylogenetic Analysis</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../../../../_sources/renv/library/windows/R-4.4/x86_64-w64-mingw32/data.table/NEWS.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>data.table v1.16.4 4 December 2024</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">data.table v1.16.4 4 December 2024</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bug-fixes">BUG FIXES</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-table-v1-16-2-9-october-2024">data.table v1.16.2 (9 October 2024)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">BUG FIXES</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#notes">NOTES</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-table-v1-16-0-25-august-2024">data.table v1.16.0  (25 August 2024)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#breaking-changes">BREAKING CHANGES</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#new-features">NEW FEATURES</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">BUG FIXES</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">NOTES</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#translations">TRANSLATIONS</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-table-v1-15-4-27-march-2024">data.table v1.15.4 (27 March 2024)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">BUG FIXES</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">NOTES</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-table-v1-15-2-27-feb-2024">data.table v1.15.2 (27 Feb 2024)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">BUG FIXES</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-table-v1-15-0-30-jan-2024">data.table v1.15.0  (30 Jan 2024)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#breaking-change">BREAKING CHANGE</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">NEW FEATURES</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">BUG FIXES</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">NOTES</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-table-v1-14-10-dec-2023-back-to-v1-10-0-dec-2016-has-been-moved-to-news-1-md">data.table v1.14.10 (Dec 2023) back to v1.10.0 (Dec 2016) has been moved to NEWS.1.md</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><strong>If you are viewing this file on CRAN, please check <a class="reference external" href="https://github.com/Rdatatable/data.table/blob/master/NEWS.md">latest news on GitHub</a> where the formatting is also better.</strong></p>
<section class="tex2jax_ignore mathjax_ignore" id="data-table-v1-16-4-4-december-2024">
<h1>data.table <a class="reference external" href="https://github.com/Rdatatable/data.table/milestone/36">v1.16.4</a> 4 December 2024<a class="headerlink" href="#data-table-v1-16-4-4-december-2024" title="Link to this heading">#</a></h1>
<section id="bug-fixes">
<h2>BUG FIXES<a class="headerlink" href="#bug-fixes" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Joins on multiple columns, such as <code class="docutils literal notranslate"><span class="pre">x[y,</span> <span class="pre">on=c(&quot;x1==y1&quot;,</span> <span class="pre">&quot;x2==y1&quot;)]</span></code>, could fail during implicit type coercions if <code class="docutils literal notranslate"><span class="pre">x1</span></code> and <code class="docutils literal notranslate"><span class="pre">x2</span></code> had different but still compatible types, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/6602">#6602</a>. This was particularly unexpected when columns <code class="docutils literal notranslate"><span class="pre">x1</span></code>, <code class="docutils literal notranslate"><span class="pre">x2</span></code>, and <code class="docutils literal notranslate"><span class="pre">y1</span></code> were all of the same class, e.g. <code class="docutils literal notranslate"><span class="pre">Date</span></code>, but differed in their underlying storage types. Thanks to Benjamin Schwendinger for the report and the fix.</p></li>
</ol>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="data-table-v1-16-2-9-october-2024">
<h1>data.table <a class="reference external" href="https://github.com/Rdatatable/data.table/milestone/35">v1.16.2</a> (9 October 2024)<a class="headerlink" href="#data-table-v1-16-2-9-october-2024" title="Link to this heading">#</a></h1>
<section id="id1">
<h2>BUG FIXES<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Using <code class="docutils literal notranslate"><span class="pre">print.data.table()</span></code> with character truncation using <code class="docutils literal notranslate"><span class="pre">datatable.prettyprint.char</span></code> no longer errors with <code class="docutils literal notranslate"><span class="pre">NA</span></code> entries, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/6441">#6441</a>. Thanks to &#64;r2evans for the bug report, and &#64;joshhwuu for the fix.</p></li>
<li><p>Fixed a segfault in <code class="docutils literal notranslate"><span class="pre">fcase()</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/6448">#6448</a>. Thanks &#64;ethanbsmith for reporting with reprex, &#64;aitap for finding the root cause, and &#64;MichaelChirico for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread()</span></code> automatically detects timestamps with sub-second accuracy again, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/6440">#6440</a>. This was a regression due to interference with new <code class="docutils literal notranslate"><span class="pre">dec='auto'</span></code> support. Thanks &#64;kav2k for the concise report and &#64;MichaelChirico for the fix.</p></li>
<li><p>Using a namespace-qualified call on the RHS of <code class="docutils literal notranslate"><span class="pre">by=</span></code>, e.g. <code class="docutils literal notranslate"><span class="pre">DT[,.N,by=base::mget(v)]</span></code>, works again, fixing <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/6493">#6493</a>. Thanks to &#64;mmoisse for the report and &#64;MichaelChirico for the fix.</p></li>
<li><p>Restore some join operations on <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">i</span></code> (e.g. an anti-join <code class="docutils literal notranslate"><span class="pre">x[!i]</span></code>)  where <code class="docutils literal notranslate"><span class="pre">i</span></code> is an extended data.frame, but not a data.table (e.g. a <code class="docutils literal notranslate"><span class="pre">tbl</span></code>), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/6501">#6501</a>. Thanks &#64;MichaelChirico for the report and PR.</p></li>
</ol>
</section>
<section id="notes">
<h2>NOTES<a class="headerlink" href="#notes" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Fixed a typo in the NEWS for the last release – that’s version 1.16.0, not 1.6.0; apologies. Thanks &#64;r2evans for flagging, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/6443">#6443</a>.</p></li>
<li><p>Continued work to remove non-API C functions, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/6180">#6180</a>. Thanks Ivan Krylov for the PR and for writing a clear and concise guide about the R API: <a class="reference external" href="https://aitap.codeberg.page/R-api/">https://aitap.codeberg.page/R-api/</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data.table</span></code> again properly detects OpenMP support when built using <code class="docutils literal notranslate"><span class="pre">gcc</span></code> on macOS, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/6409">#6409</a>. Thanks &#64;barracuda156 for the report and &#64;kevinushey for the fix.</p></li>
<li><p>The translations submitted for 1.16.0 are now actually shipped with the package – our deepest apologies to the translators for the omission. We have added a CI check to ensure that the .mo binaries which get shipped with the package are always up-to-date.</p></li>
</ol>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="data-table-v1-16-0-25-august-2024">
<h1>data.table <a class="reference external" href="https://github.com/Rdatatable/data.table/milestone/30">v1.16.0</a>  (25 August 2024)<a class="headerlink" href="#data-table-v1-16-0-25-august-2024" title="Link to this heading">#</a></h1>
<section id="breaking-changes">
<h2>BREAKING CHANGES<a class="headerlink" href="#breaking-changes" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">droplevels(in.place=TRUE)</span></code> is deprecated in favor of calling <code class="docutils literal notranslate"><span class="pre">setdroplevels()</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/6014">#6014</a>. Given the associated risks/pain points, we strongly prefer all in-place/by-reference behavior within data.table come from functions <code class="docutils literal notranslate"><span class="pre">set*</span></code> (and <code class="docutils literal notranslate"><span class="pre">:=</span></code>) to make it as clear as possible that inputs are mutable. See below and <code class="docutils literal notranslate"><span class="pre">?setdroplevels</span></code> for more.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">`[.data.table`</span></code> is un-exported again. This was exported to support an experimental feature (<code class="docutils literal notranslate"><span class="pre">DT()</span></code> functional form of <code class="docutils literal notranslate"><span class="pre">[</span></code>) that never made it to release, but we forgot to claw back this export in the NAMESPACE; sorry about that. We didn’t find anyone calling the method directly (which is inadvisable to begin with).</p></li>
</ol>
</section>
<section id="new-features">
<h2>NEW FEATURES<a class="headerlink" href="#new-features" title="Link to this heading">#</a></h2>
<ol class="arabic">
<li><p>We continue to consider user feedback to prioritize development. See <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3189">#3189</a> for the current list of most-requested issues. In this release we add five highly-requested features:</p>
<p>a. Using <code class="docutils literal notranslate"><span class="pre">dt[,</span> <span class="pre">names(.SD)</span> <span class="pre">:=</span> <span class="pre">lapply(.SD,</span> <span class="pre">fx)]</span></code> now works to update all columns, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/795">#795</a>. Of course this also works when <code class="docutils literal notranslate"><span class="pre">.SD</span></code> is only a subset of the columns: <code class="docutils literal notranslate"><span class="pre">dt[,</span> <span class="pre">names(.SD)</span> <span class="pre">:=</span> <span class="pre">lapply(.SD,</span> <span class="pre">fx),</span> <span class="pre">.SDcols</span> <span class="pre">=</span> <span class="pre">is.numeric]</span></code>. Thanks to &#64;brodieG for the report, 20 or so others for chiming in, and &#64;ColeMiller1 for PR.</p>
<p>b. <code class="docutils literal notranslate"><span class="pre">fread()</span></code> now supports automatic detection of <code class="docutils literal notranslate"><span class="pre">dec</span></code> (as either <code class="docutils literal notranslate"><span class="pre">.</span></code> or <code class="docutils literal notranslate"><span class="pre">,</span></code>, the latter being <a class="reference external" href="https://en.wikipedia.org/wiki/Decimal_separator">common in many places in Europe, Africa, and South America</a>); this behavior is now the default, i.e. <code class="docutils literal notranslate"><span class="pre">dec='auto'</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2431">#2431</a>. Thanks &#64;mattdowle for the original issue, 50 or more others for expressing support, and &#64;MichaelChirico for the fix.</p>
<p>c. <code class="docutils literal notranslate"><span class="pre">fcase()</span></code> supports vectors in <code class="docutils literal notranslate"><span class="pre">default=</span></code> (so the default can vary by row) and <code class="docutils literal notranslate"><span class="pre">default=</span></code> is now lazily evaluated, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4258">#4258</a>. Thanks &#64;sindribaldur for the feature request, &#64;shrektan for doing most of the implementation, and &#64;MichaelChirico for sewing things up. Thanks also to &#64;DavisVaughan for some design guidance before release to remove an extraneous feature, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/6352">#6352</a>.</p>
<p>d. <code class="docutils literal notranslate"><span class="pre">[.data.table</span></code> gains argument <code class="docutils literal notranslate"><span class="pre">showProgress</span></code>, allowing users to toggle progress printing for slow “group by” operations, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3060">#3060</a>. The progress bar reports information such as the number of groups processed, total groups, total time elapsed and estimated time until completion. This feature doesn’t apply to <code class="docutils literal notranslate"><span class="pre">GForce</span></code>-optimized operations. Thanks to &#64;eatonya and &#64;zachmayer for filing FRs, and to everyone else that up-voted/chimed in on the issue. Thanks to &#64;joshhwuu for the PR.</p>
<p>e. <code class="docutils literal notranslate"><span class="pre">rbindlist(l,</span> <span class="pre">use.names=TRUE)</span></code> and <code class="docutils literal notranslate"><span class="pre">rbind()</span></code> now work correctly on columns with different class attributes across the inputs for certain classes such as <code class="docutils literal notranslate"><span class="pre">Date</span></code>, <code class="docutils literal notranslate"><span class="pre">IDate</span></code>, <code class="docutils literal notranslate"><span class="pre">ITime</span></code>, <code class="docutils literal notranslate"><span class="pre">POSIXct</span></code> and <code class="docutils literal notranslate"><span class="pre">AsIs</span></code> with matched columns of similar classes, e.g., <code class="docutils literal notranslate"><span class="pre">rbind(data.table(d</span> <span class="pre">=</span> <span class="pre">Sys.Date()),</span> <span class="pre">data.table(d</span> <span class="pre">=</span> <span class="pre">as.IDate(Sys.Date()-1)))</span></code>. The conversion is done automatically and the class attribute of the final column is determined by the first class attribute encountered in the binding list, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5309">#5309</a>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4934">#4934</a>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5391">#5391</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">rbindlist(l,</span> <span class="pre">ignore.attr=TRUE)</span></code> and <code class="docutils literal notranslate"><span class="pre">rbind()</span></code> also gain argument <code class="docutils literal notranslate"><span class="pre">ignore.attr</span></code> (default <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>) to manually deactivate the safety net preventing binding columns with different column classes, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3911">#3911</a>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5542">#5542</a>. Thanks to &#64;dcaseykc, &#64;fox34, &#64;adrian-quintario, &#64;berg-michael, &#64;arunsrinivasan, &#64;statquant, &#64;pkress, &#64;jrausch12, &#64;therosko, &#64;OfekShilon, &#64;iMissile, &#64;tdhock for the requests and &#64;ben-schwen for the PR.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">print.data.table()</span></code> shows empty (<code class="docutils literal notranslate"><span class="pre">NULL</span></code>) list column entries as <code class="docutils literal notranslate"><span class="pre">[NULL]</span></code> for emphasis. Previously they would just print nothing (indistinguishable from an empty string). Part of <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4198">#4198</a>. Thanks &#64;sritchie73 for the proposal and fix.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">data.table</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="c1">#         a</span>
<span class="c1">#    &lt;list&gt;</span>
<span class="c1"># 1: [NULL]</span>
<span class="c1"># 2:</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">.datatable.aware</span> <span class="pre">=</span> <span class="pre">FALSE</span></code> works correctly to signal it’s not safe to call data.table methods, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5654">#5654</a>. Thanks &#64;dvg-p4 for the request and PR. See <code class="docutils literal notranslate"><span class="pre">vignette(&quot;datatable-importing&quot;)</span></code> for more on this feature.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">split()</span></code> method for <code class="docutils literal notranslate"><span class="pre">data.table</span></code>s is more consistent with that for base methods:</p>
<p>a. <code class="docutils literal notranslate"><span class="pre">f</span></code> can be a formula, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5392">#5392</a>, mirroring the same in <code class="docutils literal notranslate"><span class="pre">base::split.data.frame</span></code> since R 4.1.0 (May 2021). Thanks to &#64;XiangyunHuang for the request, and &#64;ben-schwen for the PR.</p>
<p>b. <code class="docutils literal notranslate"><span class="pre">sep=</span></code> is recognized when splitting with <code class="docutils literal notranslate"><span class="pre">by=</span></code>, just like the default and data.frame methods <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5417">#5417</a>. Thanks &#64;MichaelChirico for the request and PR.</p>
</li>
<li><p>Namespace-qualifying <code class="docutils literal notranslate"><span class="pre">data.table::shift()</span></code>, <code class="docutils literal notranslate"><span class="pre">data.table::first()</span></code>, or <code class="docutils literal notranslate"><span class="pre">data.table::last()</span></code> will not deactivate GForce, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5942">#5942</a>. Thanks &#64;MichaelChirico for the proposal and fix. Namespace-qualifying other calls like <code class="docutils literal notranslate"><span class="pre">stats::sum()</span></code>, <code class="docutils literal notranslate"><span class="pre">base::prod()</span></code>, etc., continue to work as an escape valve to avoid GForce, e.g. to ensure S3 method dispatch.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">transpose()</span></code> gains <code class="docutils literal notranslate"><span class="pre">list.cols=</span></code> argument (default <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5639">#5639</a>. Use this to return output with list columns and avoid type promotion (an exception is <code class="docutils literal notranslate"><span class="pre">factor</span></code> columns which are promoted to <code class="docutils literal notranslate"><span class="pre">character</span></code> for consistency between <code class="docutils literal notranslate"><span class="pre">list.cols=TRUE</span></code> and <code class="docutils literal notranslate"><span class="pre">list.cols=FALSE</span></code>). This is convenient for creating a row-major representation of a table. Thanks to &#64;MLopez-Ibanez for the request, and &#64;ben-schwen for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread()</span></code>’s <code class="docutils literal notranslate"><span class="pre">fill</span></code> argument now also accepts an <code class="docutils literal notranslate"><span class="pre">integer</span></code> in addition to boolean values – an upper bound on the number of columns in the file. <code class="docutils literal notranslate"><span class="pre">fread</span></code> always guesses the number of columns based on reading a sample of rows in the file. When <code class="docutils literal notranslate"><span class="pre">fill=TRUE</span></code>, <code class="docutils literal notranslate"><span class="pre">fread()</span></code> stops reading and ignores subsequent rows when this estimate winds up too low, e.g. when the sampled rows happen to exclude some rows that are even wider, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2691">#2691</a>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4130">#4130</a>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3436">#3436</a>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1812">#1812</a> and <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5378">#5378</a>. The suggestion for <code class="docutils literal notranslate"><span class="pre">fill</span></code> to allow a manual estimate of the number of columns instead comes from <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2727">#2727</a>. Using <code class="docutils literal notranslate"><span class="pre">fill=Inf</span></code> reads the full file for estimating the number of columns. Thanks to &#64;jangorecki, &#64;christellacaze, &#64;Yiguan, &#64;alexdthomas, &#64;ibombonato, &#64;Befrancesco, &#64;TobiasGold for reporting/requesting, and &#64;ben-schwen for the PR.</p></li>
<li><p>Computations in <code class="docutils literal notranslate"><span class="pre">j</span></code> can return a matrix or array <em>if it is one-dimensional</em>, e.g. a row or column vector, when <code class="docutils literal notranslate"><span class="pre">j</span></code> is a list of columns during grouping, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/783">#783</a>. Previously a matrix could be provided in <code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">expr,</span> <span class="pre">by]</span></code> form, but not <code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">list(expr),</span> <span class="pre">by]</span></code> form; this resolves that inconsistency. It is still an error to return a “true” array, e.g. a <code class="docutils literal notranslate"><span class="pre">2x3</span></code> matrix.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">measure()</span></code> helper for <code class="docutils literal notranslate"><span class="pre">melt()</span></code> now supports user-specified <code class="docutils literal notranslate"><span class="pre">cols</span></code> argument, which can be useful to specify a subset of columns to reshape without having to use a regex, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5063">#5063</a>. Thanks to &#64;UweBlock and &#64;Henrik-P for reporting, and &#64;tdhock for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setDT()</span></code> is faster for data with many columns, thanks &#64;MichaelChirico for reporting and fixing the issue, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5426">#5426</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dcast()</span></code> gains <code class="docutils literal notranslate"><span class="pre">value.var.in.dots</span></code>, <code class="docutils literal notranslate"><span class="pre">value.var.in.LHSdots</span></code> and <code class="docutils literal notranslate"><span class="pre">value.var.in.RHSdots</span></code> arguments, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5824">#5824</a>. This allows the <code class="docutils literal notranslate"><span class="pre">value.var</span></code> variable(s) in <code class="docutils literal notranslate"><span class="pre">dcast()</span></code> to be represented by <code class="docutils literal notranslate"><span class="pre">...</span></code> in the formula (if not otherwise mentioned). Thanks to &#64;iago-pssjd for the report and PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread()</span></code> loads <code class="docutils literal notranslate"><span class="pre">.bgz</span></code> files directly, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5461">#5461</a>. Thanks to &#64;TMRHarrison for the request with proposed fix, and &#64;ben-schwen for the PR.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">setdroplevels()</span></code> as a by-reference version of the <code class="docutils literal notranslate"><span class="pre">droplevels()</span></code> method, which returns a copy of its input, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/6014">#6014</a>. Thanks &#64;MichaelChirico for the suggestion and implementation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dcast(fill=NULL)</span></code> only computes default fill value if necessary, which eliminates some previous warnings which were potentially confusing (for example, when <code class="docutils literal notranslate"><span class="pre">fun.aggregate=min</span></code> or <code class="docutils literal notranslate"><span class="pre">max</span></code>, warning was “NAs introduced by coercion to integer range”), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5512">#5512</a>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5390">#5390</a>. Thanks to &#64;tdhock for the report and fix.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">patterns()</span></code> helper for <code class="docutils literal notranslate"><span class="pre">.SDcols</span></code> now accepts arguments <code class="docutils literal notranslate"><span class="pre">ignore.case</span></code>, <code class="docutils literal notranslate"><span class="pre">perl</span></code>, <code class="docutils literal notranslate"><span class="pre">fixed</span></code>, and <code class="docutils literal notranslate"><span class="pre">useBytes</span></code>, which are passed to <code class="docutils literal notranslate"><span class="pre">grep()</span></code>, #5387. Thanks to &#64;iago-pssjd for the feature request, and &#64;tdhock for the implementation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">print()</span></code> method for <code class="docutils literal notranslate"><span class="pre">data.table</span></code>s:</p>
<p>a. Now handles combination multibyte characters correctly when truncating wide string entries, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5096">#5096</a>. Thanks to &#64;MichaelChirico for the report and &#64;joshhwuu for the fix.</p>
<p>b. Prints the indicator <code class="docutils literal notranslate"><span class="pre">---</span></code> in every value column when truncation is needed and <code class="docutils literal notranslate"><span class="pre">row.names</span> <span class="pre">=</span> <span class="pre">FALSE</span></code> instead of adding a blank column where the <code class="docutils literal notranslate"><span class="pre">rownames</span></code> would have been just to include <code class="docutils literal notranslate"><span class="pre">---</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4083">#4083</a>. Thanks &#64;MichaelChirico for the report and &#64;joshhwuu for the fix.</p>
<p>c. Honors <code class="docutils literal notranslate"><span class="pre">na.print</span></code>, as seen in <code class="docutils literal notranslate"><span class="pre">print.default</span></code>, allowing for string replacement of <code class="docutils literal notranslate"><span class="pre">NA</span></code> values when printing. Thanks &#64;HughParsonage for the report and &#64;joshhwuu for the fix.</p>
<p>d. Gains new argument <code class="docutils literal notranslate"><span class="pre">show.indices</span></code> (with corresponding option <code class="docutils literal notranslate"><span class="pre">datatable.show.indices</span></code>) that allows the user to print a <code class="docutils literal notranslate"><span class="pre">data.table</span></code>’s indices as columns without having to modify the <code class="docutils literal notranslate"><span class="pre">data.table</span></code> itself. Thanks &#64;MichaelChirico for the report and &#64;joshhwuu for the PR.</p>
<p>e. Displays <code class="docutils literal notranslate"><span class="pre">integer64</span></code> columns correctly by loading {bit64} if needed, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/6224">#6224</a>. Thanks &#64;renkun-ken for the report and &#64;MichaelChirico for the fix.</p>
</li>
</ol>
</section>
<section id="id2">
<h2>BUG FIXES<a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">unique()</span></code> returns a copy when <code class="docutils literal notranslate"><span class="pre">nrows(x)</span> <span class="pre">&lt;=</span> <span class="pre">1</span></code> instead of a mutable alias, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/5932">#5932</a>. This is consistent with existing <code class="docutils literal notranslate"><span class="pre">unique()</span></code> behavior when the input has no duplicates but more than one row. Thanks to &#64;brookslogan for the report and &#64;dshemetov for the fix.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dcast()</span></code> handles coercion of <code class="docutils literal notranslate"><span class="pre">fill</span></code> to <code class="docutils literal notranslate"><span class="pre">integer64</span></code> correctly, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4561">#4561</a>. Thanks to &#64;emallickhossain for the bug report and &#64;MichaelChirico for the fix.</p></li>
<li><p>Optimized <code class="docutils literal notranslate"><span class="pre">shift()</span></code> per group produces the right results when simultaneously subsetting, for example, <code class="docutils literal notranslate"><span class="pre">DT[i==1L,</span> <span class="pre">shift(x),</span> <span class="pre">by=group]</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5962">#5962</a>. Thanks to &#64;renkun-ken for the report and &#64;ben-schwen for the fix.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fwrite(x,</span> <span class="pre">row.names=TRUE)</span></code> with <code class="docutils literal notranslate"><span class="pre">x</span></code> a <code class="docutils literal notranslate"><span class="pre">matrix</span></code> writes <code class="docutils literal notranslate"><span class="pre">row.names</span></code> when present, not row numbers, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5315">#5315</a>. Thanks to &#64;Liripo for the report, and &#64;ben-schwen for the fix.</p></li>
<li><p>Adding a list column to an empty <code class="docutils literal notranslate"><span class="pre">data.table</span></code> works consistently with other column types, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5738">#5738</a>. Thanks to Benjamin Schwendinger for the report and the fix.</p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">DT[,j,by]</span></code>, <code class="docutils literal notranslate"><span class="pre">by</span></code> retains its attributes (e.g. class) when <code class="docutils literal notranslate"><span class="pre">j</span></code> is GForce optimized, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5567">#5567</a>. Thanks to &#64;danwwilson for the report, and &#64;ben-schwen for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dt[,,by=año]</span></code> (i.e., using a column name containing a non-ASCII character in <code class="docutils literal notranslate"><span class="pre">by</span></code> as a plain symbol) no longer errors with “object ‘año’ not found”, #4708. Thanks &#64;pfv07 for the report, and &#64;MichaelChirico for the fix. Also thanks to &#64;aitap for suggesting an improvement to the corresponding test, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/6339">#6339</a>.</p></li>
<li><p>Fixed some memory management issues in the C routines backing <code class="docutils literal notranslate"><span class="pre">melt()</span></code>, <code class="docutils literal notranslate"><span class="pre">froll()</span></code>, and GForce <code class="docutils literal notranslate"><span class="pre">mean()</span></code>, as identified by <code class="docutils literal notranslate"><span class="pre">rchk</span></code>. Thanks Tomas Kalibera and the CRAN team for setting up the <code class="docutils literal notranslate"><span class="pre">rchk</span></code> system, and &#64;MichaelChirico for the fix.</p></li>
<li><p>data.table’s <code class="docutils literal notranslate"><span class="pre">all.equal()</span></code> method now dispatches to each column’s own <code class="docutils literal notranslate"><span class="pre">all.equal()</span></code> method as appropriate, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4543">#4543</a>. Thanks &#64;MichaelChirico for the report and fix. Note that this had two noteworthy changes to data.table’s own test suite that might affect you:</p>
<ol class="arabic simple">
<li><p>Comparisons of POSIXct columns compare absolute, not relative differences, meaning that millisecond-scale differences might trigger a “not equal” report that was hidden before.</p></li>
<li><p>Comparisons of integer64 columns could be totally wrong since they were being compared on the basis of their representation as doubles, not long integers.</p></li>
</ol>
<p>The former might be a matter of preference requiring you to specify a different <code class="docutils literal notranslate"><span class="pre">tolerance=</span></code>, while the latter was clearly a bug.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">rbindlist()</span></code> and <code class="docutils literal notranslate"><span class="pre">shift()</span></code> could lead to a protection stack overflow when applied to a list containing many nested lists exceeding the pointer protection stack size, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4536">#4536</a>. Thanks to &#64;ProfFancyPants for reporting, and &#64;ben-schwen (<code class="docutils literal notranslate"><span class="pre">rbindlist</span></code>) and &#64;MichaelChirico (<code class="docutils literal notranslate"><span class="pre">shift</span></code>) for the fix.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread(x,</span> <span class="pre">colClasses=&quot;POSIXct&quot;)</span></code> now also works for columns containing only <code class="docutils literal notranslate"><span class="pre">NA</span></code> values, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/6208">#6208</a>. Thanks to &#64;markus-schaffer for the report, and &#64;ben-schwen for the fix.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread()</span></code> is more careful about detecting that a file is compressed in bzip2 format, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/6304">#6304</a>. In particular, we also check the 4th byte of the file is a digit; in rare cases, a legitimate uncompressed CSV file could match ‘BZh’ as the first 3 bytes. We think an uncompressed CSV file matching ‘BZh[1-9]’ is all the more rare and unlikely to be encountered in “real” examples. Other formats (zip, gzip) are friendly enough to use non-printable characters in their magic numbers. Thanks &#64;grainnemcguire for the report and &#64;MichaelChirico for the fix.</p></li>
<li><p>Selecting the key column like <code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">.(key1,</span> <span class="pre">key2)]</span></code> will retain the key without a performance penalty, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4498">#4498</a>. Thanks to &#64;user9439449 on StackOverflow for the report and &#64;MichaelChirico for the fix.</p></li>
<li><p>Passing functions programmatically with <code class="docutils literal notranslate"><span class="pre">env=</span></code> doesn’t produce an opaque error, e.g. <code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">f(b),</span> <span class="pre">env</span> <span class="pre">=</span> <span class="pre">list(f=sum)]</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/6026">#6026</a>. Note that it’s much better to pass functions like <code class="docutils literal notranslate"><span class="pre">f=&quot;sum&quot;</span></code> instead. Thanks to &#64;MichaelChirico for the bug report and fix.</p></li>
</ol>
</section>
<section id="id3">
<h2>NOTES<a class="headerlink" href="#id3" title="Link to this heading">#</a></h2>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">transform()</span></code> method for data.table sped up substantially when creating new columns on large tables. Thanks to &#64;OfekShilon for the report and PR. The implemented solution was proposed by &#64;ColeMiller1.</p></li>
<li><p>The documentation for the <code class="docutils literal notranslate"><span class="pre">fill</span></code> argument in <code class="docutils literal notranslate"><span class="pre">rbind()</span></code> and <code class="docutils literal notranslate"><span class="pre">rbindlist()</span></code> now notes the expected behaviour for missing <code class="docutils literal notranslate"><span class="pre">list</span></code> columns when <code class="docutils literal notranslate"><span class="pre">fill=TRUE</span></code>, namely to use <code class="docutils literal notranslate"><span class="pre">NULL</span></code> (not <code class="docutils literal notranslate"><span class="pre">NA</span></code>), <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/4198">#4198</a>. Thanks &#64;sritchie73 for the proposal and fix.</p></li>
<li><p>data.table now depends on R 3.3.0 (2016) instead of 3.1.0 (2014). Recent versions of R have good features that we would gradually like to incorporate, and we see next to no usage of these very old versions of R. We originally attempted to bump only to R 3.2.0 in this release, but our vignette engine {knitr} requiring 3.3.0 and <code class="docutils literal notranslate"><span class="pre">R</span> <span class="pre">CMD</span> <span class="pre">check</span></code> lacking an <code class="docutils literal notranslate"><span class="pre">--ignore-vignettes</span></code> option until 3.3.0 essentially forced our hands.</p></li>
<li><p>Erroneous assignment calls in <code class="docutils literal notranslate"><span class="pre">[</span></code> with a trailing comma (e.g. <code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">`:=`(a</span> <span class="pre">=</span> <span class="pre">1,</span> <span class="pre">b</span> <span class="pre">=</span> <span class="pre">2,)]</span></code>) get a friendlier error since this situation is common during refactoring and easy to miss visually. Thanks &#64;MichaelChirico for the fix.</p></li>
<li><p>Input files are now kept open during <code class="docutils literal notranslate"><span class="pre">mmap()</span></code> when running under Emscripten, <a class="reference external" href="https://github.com/emscripten-core/emscripten/issues/20459">emscripten-core/emscripten#20459</a>. This avoids an error in <code class="docutils literal notranslate"><span class="pre">fread()</span></code> when running in WebAssembly, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5969">#5969</a>. Thanks to &#64;maek-ies for the report and &#64;georgestagg for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dcast()</span></code> improves behavior for the situation that the <code class="docutils literal notranslate"><span class="pre">fun.aggregate</span></code> value of <code class="docutils literal notranslate"><span class="pre">length()</span></code> is used but not provided by the user.</p>
<p>a. This now triggers a warning, not a message, since relying on this default often signals unexpected duplicates in the data, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5386">#5386</a>. The warning is classed as <code class="docutils literal notranslate"><span class="pre">dt_missing_fun_aggregate_warning</span></code>, allowing for more targeted handling in user code. Thanks &#64;MichaelChirico for the suggestion and &#64;Nj221102 for the fix.</p>
<p>b. The warning itself does better explaining the behavior and suggesting alternatives, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5217">#5217</a>. Thanks &#64;MichaelChirico for the suggestion and &#64;Nj221102 for the fix.</p>
</li>
<li><p>Updated a test relying on operator <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> working for comparing language objects to a string, which will be deprecated by R, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5977">#5977</a>; no user-facing effect. Thanks to R-core for continuously improving the language.</p></li>
<li><p>Improved OpenMP detection when building from source on Mac, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4348">#4348</a>. Thanks &#64;jameshester and &#64;kevinushey for the request and &#64;kevinushey for the PR, &#64;jameslamb for the advice and &#64;s-u of R-core for ensuring CRAN machines are configured to support the expected setup.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test.data.table()</span></code> runs more robustly:</p>
<p>a. In sessions where the <code class="docutils literal notranslate"><span class="pre">digits</span></code> or <code class="docutils literal notranslate"><span class="pre">warn</span></code> options are not their defaults (<code class="docutils literal notranslate"><span class="pre">7</span></code> and <code class="docutils literal notranslate"><span class="pre">0</span></code>, respectively), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5285">#5285</a>. Thanks &#64;OfekShilon for the report and suggested fix and &#64;MichaelChirico for the PR.</p>
<p>b. In locales where <code class="docutils literal notranslate"><span class="pre">letters</span> <span class="pre">!=</span> <span class="pre">sort(letters)</span></code>, e.g. Latvian, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3502">#3502</a>. Thanks &#64;minemR for the report and &#64;MichaelChirico for the fix.</p>
<p>c. Initialises the numeric rounding value to 0 using <code class="docutils literal notranslate"><span class="pre">setNumericRounding(0)</span></code> to avoid failed tests if the user has set a different value, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/6082">#6082</a>. The user’s value is restored on exit. Thanks to &#64;MichaelChirico for the report and for describing the solution, and &#64;markseeto for implementing.</p>
<p>To enable this, <code class="docutils literal notranslate"><span class="pre">setNumericRounding()</span></code> now invisibly returns the old rounding value instead of <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, which is consistent with similar behavior by <code class="docutils literal notranslate"><span class="pre">setwd()</span></code>, <code class="docutils literal notranslate"><span class="pre">options()</span></code>, etc. Thanks &#64;MichaelChirico for the report and &#64;joshhwuu for the fix.</p>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">measure()</span></code> and <code class="docutils literal notranslate"><span class="pre">patterns()</span></code> helpers for <code class="docutils literal notranslate"><span class="pre">[</span></code> and <code class="docutils literal notranslate"><span class="pre">melt()</span></code> are now exported to ensure consistency with other non-standard evaluation (NSE) exports like <code class="docutils literal notranslate"><span class="pre">.N</span></code> and <code class="docutils literal notranslate"><span class="pre">:=</span></code>. This change addresses <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5604">#5604</a>, allowing package developers to import these names and avoid <code class="docutils literal notranslate"><span class="pre">R</span> <span class="pre">CMD</span> <span class="pre">check</span></code> <code class="docutils literal notranslate"><span class="pre">NOTE</span></code>s about undefined variables. Thanks to &#64;MichaelChirico and &#64;ylelkes for their suggestions, and to &#64;Nj221102 for the implementation.</p>
<p>We plan to export similar placeholders for <code class="docutils literal notranslate"><span class="pre">.</span></code> and <code class="docutils literal notranslate"><span class="pre">J</span></code> in roughly one year (e.g. data.table 1.18.0), but excluded them from this release to avoid back-compatibility issues. Specifically, some packages doing <code class="docutils literal notranslate"><span class="pre">import(plyr)</span></code> <em>and</em> <code class="docutils literal notranslate"><span class="pre">import(data.table)</span></code>, and/or with those packages in <code class="docutils literal notranslate"><span class="pre">Depends</span></code>, will error when data.table starts exporting <code class="docutils literal notranslate"><span class="pre">.</span></code> (and similarly for a potential conflict with <code class="docutils literal notranslate"><span class="pre">rJava::J()</span></code>). We discourage using data.table (or any package, really) in Depends; blanket <code class="docutils literal notranslate"><span class="pre">import()</span></code> of package is also generally best avoided. See <code class="docutils literal notranslate"><span class="pre">vignette(&quot;datatable-importing&quot;)</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">fwrite()</span></code> header rows are no longer quoted automatically when <code class="docutils literal notranslate"><span class="pre">na</span></code> argument is given, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2964">#2964</a>. Thanks &#64;jangorecki for the report and &#64;joshhwuu for the fix.</p></li>
<li><p>Removed a warning about the now totally-obsolete option <code class="docutils literal notranslate"><span class="pre">datatable.CJ.names</span></code>, as discussed in previous releases.</p></li>
<li><p>Refactored some non-API calls in the package C code, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/6180">#6180</a>. There should be no user-visible change. Thanks to various R users, R core, and especially Luke Tierney for pushing to have a clearer definition of “API” for R and for offering clear documentation and suggested workarounds. Thanks &#64;MichaelChirico and &#64;TysonStanley for implementing changes for this release; more will follow.</p></li>
<li><p>C code is more unified in how failures to allocate memory (<code class="docutils literal notranslate"><span class="pre">malloc()</span></code>/<code class="docutils literal notranslate"><span class="pre">calloc()</span></code>) are handled, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1115">#1115</a>. No OOM issues were reported, as these regions of code typically request relatively small blocks of memory, but it is good to handle memory pressure consistently. Thanks &#64;elfring for the report and &#64;MichaelChirico for the clean-up effort and future-proofing linter.</p></li>
<li><p>The internal routine for finding sort order (<code class="docutils literal notranslate"><span class="pre">forder()</span></code>) will now re-use any existing index. A similar optimization was already present in R code, but this has now been pushed to C and covers a wider range of use cases and collects more statistics about its input (e.g. whether any infinite entries were found), opening the possibility for more optimizations in other functions.</p>
<p>Functions <code class="docutils literal notranslate"><span class="pre">setindex()</span></code> (and <code class="docutils literal notranslate"><span class="pre">setindexv()</span></code>) will now compute groups’ positions as well. <code class="docutils literal notranslate"><span class="pre">setindex()</span></code> also collects the extra statistics alluded to above.</p>
<p>Finding sort order in other routines (for example subset <code class="docutils literal notranslate"><span class="pre">d2[id==1L]</span></code>) does not include those extra statistics so as not to impose a slowdown.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="n">d2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">data.table</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="m">2</span><span class="o">:</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">)</span>
<span class="nf">setindexv</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;id&quot;</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="nf">attr</span><span class="p">(</span><span class="nf">attr</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;index&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;__id&quot;</span><span class="p">))</span>
<span class="w"> </span><span class="c1"># int [1:2] 2 1</span>
<span class="c1"># - attr(*, &quot;starts&quot;)= int [1:2] 1 2</span>
<span class="c1"># - attr(*, &quot;maxgrpn&quot;)= int 1</span>
<span class="c1"># - attr(*, &quot;anyna&quot;)= int 0</span>
<span class="c1"># - attr(*, &quot;anyinfnan&quot;)= int 0</span>
<span class="c1"># - attr(*, &quot;anynotascii&quot;)= int 0</span>
<span class="c1"># - attr(*, &quot;anynotutf8&quot;)= int 0</span>

<span class="n">d2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">data.table</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="m">2</span><span class="o">:</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">)</span>
<span class="nf">invisible</span><span class="p">(</span><span class="n">d2</span><span class="p">[</span><span class="n">id</span><span class="o">==</span><span class="m">1L</span><span class="p">])</span>
<span class="nf">str</span><span class="p">(</span><span class="nf">attr</span><span class="p">(</span><span class="nf">attr</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;index&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;__id&quot;</span><span class="p">))</span>
<span class="c1"># int [1:2] 2 1</span>
</pre></div>
</div>
<p>This feature also enables re-use of sort index during joins, in cases where one of the calls to find sort order is made from C code.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">d1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">data.table</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">)</span>
<span class="n">d2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">data.table</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="m">2</span><span class="o">:</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">)</span>
<span class="nf">setindexv</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;id&quot;</span><span class="p">)</span>
<span class="n">d1</span><span class="p">[</span><span class="n">d2</span><span class="p">,</span><span class="w"> </span><span class="n">on</span><span class="o">=</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">verbose</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">]</span>
<span class="c1">#...</span>
<span class="c1">#Starting bmerge ...</span>
<span class="c1">#forderReuseSorting: using existing index: __id</span>
<span class="c1">#forderReuseSorting: opt=2, took 0.000s</span>
<span class="c1">#...</span>
</pre></div>
</div>
<p>This feature resolves <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4387">#4387</a>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2947">#2947</a>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4380">#4380</a>, and <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1321">#1321</a>. Thanks to &#64;jangorecki, &#64;jan-glx, and &#64;MichaelChirico for the reports and &#64;jangorecki for implementing.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">set()</span></code> now adds new columns even if no rows are updated, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5409">#5409</a>. This behavior is now consistent with <code class="docutils literal notranslate"><span class="pre">:=</span></code>, thanks to &#64;mb706 for the report and &#64;joshhwuu for the fix.</p></li>
<li><p>The internal <code class="docutils literal notranslate"><span class="pre">init()</span></code> function in the <code class="docutils literal notranslate"><span class="pre">fread.c</span></code> module has been marked as <code class="docutils literal notranslate"><span class="pre">static</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/6328">#6328</a>. This obviates name collisions, and the resulting segfaults, with other libraries visible to the R process that might expose the same symbol name. This was observed in Cray HPE environments where the <code class="docutils literal notranslate"><span class="pre">libsci</span></code> library providing LAPACK to R already has an <code class="docutils literal notranslate"><span class="pre">init</span></code> symbol. Thanks to &#64;rtobar for the report and fix.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">?melt</span></code> has long documented that the returned <code class="docutils literal notranslate"><span class="pre">variable</span></code> column should contain integer column indices when <code class="docutils literal notranslate"><span class="pre">measure.vars</span></code> is a list, but when the list length is 1, <code class="docutils literal notranslate"><span class="pre">variable</span></code> is actually a character column name, which is inconsistent with the documentation, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5209">#5209</a>. To increase consistency in the next release, we plan to change <code class="docutils literal notranslate"><span class="pre">variable</span></code> to integer, so users who were relying on this behavior should change <code class="docutils literal notranslate"><span class="pre">measure.vars=list(&quot;col_name&quot;)</span></code> (<code class="docutils literal notranslate"><span class="pre">variable</span></code> currently is a column name but will be a column index/integer after this planned change) to <code class="docutils literal notranslate"><span class="pre">measure.vars=&quot;col_name&quot;</span></code> (<code class="docutils literal notranslate"><span class="pre">variable</span></code> is column name before and after the planned change). For now, relying on this undocumented behavior throws a new warning.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">?dcast</span></code> has always required <code class="docutils literal notranslate"><span class="pre">fun.aggregate</span></code> to return a single value, and when <code class="docutils literal notranslate"><span class="pre">fill=NULL</span></code>, <code class="docutils literal notranslate"><span class="pre">dcast</span></code> would indeed error if a vector with <code class="docutils literal notranslate"><span class="pre">length!=1</span></code> was returned, but an undefined result was silently returned for non-<code class="docutils literal notranslate"><span class="pre">NULL</span></code> fill. Now <code class="docutils literal notranslate"><span class="pre">dcast()</span></code> will additionally warn that this is undefined behavior when fill is not <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/6032">#6032</a>. In particular, this will warn for <code class="docutils literal notranslate"><span class="pre">fun.aggregate=identity</span></code>, which was observed in several revdeps. We may change this to an error in a future release, so revdeps should fix their code as soon as possible. Thanks to &#64;tdhock for the PR, and &#64;MichaelChirico for analysis of GitHub revdeps.</p></li>
</ol>
</section>
<section id="translations">
<h2>TRANSLATIONS<a class="headerlink" href="#translations" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Fix a typo in a Mandarin translation of an error message that was hiding the actual error message, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/6172">#6172</a>. Thanks &#64;trafficfan for the report and &#64;MichaelChirico for the fix.</p></li>
<li><p>data.table is now translated into Brazilian Portuguese (<a class="reference external" href="https://github.com/orgs/Rdatatable/teams/brazil"><code class="docutils literal notranslate"><span class="pre">pt_BR</span></code></a>) and Spanish (<a class="reference external" href="https://github.com/orgs/Rdatatable/teams/spanish"><code class="docutils literal notranslate"><span class="pre">es</span></code></a>) as well as Mandarin (<code class="docutils literal notranslate"><span class="pre">zh_CN</span></code>). Thanks to the new translation teams consisting initially of &#64;rffontenelle, &#64;leofontenelle, and &#64;italo-07 for Portuguese; and &#64;rikivallalba, &#64;rivaquiroga, and &#64;MaraDestefanis for Spanish. The teams are open if you’d also like to join and support maintenance of these translations.</p></li>
<li><p>A more helpful error message for using <code class="docutils literal notranslate"><span class="pre">:=</span></code> inside the first argument (<code class="docutils literal notranslate"><span class="pre">i</span></code>) of <code class="docutils literal notranslate"><span class="pre">[.data.table</span></code> is now available in translation, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/6293">#6293</a>. Previously, the code to display this assumed an earlier message was printed in English. The solution is for calling <code class="docutils literal notranslate"><span class="pre">:=</span></code> directly (i.e., outside the second argument <code class="docutils literal notranslate"><span class="pre">j</span></code> of <code class="docutils literal notranslate"><span class="pre">[.data.table</span></code>) to throw an error of class <code class="docutils literal notranslate"><span class="pre">dt_invalid_let_error</span></code>. Thanks to Spanish translator &#64;rikivillalba for spotting the issue and &#64;MichaelChirico for the fix.</p></li>
</ol>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="data-table-v1-15-4-27-march-2024">
<h1>data.table <a class="reference external" href="https://github.com/Rdatatable/data.table/milestone/33">v1.15.4</a> (27 March 2024)<a class="headerlink" href="#data-table-v1-15-4-27-march-2024" title="Link to this heading">#</a></h1>
<section id="id4">
<h2>BUG FIXES<a class="headerlink" href="#id4" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Optimized <code class="docutils literal notranslate"><span class="pre">shift</span></code> per group produced wrong results when simultaneously subsetting, for example, <code class="docutils literal notranslate"><span class="pre">DT[i==1L,</span> <span class="pre">shift(x),</span> <span class="pre">by=group]</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5962">#5962</a>. Thanks to &#64;renkun-ken for the report and Benjamin Schwendinger for the fix.</p></li>
</ol>
</section>
<section id="id5">
<h2>NOTES<a class="headerlink" href="#id5" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Updated a test relying on <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> working for comparing language objects to a string, which will be deprecated by R, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5977">#5977</a>; no user-facing effect. Thanks to R-core for continuously improving the language.</p></li>
</ol>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="data-table-v1-15-2-27-feb-2024">
<h1>data.table <a class="reference external" href="https://github.com/Rdatatable/data.table/milestone/32">v1.15.2</a> (27 Feb 2024)<a class="headerlink" href="#data-table-v1-15-2-27-feb-2024" title="Link to this heading">#</a></h1>
<section id="id6">
<h2>BUG FIXES<a class="headerlink" href="#id6" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>An error in <code class="docutils literal notranslate"><span class="pre">fwrite()</span></code> is more robust across platforms – CRAN found the use of <code class="docutils literal notranslate"><span class="pre">PRId64</span></code> does not always match the output of <code class="docutils literal notranslate"><span class="pre">xlength()</span></code>, e.g. on some Mac M1 builds <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5935">#5935</a>. Thanks CRAN for identifying the issue and &#64;ben-schwen for the fix.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shift()</span></code> of a vector in grouped queries (under GForce) returns a vector, consistent with <code class="docutils literal notranslate"><span class="pre">shift()</span></code> in other contexts, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5939">#5939</a>. Thanks &#64;shrektan for the report and &#64;MichaelChirico for the fix.</p></li>
</ol>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="data-table-v1-15-0-30-jan-2024">
<h1>data.table <a class="reference external" href="https://github.com/Rdatatable/data.table/milestone/29">v1.15.0</a>  (30 Jan 2024)<a class="headerlink" href="#data-table-v1-15-0-30-jan-2024" title="Link to this heading">#</a></h1>
<section id="breaking-change">
<h2>BREAKING CHANGE<a class="headerlink" href="#breaking-change" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">shift</span></code> and <code class="docutils literal notranslate"><span class="pre">nafill</span></code> will now raise error <code class="docutils literal notranslate"><span class="pre">input</span> <span class="pre">must</span> <span class="pre">not</span> <span class="pre">be</span> <span class="pre">matrix</span> <span class="pre">or</span> <span class="pre">array</span></code> when <code class="docutils literal notranslate"><span class="pre">matrix</span></code> or <code class="docutils literal notranslate"><span class="pre">array</span></code> is provided on input, rather than giving useless result, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5287">#5287</a>. Thanks to &#64;ethanbsmith for reporting.</p></li>
</ol>
</section>
<section id="id7">
<h2>NEW FEATURES<a class="headerlink" href="#id7" title="Link to this heading">#</a></h2>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">nafill()</span></code> now applies <code class="docutils literal notranslate"><span class="pre">fill=</span></code> to the front/back of the vector when <code class="docutils literal notranslate"><span class="pre">type=&quot;locf|nocb&quot;</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3594">#3594</a>. Thanks to &#64;ben519 for the feature request. It also now returns a named object based on the input names. Note that if you are considering joining and then using <code class="docutils literal notranslate"><span class="pre">nafill(...,type='locf|nocb')</span></code> afterwards, please review <code class="docutils literal notranslate"><span class="pre">roll=</span></code>/<code class="docutils literal notranslate"><span class="pre">rollends=</span></code> which should achieve the same result in one step more efficiently. <code class="docutils literal notranslate"><span class="pre">nafill()</span></code> is for when filling-while-joining (i.e. <code class="docutils literal notranslate"><span class="pre">roll=</span></code>/<code class="docutils literal notranslate"><span class="pre">rollends=</span></code>/<code class="docutils literal notranslate"><span class="pre">nomatch=</span></code>) cannot be applied.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mean(na.rm=TRUE)</span></code> by group is now GForce optimized, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4849">#4849</a>. Thanks to the <a class="reference external" href="https://github.com/h2oai/db-benchmark">h2oai/db-benchmark</a> project for spotting this issue. The 1 billion row example in the issue shows 48s reduced to 14s. The optimization also applies to type <code class="docutils literal notranslate"><span class="pre">integer64</span></code> resulting in a difference to the <code class="docutils literal notranslate"><span class="pre">bit64::mean.integer64</span></code> method: <code class="docutils literal notranslate"><span class="pre">data.table</span></code> returns a <code class="docutils literal notranslate"><span class="pre">double</span></code> result whereas <code class="docutils literal notranslate"><span class="pre">bit64</span></code> rounds the mean to the nearest integer.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fwrite()</span></code> now writes UTF-8 or native csv files by specifying the <code class="docutils literal notranslate"><span class="pre">encoding=</span></code> argument, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/1770">#1770</a>. Thanks to &#64;shrektan for the request and the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data.table()</span></code> no longer fills empty vectors with <code class="docutils literal notranslate"><span class="pre">NA</span></code> with warning. Instead a 0-row <code class="docutils literal notranslate"><span class="pre">data.table</span></code> is returned, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3727">#3727</a>. Since <code class="docutils literal notranslate"><span class="pre">data.table()</span></code> is used internally by <code class="docutils literal notranslate"><span class="pre">.()</span></code>, this brings the following examples in line with expectations in most cases. Thanks to &#64;shrektan for the suggestion and PR.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">data.table</span><span class="p">(</span><span class="n">A</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="o">=</span><span class="kc">letters</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">])</span>
<span class="n">DT</span><span class="p">[</span><span class="n">A</span><span class="o">&gt;</span><span class="m">3</span><span class="p">,</span><span class="w">   </span><span class="nf">.</span><span class="p">(</span><span class="n">ITEM</span><span class="o">=</span><span class="s">&#39;A&gt;3&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">)]</span><span class="w">  </span><span class="c1"># (1)</span>
<span class="n">DT</span><span class="p">[</span><span class="n">A</span><span class="o">&gt;</span><span class="m">3</span><span class="p">][,</span><span class="w"> </span><span class="nf">.</span><span class="p">(</span><span class="n">ITEM</span><span class="o">=</span><span class="s">&#39;A&gt;3&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">)]</span><span class="w">  </span><span class="c1"># (2)</span>
<span class="c1"># the above are now equivalent as expected and return:</span>
<span class="n">Empty</span><span class="w"> </span><span class="nf">data.table </span><span class="p">(</span><span class="m">0</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="n">cols</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">ITEM</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">B</span>
<span class="c1"># Previously, (2) returned :</span>
<span class="w">      </span><span class="n">ITEM</span><span class="w">     </span><span class="n">A</span><span class="w">      </span><span class="n">B</span>
<span class="w">   </span><span class="o">&lt;</span><span class="n">char</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">int</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">char</span><span class="o">&gt;</span>
<span class="m">1</span><span class="o">:</span><span class="w">    </span><span class="n">A</span><span class="o">&gt;</span><span class="m">3</span><span class="w">    </span><span class="kc">NA</span><span class="w">   </span><span class="o">&lt;</span><span class="kc">NA</span><span class="o">&gt;</span>
<span class="n">Warning</span><span class="w"> </span><span class="n">messages</span><span class="o">:</span>
<span class="m">1</span><span class="o">:</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="nf">as.data.table.list</span><span class="p">(</span><span class="n">jval</span><span class="p">,</span><span class="w"> </span><span class="n">.named</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">:</span>
<span class="w">  </span><span class="n">Item</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">longest</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span><span class="n">filled</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="kc">NA</span>
<span class="m">2</span><span class="o">:</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="nf">as.data.table.list</span><span class="p">(</span><span class="n">jval</span><span class="p">,</span><span class="w"> </span><span class="n">.named</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">:</span>
<span class="w">  </span><span class="n">Item</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">longest</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span><span class="n">filled</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="kc">NA</span>
</pre></div>
</div>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">data.table</span><span class="p">(</span><span class="n">A</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="o">=</span><span class="kc">letters</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">],</span><span class="w"> </span><span class="n">key</span><span class="o">=</span><span class="s">&quot;A&quot;</span><span class="p">)</span>
<span class="n">DT</span><span class="p">[</span><span class="nf">.</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="nf">double</span><span class="p">()),</span><span class="w"> </span><span class="n">B</span><span class="p">]</span>
<span class="c1"># new result :</span>
<span class="nf">character</span><span class="p">(</span><span class="m">0</span><span class="p">)</span>
<span class="c1"># old result :</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="w"> </span><span class="s">&quot;c&quot;</span>
<span class="n">Warning</span><span class="w"> </span><span class="n">message</span><span class="o">:</span>
<span class="n">In</span><span class="w"> </span><span class="nf">as.data.table.list</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">:</span>
<span class="w">  </span><span class="n">Item</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">longest</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="m">3</span><span class="p">;</span><span class="w"> </span><span class="n">filled</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="kc">NA</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">%like%</span></code> on factors with a large number of levels is now faster, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4748">#4748</a>. The example in the PR shows 2.37s reduced to 0.86s on a factor length 100 million containing 1 million unique 10-character strings. Thanks to &#64;statquant for reporting, and &#64;shrektan for implementing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keyby=</span></code> now accepts <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>/<code class="docutils literal notranslate"><span class="pre">FALSE</span></code> together with <code class="docutils literal notranslate"><span class="pre">by=</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4307">#4307</a>. The primary motivation is benchmarking where <code class="docutils literal notranslate"><span class="pre">by=</span></code> vs <code class="docutils literal notranslate"><span class="pre">keyby=</span></code> is varied across a set of queries. Thanks to Jan Gorecki for the request and the PR.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span><span class="p">[,</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">colB</span><span class="p">),</span><span class="w"> </span><span class="n">keyby</span><span class="o">=</span><span class="s">&quot;colA&quot;</span><span class="p">]</span>
<span class="n">DT</span><span class="p">[,</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">colB</span><span class="p">),</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s">&quot;colA&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">keyby</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">]</span><span class="w">   </span><span class="c1"># same</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">fwrite()</span></code> gains a new <code class="docutils literal notranslate"><span class="pre">datatable.fwrite.sep</span></code> option to change the default separator, still <code class="docutils literal notranslate"><span class="pre">&quot;,&quot;</span></code> by default. Thanks to Tony Fischetti for the PR. As is good practice in R in general, we usually resist new global options for the reason that a user changing the option for their own code can inadvertently change the behaviour of any package using <code class="docutils literal notranslate"><span class="pre">data.table</span></code> too. However, in this case, the global option affects file output rather than code behaviour. In fact, the very reason the user may wish to change the default separator is that they know a different separator is more appropriate for their data being passed to the package using <code class="docutils literal notranslate"><span class="pre">fwrite</span></code> but cannot otherwise change the <code class="docutils literal notranslate"><span class="pre">fwrite</span></code> call within that package.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">melt()</span></code> now supports <code class="docutils literal notranslate"><span class="pre">NA</span></code> entries when specifying a list of <code class="docutils literal notranslate"><span class="pre">measure.vars</span></code>, which translate into runs of missing values in the output. Useful for melting wide data with some missing columns, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4027">#4027</a>. Thanks to &#64;vspinu for reporting, and &#64;tdhock for implementing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">melt()</span></code> now supports multiple output variable columns via the <code class="docutils literal notranslate"><span class="pre">variable_table</span></code> attribute of <code class="docutils literal notranslate"><span class="pre">measure.vars</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3396">#3396</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2575">#2575</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2551">#2551</a>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4998">#4998</a>. It should be a <code class="docutils literal notranslate"><span class="pre">data.table</span></code> with one row that describes each element of the <code class="docutils literal notranslate"><span class="pre">measure.vars</span></code> vector(s). These data/columns are copied to the output instead of the usual variable column. This is backwards compatible since the previous behavior (one output variable column) is used when there is no <code class="docutils literal notranslate"><span class="pre">variable_table</span></code>. New functions <code class="docutils literal notranslate"><span class="pre">measure()</span></code> and <code class="docutils literal notranslate"><span class="pre">measurev()</span></code> which use either a separator or a regex to create a <code class="docutils literal notranslate"><span class="pre">measure.vars</span></code> list/vector with <code class="docutils literal notranslate"><span class="pre">variable_table</span></code> attribute; useful for melting data that has several distinct pieces of information encoded in each column name. See new <code class="docutils literal notranslate"><span class="pre">?measure</span></code> and new section in reshape vignette. Thanks to Matthias Gomolka, Ananda Mahto, Hugh Parsonage, Mark Fairbanks for reporting, and to Toby Dylan Hocking for implementing. Thanks to &#64;keatingw for testing before release, requesting <code class="docutils literal notranslate"><span class="pre">measure()</span></code> accept single groups too <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5065">#5065</a>, and Toby for implementing.</p></li>
<li><p>A new interface for <em>programming on data.table</em> has been added, closing <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2655">#2655</a> and many other linked issues. It is built using base R’s <code class="docutils literal notranslate"><span class="pre">substitute</span></code>-like interface via a new <code class="docutils literal notranslate"><span class="pre">env</span></code> argument to <code class="docutils literal notranslate"><span class="pre">[.data.table</span></code>. For details see the new vignette <em>programming on data.table</em>, and the new <code class="docutils literal notranslate"><span class="pre">?substitute2</span></code> manual page. Thanks to numerous users for filing requests, and Jan Gorecki for implementing.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">data.table</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="o">:</span><span class="m">1</span><span class="p">)</span>

<span class="c1"># parameters</span>
<span class="n">in_col_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;x&quot;</span>
<span class="n">fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sum&quot;</span>
<span class="n">fun_arg1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;na.rm&quot;</span>
<span class="n">fun_arg1val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span>
<span class="n">out_col_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sum_x&quot;</span>

<span class="c1"># parameterized query</span>
<span class="c1">#DT[, .(out_col_name = fun(in_col_name, fun_arg1=fun_arg1val))]</span>

<span class="c1"># desired query</span>
<span class="n">DT</span><span class="p">[,</span><span class="w"> </span><span class="nf">.</span><span class="p">(</span><span class="n">sum_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">))]</span>

<span class="c1"># new interface</span>
<span class="n">DT</span><span class="p">[,</span><span class="w"> </span><span class="nf">.</span><span class="p">(</span><span class="n">out_col_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fun</span><span class="p">(</span><span class="n">in_col_name</span><span class="p">,</span><span class="w"> </span><span class="n">fun_arg1</span><span class="o">=</span><span class="n">fun_arg1val</span><span class="p">)),</span>
<span class="w">  </span><span class="n">env</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span>
<span class="w">    </span><span class="n">in_col_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;x&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sum&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">fun_arg1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;na.rm&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">fun_arg1val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span>
<span class="w">    </span><span class="n">out_col_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sum_x&quot;</span>
<span class="w">  </span><span class="p">)]</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">if</span> <span class="pre">(...)</span> <span class="pre">.(a=1L)</span> <span class="pre">else</span> <span class="pre">.(a=1L,</span> <span class="pre">b=2L),</span> <span class="pre">by=group]</span></code> now returns a 1-column result with warning <code class="docutils literal notranslate"><span class="pre">j</span> <span class="pre">may</span> <span class="pre">not</span> <span class="pre">evaluate</span> <span class="pre">to</span> <span class="pre">the</span> <span class="pre">same</span> <span class="pre">number</span> <span class="pre">of</span> <span class="pre">columns</span> <span class="pre">for</span> <span class="pre">each</span> <span class="pre">group</span></code>, rather than error <code class="docutils literal notranslate"><span class="pre">'names'</span> <span class="pre">attribute</span> <span class="pre">[2]</span> <span class="pre">must</span> <span class="pre">be</span> <span class="pre">the</span> <span class="pre">same</span> <span class="pre">length</span> <span class="pre">as</span> <span class="pre">the</span> <span class="pre">vector</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4274">#4274</a>. Thanks to &#64;robitalec for reporting, and Michael Chirico for the PR.</p></li>
<li><p>Typo checking in <code class="docutils literal notranslate"><span class="pre">i</span></code> available since 1.11.4 is extended to work in non-English sessions, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4989">#4989</a>. Thanks to Michael Chirico for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fifelse()</span></code> now coerces logical <code class="docutils literal notranslate"><span class="pre">NA</span></code> to other types and the <code class="docutils literal notranslate"><span class="pre">na</span></code> argument supports vectorized input, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4277">#4277</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4286">#4286</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4287">#4287</a>. Thanks to &#64;michaelchirico and &#64;shrektan for reporting, and &#64;shrektan for implementing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.datatable.aware</span></code> is now recognized in the calling environment in addition to the namespace of the calling package, <a class="reference external" href="https://github.com/tidyverse/dtplyr/issues/184">dtplyr#184</a>. Thanks to Hadley Wickham for the idea and PR.</p></li>
<li><p>New convenience function <code class="docutils literal notranslate"><span class="pre">%plike%</span></code> maps to <code class="docutils literal notranslate"><span class="pre">like(...,</span> <span class="pre">perl=TRUE)</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3702">#3702</a>. <code class="docutils literal notranslate"><span class="pre">%plike%</span></code> uses Perl-compatible regular expressions (PCRE) which extend TRE, and may be more efficient in some cases. Thanks &#64;KyleHaynes for the suggestion and PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fwrite()</span></code> now accepts <code class="docutils literal notranslate"><span class="pre">sep=&quot;&quot;</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4817">#4817</a>. The motivation is an example where the result of <code class="docutils literal notranslate"><span class="pre">paste0()</span></code> needs to be written to file but <code class="docutils literal notranslate"><span class="pre">paste0()</span></code> takes 40 minutes due to constructing a very large number of unique long strings in R’s global character cache. Allowing <code class="docutils literal notranslate"><span class="pre">fwrite(,</span> <span class="pre">sep=&quot;&quot;)</span></code> avoids the <code class="docutils literal notranslate"><span class="pre">paste0</span></code> and saves 40 mins. Thanks to Jan Gorecki for the request, and Ben Schwen for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data.table</span></code> printing now supports customizable methods for both columns and list column row items, part of <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1523">#1523</a>. <code class="docutils literal notranslate"><span class="pre">format_col</span></code> is S3-generic for customizing how to print whole columns and by default defers to the S3 <code class="docutils literal notranslate"><span class="pre">format</span></code> method for the column’s class if one exists; e.g. <code class="docutils literal notranslate"><span class="pre">format.sfc</span></code> for geometry columns from the <code class="docutils literal notranslate"><span class="pre">sf</span></code> package, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2273">#2273</a>. Similarly, <code class="docutils literal notranslate"><span class="pre">format_list_item</span></code> is S3-generic for customizing how to print each row of list columns (which lack a format method at a column level) and also by default defers to the S3 <code class="docutils literal notranslate"><span class="pre">format</span></code> method for that item’s class if one exists. Thanks to &#64;mllg who initially filed <a class="reference external" href="https://github.com/Rdatatable/data.table/pulls/3338">#3338</a> with the seed of the idea, &#64;franknarf1 who earlier suggested the idea of providing custom formatters, &#64;fparages who submitted a patch to improve the printing of timezones for <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2842">#2842</a>, &#64;RichardRedding for pointing out an error relating to printing wide <code class="docutils literal notranslate"><span class="pre">expression</span></code> columns in <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3011">#3011</a>, &#64;JoshOBrien for improving the output for geometry columns, and &#64;MichaelChirico for implementing. See <code class="docutils literal notranslate"><span class="pre">?print.data.table</span></code> for examples.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tstrsplit(,type.convert=)</span></code> now accepts a named list of functions to apply to each part, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5094">#5094</a>. Thanks to &#64;Kamgang-B for the request and implementing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.data.table(DF,</span> <span class="pre">keep.rownames=key='keyCol')</span></code> now works, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4468">#4468</a>. Thanks to Michael Chirico for the idea and the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dcast()</span></code> now supports complex values in <code class="docutils literal notranslate"><span class="pre">value.var</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4855">#4855</a>. This extends earlier support for complex values in <code class="docutils literal notranslate"><span class="pre">formula</span></code>. Thanks Elio Campitelli for the request, and Michael Chirico for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">melt()</span></code> was pseudo generic in that <code class="docutils literal notranslate"><span class="pre">melt(DT)</span></code> would dispatch to the <code class="docutils literal notranslate"><span class="pre">melt.data.table</span></code> method but <code class="docutils literal notranslate"><span class="pre">melt(not-DT)</span></code> would explicitly redirect to <code class="docutils literal notranslate"><span class="pre">reshape2</span></code>. Now <code class="docutils literal notranslate"><span class="pre">melt()</span></code> is standard generic so that methods can be developed in other packages, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/4864">#4864</a>. Thanks to &#64;odelmarcelle for suggesting and implementing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[i,</span> <span class="pre">nomatch=NULL]</span></code> where <code class="docutils literal notranslate"><span class="pre">i</span></code> contains row numbers now excludes <code class="docutils literal notranslate"><span class="pre">NA</span></code> and any outside the range [1,nrow], <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3109">#3109</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3666">#3666</a>. Before, <code class="docutils literal notranslate"><span class="pre">NA</span></code> rows were returned always for such values; i.e. <code class="docutils literal notranslate"><span class="pre">nomatch=0|NULL</span></code> was ignored. Thanks Michel Lang and Hadley Wickham for the requests, and Jan Gorecki for the PR. Using <code class="docutils literal notranslate"><span class="pre">nomatch=0</span></code> in this case when <code class="docutils literal notranslate"><span class="pre">i</span></code> is row numbers generates the warning <code class="docutils literal notranslate"><span class="pre">Please</span> <span class="pre">use</span> <span class="pre">nomatch=NULL</span> <span class="pre">instead</span> <span class="pre">of</span> <span class="pre">nomatch=0;</span> <span class="pre">see</span> <span class="pre">news</span> <span class="pre">item</span> <span class="pre">5</span> <span class="pre">in</span> <span class="pre">v1.12.0</span> <span class="pre">(Jan</span> <span class="pre">2019)</span></code>.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">data.table</span><span class="p">(</span><span class="n">A</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">)</span>
<span class="n">DT</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1L</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="m">3L</span><span class="p">,</span><span class="w"> </span><span class="m">5L</span><span class="p">)]</span><span class="w">  </span><span class="c1"># default nomatch=NA</span>
<span class="c1">#        A</span>
<span class="c1">#    &lt;int&gt;</span>
<span class="c1"># 1:     1</span>
<span class="c1"># 2:    NA</span>
<span class="c1"># 3:     3</span>
<span class="c1"># 4:    NA</span>
<span class="n">DT</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1L</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="m">3L</span><span class="p">,</span><span class="w"> </span><span class="m">5L</span><span class="p">),</span><span class="w"> </span><span class="n">nomatch</span><span class="o">=</span><span class="kc">NULL</span><span class="p">]</span>
<span class="c1">#        A</span>
<span class="c1">#    &lt;int&gt;</span>
<span class="c1"># 1:     1</span>
<span class="c1"># 2:     3</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">head(.SD,n),</span> <span class="pre">by=grp]</span></code> and <code class="docutils literal notranslate"><span class="pre">tail</span></code> are now optimized when <code class="docutils literal notranslate"><span class="pre">n&gt;1</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5060">#5060</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/523#issuecomment-162934391">#523</a>. <code class="docutils literal notranslate"><span class="pre">n==1</span></code> was already optimized. Thanks to Jan Gorecki and Michael Young for requesting, and Benjamin Schwendinger for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setcolorder()</span></code> gains <code class="docutils literal notranslate"><span class="pre">before=</span></code> and <code class="docutils literal notranslate"><span class="pre">after=</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4358">#4358</a>. Thanks to Matthias Gomolka for the request, and both Benjamin Schwendinger and Xianghui Dong for implementing. Also thanks to Manuel López-Ibáñez for testing dev and mentioning needed documentation before release.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">base::droplevels()</span></code> gains a fast method for <code class="docutils literal notranslate"><span class="pre">data.table</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/647">#647</a>. Thanks to Steve Lianoglou for requesting, Boniface Kamgang and Martin Binder for testing, and Jan Gorecki and Benjamin Schwendinger for the PR. <code class="docutils literal notranslate"><span class="pre">fdroplevels()</span></code> for use on vectors has also been added.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shift()</span></code> now also supports <code class="docutils literal notranslate"><span class="pre">type=&quot;cyclic&quot;</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4451">#4451</a>. Arguments that are normally pushed out by <code class="docutils literal notranslate"><span class="pre">type=&quot;lag&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">type=&quot;lead&quot;</span></code> are re-introduced at this type at the first/last positions. Thanks to &#64;RicoDiel for requesting, and Benjamin Schwendinger for the PR.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># Usage</span>
<span class="nf">shift</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="m">-1</span><span class="o">:</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;cyclic&quot;</span><span class="p">)</span>
<span class="c1"># [[1]]</span>
<span class="c1"># [1] 2 3 4 5 1</span>
<span class="c1">#</span>
<span class="c1"># [[2]]</span>
<span class="c1"># [1] 1 2 3 4 5</span>
<span class="c1">#</span>
<span class="c1"># [[3]]</span>
<span class="c1"># [1] 5 1 2 3 4</span>

<span class="c1"># Benchmark</span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="m">1e9</span><span class="p">)</span><span class="w"> </span><span class="c1"># 3.7 GB</span>
<span class="n">microbenchmark</span><span class="o">::</span><span class="nf">microbenchmark</span><span class="p">(</span>
<span class="w">  </span><span class="nf">shift</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;cyclic&quot;</span><span class="p">),</span>
<span class="w">  </span><span class="nf">c</span><span class="p">(</span><span class="nf">tail</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="nf">head</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="m">-1</span><span class="p">)),</span>
<span class="w">  </span><span class="n">times</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10L</span><span class="p">,</span>
<span class="w">  </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;s&quot;</span>
<span class="p">)</span>
<span class="c1"># Unit: seconds</span>
<span class="c1">#                          expr  min   lq mean  median   uq  max neval</span>
<span class="c1">#  shift(x, 1, type = &quot;cyclic&quot;) 1.57 1.67 1.71    1.68 1.70 2.03    10</span>
<span class="c1">#    c(tail(x, 1), head(x, -1)) 6.96 7.16 7.49    7.32 7.64 8.60    10</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread()</span></code> now supports “0” and “1” in <code class="docutils literal notranslate"><span class="pre">na.strings</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2927">#2927</a>. Previously this was not permitted since “0” and “1” can be recognized as boolean values. Note that it is still not permitted to use “0” and “1” in <code class="docutils literal notranslate"><span class="pre">na.strings</span></code> in combination with <code class="docutils literal notranslate"><span class="pre">logical01</span> <span class="pre">=</span> <span class="pre">TRUE</span></code>. Thanks to &#64;msgoussi for the request, and Benjamin Schwendinger for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setkey()</span></code> now supports type <code class="docutils literal notranslate"><span class="pre">raw</span></code> as value columns (not as key columns), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5100">#5100</a>. Thanks Hugh Parsonage for requesting, and Benjamin Schwendinger for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shift()</span></code> is now optimized by group, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1534">#1534</a>. Thanks to Gerhard Nachtmann for requesting, and Benjamin Schwendinger for the PR. Thanks to &#64;neovom for testing dev and filing a bug report, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5547">#5547</a> which was fixed before release. This helped also in improving the logic for when to turn on optimization by group in general, making it more robust.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1e7</span>
<span class="n">DT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">data.table</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nf">sample</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="nf">sample</span><span class="p">(</span><span class="m">1e6</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="kc">TRUE</span><span class="p">))</span>
<span class="n">shift_no_opt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shift</span><span class="w">  </span><span class="c1"># different name not optimized as a way to compare</span>
<span class="nf">microbenchmark</span><span class="p">(</span>
<span class="w">  </span><span class="n">DT</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="nf">head</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="m">-1</span><span class="p">)),</span><span class="w"> </span><span class="n">y</span><span class="p">],</span>
<span class="w">  </span><span class="n">DT</span><span class="p">[,</span><span class="w"> </span><span class="nf">shift_no_opt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;lag&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="p">],</span>
<span class="w">  </span><span class="n">DT</span><span class="p">[,</span><span class="w"> </span><span class="nf">shift</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;lag&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="p">],</span>
<span class="w">  </span><span class="n">times</span><span class="o">=</span><span class="m">10L</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="o">=</span><span class="s">&quot;s&quot;</span><span class="p">)</span>
<span class="c1"># Unit: seconds</span>
<span class="c1">#                                       expr     min      lq    mean  median      uq     max neval</span>
<span class="c1">#                DT[, c(NA, head(x, -1)), y]  8.7620  9.0240  9.1870  9.2800  9.3700  9.4110    10</span>
<span class="c1">#  DT[, shift_no_opt(x, 1, type = &quot;lag&quot;), y] 20.5500 20.9000 21.1600 21.3200 21.4400 21.5200    10</span>
<span class="c1">#         DT[, shift(x, 1, type = &quot;lag&quot;), y]  0.4865  0.5238  0.5463  0.5446  0.5725  0.5982    10</span>
</pre></div>
</div>
<p>Example from <a class="reference external" href="https://stackoverflow.com/questions/35179911/shift-in-data-table-v1-9-6-is-slow-for-many-groups">stackoverflow</a></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">set.seed</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
<span class="n">mg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">data.table</span><span class="p">(</span><span class="nf">expand.grid</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="m">2012</span><span class="o">:</span><span class="m">2016</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">1000</span><span class="p">),</span>
<span class="w">                </span><span class="n">value</span><span class="o">=</span><span class="nf">rnorm</span><span class="p">(</span><span class="m">5000</span><span class="p">))</span>
<span class="nf">microbenchmark</span><span class="p">(</span><span class="n">v1.9.4</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">mg</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="m">-1</span><span class="p">],</span><span class="w"> </span><span class="kc">NA</span><span class="p">),</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="n">id</span><span class="p">],</span>
<span class="w">               </span><span class="n">v1.9.6</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">mg</span><span class="p">[,</span><span class="w"> </span><span class="nf">shift_no_opt</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;lead&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="n">id</span><span class="p">],</span>
<span class="w">               </span><span class="n">v1.14.4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mg</span><span class="p">[,</span><span class="w"> </span><span class="nf">shift</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;lead&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="n">id</span><span class="p">],</span>
<span class="w">               </span><span class="n">unit</span><span class="o">=</span><span class="s">&quot;ms&quot;</span><span class="p">)</span>
<span class="c1"># Unit: milliseconds</span>
<span class="c1">#     expr     min      lq    mean  median      uq    max neval</span>
<span class="c1">#   v1.9.4  3.6600  3.8250  4.4930  4.1720  4.9490 11.700   100</span>
<span class="c1">#   v1.9.6 18.5400 19.1800 21.5100 20.6900 23.4200 29.040   100</span>
<span class="c1">#  v1.14.4  0.4826  0.5586  0.6586  0.6329  0.7348  1.318   100</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">rbind()</span></code> and <code class="docutils literal notranslate"><span class="pre">rbindlist()</span></code> now support <code class="docutils literal notranslate"><span class="pre">fill=TRUE</span></code> with <code class="docutils literal notranslate"><span class="pre">use.names=FALSE</span></code> instead of issuing the warning <code class="docutils literal notranslate"><span class="pre">use.names=</span> <span class="pre">cannot</span> <span class="pre">be</span> <span class="pre">FALSE</span> <span class="pre">when</span> <span class="pre">fill</span> <span class="pre">is</span> <span class="pre">TRUE.</span> <span class="pre">Setting</span> <span class="pre">use.names=TRUE.</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5444">#5444</a>. Thanks to &#64;sindribaldur, &#64;dcaseykc, &#64;fox34, &#64;adrian-quintario and &#64;berg-michael for testing dev and filing a bug report which was fixed before release.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">DT1</span>
<span class="c1">#        A     B</span>
<span class="c1">#    &lt;int&gt; &lt;int&gt;</span>
<span class="c1"># 1:     1     5</span>
<span class="c1"># 2:     2     6</span>

<span class="n">DT2</span>
<span class="c1">#      foo</span>
<span class="c1">#    &lt;int&gt;</span>
<span class="c1"># 1:     3</span>
<span class="c1"># 2:     4</span>

<span class="nf">rbind</span><span class="p">(</span><span class="n">DT1</span><span class="p">,</span><span class="w"> </span><span class="n">DT2</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">   </span><span class="c1"># no change</span>
<span class="c1">#        A     B   foo</span>
<span class="c1">#    &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="c1"># 1:     1     5    NA</span>
<span class="c1"># 2:     2     6    NA</span>
<span class="c1"># 3:    NA    NA     3</span>
<span class="c1"># 4:    NA    NA     4</span>

<span class="nf">rbind</span><span class="p">(</span><span class="n">DT1</span><span class="p">,</span><span class="w"> </span><span class="n">DT2</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">use.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>

<span class="c1"># was:</span>
<span class="c1">#        A     B   foo</span>
<span class="c1">#    &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="c1"># 1:     1     5    NA</span>
<span class="c1"># 2:     2     6    NA</span>
<span class="c1"># 3:    NA    NA     3</span>
<span class="c1"># 4:    NA    NA     4</span>
<span class="c1"># Warning message:</span>
<span class="c1"># In rbindlist(l, use.names, fill, idcol) :</span>
<span class="c1">#   use.names= cannot be FALSE when fill is TRUE. Setting use.names=TRUE.</span>

<span class="c1"># now:</span>
<span class="c1">#        A     B</span>
<span class="c1">#    &lt;int&gt; &lt;int&gt;</span>
<span class="c1"># 1:     1     5</span>
<span class="c1"># 2:     2     6</span>
<span class="c1"># 3:     3    NA</span>
<span class="c1"># 4:     4    NA</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread()</span></code> already made a good guess as to whether column names are present by comparing the type of the fields in row 1 to the type of the fields in the sample. This guess is now improved when a column contains a string in row 1 (i.e. a potential column name) but all blank in the sample rows, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2526">#2526</a>. Thanks &#64;st-pasha for reporting, and &#64;ben-schwen for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread()</span></code> can now read <code class="docutils literal notranslate"><span class="pre">.zip</span></code> and <code class="docutils literal notranslate"><span class="pre">.tar</span></code> directly, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3834">#3834</a>. Moreover, if a compressed file name is missing its extension, <code class="docutils literal notranslate"><span class="pre">fread()</span></code> now attempts to infer the correct filetype from its magic bytes. Thanks to Michael Chirico for the idea, and Benjamin Schwendinger for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">let(...)]</span></code> is a new alias for the functional form of <code class="docutils literal notranslate"><span class="pre">:=</span></code>; i.e. <code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">':='(...)]</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3795">#3795</a>. Thanks to Elio Campitelli for requesting, and Benjamin Schwendinger for the PR.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">data.table</span><span class="p">(</span><span class="n">A</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">)</span>
<span class="n">DT</span><span class="p">[,</span><span class="w"> </span><span class="nf">let</span><span class="p">(</span><span class="n">B</span><span class="o">=</span><span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="o">=</span><span class="kc">letters</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">])]</span>
<span class="n">DT</span>
<span class="c1">#        A     B      C</span>
<span class="c1">#    &lt;int&gt; &lt;int&gt; &lt;char&gt;</span>
<span class="c1"># 1:     1     3      a</span>
<span class="c1"># 2:     2     4      b</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">weighted.mean()</span></code> is now optimized by group, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3977">#3977</a>. Thanks to &#64;renkun-ken for requesting, and Benjamin Schwendinger for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.xts.data.table()</span></code> now supports non-numeric xts coredata matrixes, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5268">5268</a>. Existing numeric only functionality is supported by a new <code class="docutils literal notranslate"><span class="pre">numeric.only</span></code> parameter, which defaults to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> for backward compatibility and the most common use case. To convert non-numeric columns, set this parameter to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>. Conversions of <code class="docutils literal notranslate"><span class="pre">data.table</span></code> columns to a <code class="docutils literal notranslate"><span class="pre">matrix</span></code> now uses <code class="docutils literal notranslate"><span class="pre">data.table::as.matrix</span></code>, with all its performance benefits. Thanks to &#64;ethanbsmith for the report and fix.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unique.data.table()</span></code> gains <code class="docutils literal notranslate"><span class="pre">cols</span></code> to specify a subset of columns to include in the resulting <code class="docutils literal notranslate"><span class="pre">data.table</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5243">#5243</a>. This saves the memory overhead of subsetting unneeded columns, and provides a cleaner API for a common operation previously needing more convoluted code. Thanks to &#64;MichaelChirico for the suggestion &amp; implementation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">:=</span></code> is now optimized by group, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1414">#1414</a>. Thanks to Arun Srinivasan for suggesting, and Benjamin Schwendinger for the PR. Thanks to &#64;clerousset, &#64;dcaseykc, &#64;OfekShilon, &#64;SeanShao98, and &#64;ben519 for testing dev and filing detailed bug reports which were fixed before release and their tests added to the test suite.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.I</span></code> is now available in <code class="docutils literal notranslate"><span class="pre">by</span></code> for rowwise operations, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1732">#1732</a>. Thanks to Rafael H. M. Pereira for requesting, and Benjamin Schwendinger for the PR.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span>
<span class="c1">#       V1    V2</span>
<span class="c1">#    &lt;int&gt; &lt;int&gt;</span>
<span class="c1"># 1:     3     5</span>
<span class="c1"># 2:     4     6</span>

<span class="n">DT</span><span class="p">[,</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">.SD</span><span class="p">),</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="n">.I</span><span class="p">]</span>
<span class="c1">#        I    V1</span>
<span class="c1">#    &lt;int&gt; &lt;int&gt;</span>
<span class="c1"># 1:     1     8</span>
<span class="c1"># 2:     2    10</span>
</pre></div>
</div>
</li>
<li><p>New functions <code class="docutils literal notranslate"><span class="pre">yearmon()</span></code> and <code class="docutils literal notranslate"><span class="pre">yearqtr</span></code> give a combined representation of <code class="docutils literal notranslate"><span class="pre">year()</span></code> and <code class="docutils literal notranslate"><span class="pre">month()</span></code>/<code class="docutils literal notranslate"><span class="pre">quarter()</span></code>. These and also <code class="docutils literal notranslate"><span class="pre">yday</span></code>, <code class="docutils literal notranslate"><span class="pre">wday</span></code>, <code class="docutils literal notranslate"><span class="pre">mday</span></code>, <code class="docutils literal notranslate"><span class="pre">week</span></code>, <code class="docutils literal notranslate"><span class="pre">month</span></code> and <code class="docutils literal notranslate"><span class="pre">year</span></code> are now optimized for memory and compute efficiency by removing the <code class="docutils literal notranslate"><span class="pre">POSIXlt</span></code> dependency, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/649">#649</a>. Thanks to Matt Dowle for the request, and Benjamin Schwendinger for the PR. Thanks to &#64;berg-michael for testing dev and filing a bug report for special case of missing values which was fixed before release.</p></li>
<li><p>New function <code class="docutils literal notranslate"><span class="pre">%notin%</span></code> provides a convenient alternative to <code class="docutils literal notranslate"><span class="pre">!(x</span> <span class="pre">%in%</span> <span class="pre">y)</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4152">#4152</a>. Thanks to Jan Gorecki for suggesting and Michael Czekanski for the PR. <code class="docutils literal notranslate"><span class="pre">%notin%</span></code> uses half the memory because it computes the result directly as opposed to <code class="docutils literal notranslate"><span class="pre">!</span></code> which allocates a new vector to hold the negated result. If <code class="docutils literal notranslate"><span class="pre">x</span></code> is long enough to occupy more than half the remaining free memory, this can make the difference between the operation working, or failing with an out-of-memory error.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tables()</span></code> is faster by default by excluding the size of character strings in R’s global cache (which may be shared) and excluding the size of list column items (which also may be shared). <code class="docutils literal notranslate"><span class="pre">mb=</span></code> now accepts any function which accepts a <code class="docutils literal notranslate"><span class="pre">data.table</span></code> and returns a higher and better estimate of its size in bytes, albeit more slowly; e.g. <code class="docutils literal notranslate"><span class="pre">mb</span> <span class="pre">=</span> <span class="pre">utils::object.size</span></code>.</p></li>
</ol>
</section>
<section id="id8">
<h2>BUG FIXES<a class="headerlink" href="#id8" title="Link to this heading">#</a></h2>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">by=.EACHI</span></code> when <code class="docutils literal notranslate"><span class="pre">i</span></code> is keyed but <code class="docutils literal notranslate"><span class="pre">on=</span></code> different columns than <code class="docutils literal notranslate"><span class="pre">i</span></code>’s key could create an invalidly keyed result, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4603">#4603</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4911">#4911</a>. Thanks to &#64;myoung3 and &#64;adamaltmejd for reporting, and &#64;ColeMiller1 for the PR. An invalid key is where a <code class="docutils literal notranslate"><span class="pre">data.table</span></code> is marked as sorted by the key columns but the data is not sorted by those columns, leading to incorrect results from subsequent queries.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">print(DT,</span> <span class="pre">trunc.cols=TRUE)</span></code> and the corresponding <code class="docutils literal notranslate"><span class="pre">datatable.print.trunc.cols</span></code> option (new feature 3 in v1.13.0) could incorrectly display an extra column, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4266">#4266</a>. Thanks to &#64;tdhock for the bug report and &#64;MichaelChirico for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread(...,</span> <span class="pre">nrows=0L)</span></code> now works as intended and the same as <code class="docutils literal notranslate"><span class="pre">nrows=0</span></code>; i.e. returning the column names and typed empty columns determined by the large sample, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4686">#4686</a>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4029">#4029</a>. Thanks to &#64;hongyuanjia and &#64;michaelpaulhirsch for reporting, and Benjamin Schwendinger for the PR. Also thanks to &#64;HughParsonage for testing dev and reporting a bug which was fixed before release.</p></li>
<li><p>Passing <code class="docutils literal notranslate"><span class="pre">.SD</span></code> to <code class="docutils literal notranslate"><span class="pre">frankv()</span></code> with <code class="docutils literal notranslate"><span class="pre">ties.method='random'</span></code> or with <code class="docutils literal notranslate"><span class="pre">na.last=NA</span></code> failed with <code class="docutils literal notranslate"><span class="pre">.SD</span> <span class="pre">is</span> <span class="pre">locked</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4429">#4429</a>. Thanks &#64;smarches for the report.</p></li>
<li><p>Filtering data.table using <code class="docutils literal notranslate"><span class="pre">which=NA</span></code> to return non-matching indices will now properly work for non-optimized subsetting as well, closes <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4411">#4411</a>.</p></li>
<li><p>When <code class="docutils literal notranslate"><span class="pre">j</span></code> returns an object whose class <code class="docutils literal notranslate"><span class="pre">&quot;X&quot;</span></code> inherits from <code class="docutils literal notranslate"><span class="pre">data.table</span></code>; i.e. class <code class="docutils literal notranslate"><span class="pre">c(&quot;X&quot;,</span> <span class="pre">&quot;data.table&quot;,</span> <span class="pre">&quot;data.frame&quot;)</span></code>, the derived class <code class="docutils literal notranslate"><span class="pre">&quot;X&quot;</span></code> is no longer incorrectly dropped from the class of the <code class="docutils literal notranslate"><span class="pre">data.table</span></code> returned, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4324">#4324</a>. Thanks to &#64;HJAllen for reporting and &#64;shrektan for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.data.table()</span></code> failed with <code class="docutils literal notranslate"><span class="pre">.subset2(x,</span> <span class="pre">i,</span> <span class="pre">exact</span> <span class="pre">=</span> <span class="pre">exact):</span> <span class="pre">attempt</span> <span class="pre">to</span> <span class="pre">select</span> <span class="pre">less</span> <span class="pre">than</span> <span class="pre">one</span> <span class="pre">element</span> <span class="pre">in</span> <span class="pre">get1index</span></code> when passed an object inheriting from <code class="docutils literal notranslate"><span class="pre">data.table</span></code> with a different <code class="docutils literal notranslate"><span class="pre">[[</span></code> method, such as the class <code class="docutils literal notranslate"><span class="pre">dfidx</span></code> from the <code class="docutils literal notranslate"><span class="pre">dfidx</span></code> package, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4526">#4526</a>. Thanks &#64;RicoDiel for the report, and Michael Chirico for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rbind()</span></code> and <code class="docutils literal notranslate"><span class="pre">rbindlist()</span></code> of length-0 ordered factors failed with <code class="docutils literal notranslate"><span class="pre">Internal</span> <span class="pre">error:</span> <span class="pre">savetl_init</span> <span class="pre">checks</span> <span class="pre">failed</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4795">#4795</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4823">#4823</a>. Thanks to &#64;shrektan and &#64;dbart79 for reporting, and &#64;shrektan for fixing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data.table(NULL)[,</span> <span class="pre">firstCol:=1L]</span></code> created <code class="docutils literal notranslate"><span class="pre">data.table(firstCol=1L)</span></code> ok but did not update the internal <code class="docutils literal notranslate"><span class="pre">row.names</span></code> attribute, causing <code class="docutils literal notranslate"><span class="pre">Error</span> <span class="pre">in</span> <span class="pre">'$&lt;-.data.frame'(x,</span> <span class="pre">name,</span> <span class="pre">value)</span> <span class="pre">:</span> <span class="pre">replacement</span> <span class="pre">has</span> <span class="pre">1</span> <span class="pre">row,</span> <span class="pre">data</span> <span class="pre">has</span> <span class="pre">0</span></code> when passed to packages like <code class="docutils literal notranslate"><span class="pre">ggplot</span></code> which use <code class="docutils literal notranslate"><span class="pre">DT</span></code> as if it is a <code class="docutils literal notranslate"><span class="pre">data.frame</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4597">#4597</a>. Thanks to Matthew Son for reporting, and Cole Miller for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">X[Y,</span> <span class="pre">.SD,</span> <span class="pre">by=]</span></code> (joining and grouping in the same query) could segfault if i) <code class="docutils literal notranslate"><span class="pre">by=</span></code> is supplied custom data (i.e. not simple expressions of columns), and ii) some rows of <code class="docutils literal notranslate"><span class="pre">Y</span></code> do not match to any rows in <code class="docutils literal notranslate"><span class="pre">X</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4892">#4892</a>. Thanks to &#64;Kodiologist for reporting, &#64;ColeMiller1 for investigating, and &#64;tlapak for the PR.</p></li>
<li><p>Assigning a set of 2 or more all-NA values to a factor column could segfault, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4824">#4824</a>. Thanks to &#64;clerousset for reporting and &#64;shrektan for fixing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.data.table(table(NULL))</span></code> now returns <code class="docutils literal notranslate"><span class="pre">data.table(NULL)</span></code> rather than error <code class="docutils literal notranslate"><span class="pre">attempt</span> <span class="pre">to</span> <span class="pre">set</span> <span class="pre">an</span> <span class="pre">attribute</span> <span class="pre">on</span> <span class="pre">NULL</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4179">#4179</a>. The result differs slightly to <code class="docutils literal notranslate"><span class="pre">as.data.frame(table(NULL))</span></code> (0-row, 1-column) because 0-column works better with other <code class="docutils literal notranslate"><span class="pre">data.table</span></code> functions like <code class="docutils literal notranslate"><span class="pre">rbindlist()</span></code>. Thanks to Michael Chirico for the report and fix.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">melt</span></code> with a list for <code class="docutils literal notranslate"><span class="pre">measure.vars</span></code> would output <code class="docutils literal notranslate"><span class="pre">variable</span></code> inconsistently between <code class="docutils literal notranslate"><span class="pre">na.rm=TRUE</span></code> and <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4455">#4455</a>. Thanks to &#64;tdhock for reporting and fixing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">by=...get()...</span></code> could fail with <code class="docutils literal notranslate"><span class="pre">object</span> <span class="pre">not</span> <span class="pre">found</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4873">#4873</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4981">#4981</a>. Thanks to &#64;sindribaldur for reporting, and &#64;OfekShilon for fixing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">print(x,</span> <span class="pre">col.names='none')</span></code> now removes the column names as intended for wide <code class="docutils literal notranslate"><span class="pre">data.table</span></code>s whose column names don’t fit on a single line, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4270">#4270</a>. Thanks to &#64;tdhock for the report, and Michael Chirico for fixing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">min(colB),</span> <span class="pre">by=colA]</span></code> when <code class="docutils literal notranslate"><span class="pre">colB</span></code> is type <code class="docutils literal notranslate"><span class="pre">character</span></code> would miss blank strings (<code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>) at the beginning of a group and return the smallest non-blank instead of blank, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4848">#4848</a>. Thanks to Vadim Khotilovich for reporting and for the PR fixing it.</p></li>
<li><p>Assigning a wrong-length or non-list vector to a list column could segfault, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4166">#4166</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4667">#4667</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4678">#4678</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4729">#4729</a>. Thanks to &#64;fklirono, Kun Ren, &#64;kevinvzandvoort and &#64;peterlittlejohn for reporting, and to Václav Tlapák for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.data.table()</span></code> on <code class="docutils literal notranslate"><span class="pre">xts</span></code> objects containing a column named <code class="docutils literal notranslate"><span class="pre">x</span></code> would return an <code class="docutils literal notranslate"><span class="pre">index</span></code> of type plain <code class="docutils literal notranslate"><span class="pre">integer</span></code> rather than <code class="docutils literal notranslate"><span class="pre">POSIXct</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4897">#4897</a>. Thanks to Emil Sjørup for reporting, and Jan Gorecki for the PR.</p></li>
<li><p>A fix to <code class="docutils literal notranslate"><span class="pre">as.Date(c(&quot;&quot;,</span> <span class="pre">...))</span></code> in R 4.0.3, <a class="reference external" href="https://bugs.r-project.org/show_bug.cgi?id=17909">17909</a>, has been backported to <code class="docutils literal notranslate"><span class="pre">data.table::as.IDate()</span></code> so that it too now returns <code class="docutils literal notranslate"><span class="pre">NA</span></code> for the first item when it is blank, even in older versions of R back to 3.1.0, rather than the incorrect error <code class="docutils literal notranslate"><span class="pre">character</span> <span class="pre">string</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">in</span> <span class="pre">a</span> <span class="pre">standard</span> <span class="pre">unambiguous</span> <span class="pre">format</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4676">#4676</a>. Thanks to Arun Srinivasan for reporting, and Michael Chirico both for the <code class="docutils literal notranslate"><span class="pre">data.table</span></code> PR and for submitting the patch to R that was accepted and included in R 4.0.3.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uniqueN(DT,</span> <span class="pre">by=character())</span></code> is now equivalent to <code class="docutils literal notranslate"><span class="pre">uniqueN(DT)</span></code> rather than internal error <code class="docutils literal notranslate"><span class="pre">'by'</span> <span class="pre">is</span> <span class="pre">either</span> <span class="pre">not</span> <span class="pre">integer</span> <span class="pre">or</span> <span class="pre">is</span> <span class="pre">length</span> <span class="pre">0</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4594">#4594</a>. Thanks Marco Colombo for the report, and Michael Chirico for the PR. Similarly for <code class="docutils literal notranslate"><span class="pre">unique()</span></code>, <code class="docutils literal notranslate"><span class="pre">duplicated()</span></code> and <code class="docutils literal notranslate"><span class="pre">anyDuplicated()</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">melt()</span></code> on a <code class="docutils literal notranslate"><span class="pre">data.table</span></code> with <code class="docutils literal notranslate"><span class="pre">list</span></code> columns for <code class="docutils literal notranslate"><span class="pre">measure.vars</span></code> would silently ignore <code class="docutils literal notranslate"><span class="pre">na.rm=TRUE</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5044">#5044</a>. Now the same logic as <code class="docutils literal notranslate"><span class="pre">is.na()</span></code> from base R is used; i.e. if list element is scalar NA then it is considered missing and removed. Thanks to Toby Dylan Hocking for the PRs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread(fill=TRUE)</span></code> could segfault if the input contained an improperly quoted character field, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4774">#4774</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5041">#5041</a>. Thanks to &#64;AndeolEvain and &#64;e-nascimento for reporting and to Václav Tlapák for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread(fill=TRUE,</span> <span class="pre">verbose=TRUE)</span></code> would segfault on the out-of-sample type bump verbose output if the input did not contain column names, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/5046">5046</a>. Thanks to Václav Tlapák for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.SDcols=-V2:-V1</span></code> and <code class="docutils literal notranslate"><span class="pre">.SDcols=(-1)</span></code> could error with <code class="docutils literal notranslate"><span class="pre">xcolAns</span> <span class="pre">does</span> <span class="pre">not</span> <span class="pre">pass</span> <span class="pre">checks</span></code> and <code class="docutils literal notranslate"><span class="pre">argument</span> <span class="pre">specifying</span> <span class="pre">columns</span> <span class="pre">specify</span> <span class="pre">non</span> <span class="pre">existing</span> <span class="pre">column(s)</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4231">#4231</a>. Thanks to Jan Gorecki for reporting and the PR. Thanks Toby Dylan Hocking for tracking down an error caused by the initial fix and Michael Chirico for fixing it.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.SDcols=&lt;logical</span> <span class="pre">vector&gt;</span></code> is now documented in <code class="docutils literal notranslate"><span class="pre">?data.table</span></code> and it is now an error if the logical vector’s length is not equal to the number of columns (consistent with <code class="docutils literal notranslate"><span class="pre">data.table</span></code>’s no-recycling policy; see new feature 1 in v1.12.2 Apr 2019), <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4115">#4115</a>. Thanks to &#64;Henrik-P for reporting and Jan Gorecki for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">melt()</span></code> now outputs scalar logical <code class="docutils literal notranslate"><span class="pre">NA</span></code> instead of <code class="docutils literal notranslate"><span class="pre">NULL</span></code> in rows corresponding to missing list columns, for consistency with non-list columns when using <code class="docutils literal notranslate"><span class="pre">na.rm=TRUE</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/5053">#5053</a>. Thanks to Toby Dylan Hocking for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.data.frame(DT)</span></code>, <code class="docutils literal notranslate"><span class="pre">setDF(DT)</span></code> and <code class="docutils literal notranslate"><span class="pre">as.list(DT)</span></code> now remove the <code class="docutils literal notranslate"><span class="pre">&quot;index&quot;</span></code> attribute which contains any indices (a.k.a. secondary keys), as they already did for other <code class="docutils literal notranslate"><span class="pre">data.table</span></code>-only attributes such as the primary key stored in the <code class="docutils literal notranslate"><span class="pre">&quot;sorted&quot;</span></code> attribute. When indices were left intact, a subsequent subset, assign, or reorder of the <code class="docutils literal notranslate"><span class="pre">data.frame</span></code> by <code class="docutils literal notranslate"><span class="pre">data.frame</span></code>-code in base R or other packages would not update the indices, causing incorrect results if then converted back to <code class="docutils literal notranslate"><span class="pre">data.table</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4889">#4889</a>. Thanks &#64;OfekShilon for the report and the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dplyr::arrange(DT)</span></code> uses <code class="docutils literal notranslate"><span class="pre">vctrs::vec_slice</span></code> which retains <code class="docutils literal notranslate"><span class="pre">data.table</span></code>’s class but uses C to bypass <code class="docutils literal notranslate"><span class="pre">[</span></code> method dispatch and does not adjust <code class="docutils literal notranslate"><span class="pre">data.table</span></code>’s attributes containing the index row numbers, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5042">#5042</a>. <code class="docutils literal notranslate"><span class="pre">data.table</span></code>’s long-standing <code class="docutils literal notranslate"><span class="pre">.internal.selfref</span></code> mechanism to detect such operations by other packages was not being checked by <code class="docutils literal notranslate"><span class="pre">data.table</span></code> when using indexes, causing <code class="docutils literal notranslate"><span class="pre">data.table</span></code> filters and joins to use invalid indexes and return incorrect results after a <code class="docutils literal notranslate"><span class="pre">dplyr::arrange(DT)</span></code>. Thanks to &#64;Waldi73 for reporting; &#64;avimallu, &#64;tlapak, &#64;MichaelChirico, &#64;jangorecki and &#64;hadley for investigating and suggestions; and &#64;mattdowle for the PR. The intended way to use <code class="docutils literal notranslate"><span class="pre">data.table</span></code> is <code class="docutils literal notranslate"><span class="pre">data.table::setkey(DT,</span> <span class="pre">col1,</span> <span class="pre">col2,</span> <span class="pre">...)</span></code> which reorders <code class="docutils literal notranslate"><span class="pre">DT</span></code> by reference in parallel, sets the primary key for automatic use by subsequent <code class="docutils literal notranslate"><span class="pre">data.table</span></code> queries, and permits rowname-like usage such as <code class="docutils literal notranslate"><span class="pre">DT[&quot;foo&quot;,]</span></code> which returns the now-contiguous-in-memory block of rows where the first column of <code class="docutils literal notranslate"><span class="pre">DT</span></code>’s key contains <code class="docutils literal notranslate"><span class="pre">&quot;foo&quot;</span></code>. Multi-column-rownames (i.e. a primary key of more than one column) can be looked up using <code class="docutils literal notranslate"><span class="pre">DT[.(&quot;foo&quot;,20210728L),</span> <span class="pre">]</span></code>. Using <code class="docutils literal notranslate"><span class="pre">==</span></code> in <code class="docutils literal notranslate"><span class="pre">i</span></code> is also optimized to use the key or indices, if you prefer using column names explicitly and <code class="docutils literal notranslate"><span class="pre">==</span></code>. An alternative to <code class="docutils literal notranslate"><span class="pre">setkey(DT)</span></code> is returning a new ordered result using <code class="docutils literal notranslate"><span class="pre">DT[order(col1,</span> <span class="pre">col2,</span> <span class="pre">...),</span> <span class="pre">]</span></code>.</p></li>
<li><p>A segfault occurred when <code class="docutils literal notranslate"><span class="pre">nrow/throttle</span> <span class="pre">&lt;</span> <span class="pre">nthread</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5077">#5077</a>. With the default throttle of 1024 rows (see <code class="docutils literal notranslate"><span class="pre">?setDTthreads</span></code>), at least 64 threads would be needed to trigger the segfault since there needed to be more than 65,535 rows too. It occurred on a server with 256 logical cores where <code class="docutils literal notranslate"><span class="pre">data.table</span></code> uses 128 threads by default. Thanks to Bennet Becker for reporting, debugging at C level, and fixing. It also occurred when the throttle was increased so as to use fewer threads; e.g. at the limit <code class="docutils literal notranslate"><span class="pre">setDTthreads(throttle=nrow(DT))</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread(file=URL)</span></code> now works rather than error <code class="docutils literal notranslate"><span class="pre">does</span> <span class="pre">not</span> <span class="pre">exist</span> <span class="pre">or</span> <span class="pre">is</span> <span class="pre">non-readable</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4952">#4952</a>. <code class="docutils literal notranslate"><span class="pre">fread(URL)</span></code> and <code class="docutils literal notranslate"><span class="pre">fread(input=URL)</span></code> worked before and continue to work. Thanks to &#64;pnacht for reporting and &#64;ben-schwen for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fwrite(DF,</span> <span class="pre">row.names=TRUE)</span></code> where <code class="docutils literal notranslate"><span class="pre">DF</span></code> has specific integer rownames (e.g. using <code class="docutils literal notranslate"><span class="pre">rownames(DF)</span> <span class="pre">&lt;-</span> <span class="pre">c(10L,20L,30L)</span></code>) would ignore the integer rownames and write the row numbers instead, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4957">#4957</a>. Thanks to &#64;dgarrimar for reporting and &#64;ColeMiller1 for the PR. Further, when <code class="docutils literal notranslate"><span class="pre">quote='auto'</span></code> (default) and the rownames are integers (either default or specific), they are no longer quoted.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test.data.table()</span></code> would fail on test 1894 if the variable <code class="docutils literal notranslate"><span class="pre">z</span></code> was defined by the user, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/3705">#3705</a>. The test suite already ran in its own separate environment. That environment’s parent is no longer <code class="docutils literal notranslate"><span class="pre">.GlobalEnv</span></code> to isolate it further. Thanks to Michael Chirico for reporting, and Matt Dowle for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread(text=&quot;a,b,c&quot;)</span></code> (where input data contains no <code class="docutils literal notranslate"><span class="pre">\n</span></code> but <code class="docutils literal notranslate"><span class="pre">text=</span></code> has been used) now works instead of error <code class="docutils literal notranslate"><span class="pre">file</span> <span class="pre">not</span> <span class="pre">found:</span> <span class="pre">a,b,c</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4689">#4689</a>. Thanks to &#64;trainormg for reporting, and &#64;ben-schwen for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">na.omit(DT)</span></code> did not remove <code class="docutils literal notranslate"><span class="pre">NA</span></code> in <code class="docutils literal notranslate"><span class="pre">nanotime</span></code> columns, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4744">#4744</a>. Thanks Jean-Mathieu Vermosen for reporting, and Michael Chirico for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">min(intCol,</span> <span class="pre">na.rm=TRUE),</span> <span class="pre">by=grp]</span></code> would return <code class="docutils literal notranslate"><span class="pre">Inf</span></code> for any groups containing all NAs, with a type change from <code class="docutils literal notranslate"><span class="pre">integer</span></code> to <code class="docutils literal notranslate"><span class="pre">numeric</span></code> to hold the <code class="docutils literal notranslate"><span class="pre">Inf</span></code>, and with warning. Similarly <code class="docutils literal notranslate"><span class="pre">max</span></code> would return <code class="docutils literal notranslate"><span class="pre">-Inf</span></code>. Now <code class="docutils literal notranslate"><span class="pre">NA</span></code> is returned for such all-NA groups, without warning or type change. This is almost-surely less surprising, more convenient, consistent, and efficient. There was no user request for this, likely because our desire to be consistent with base R in this regard was known (<code class="docutils literal notranslate"><span class="pre">base::min(x,</span> <span class="pre">na.rm=TRUE)</span></code> returns <code class="docutils literal notranslate"><span class="pre">Inf</span></code> with warning for all-NA input). Matt Dowle made this change when reworking internals, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/5105">#5105</a>. The old behavior seemed so bad, and since there was a warning too, it seemed appropriate to treat it as a bug.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span>
<span class="c1">#         A     B</span>
<span class="c1">#    &lt;char&gt; &lt;int&gt;</span>
<span class="c1"># 1:      a     1</span>
<span class="c1"># 2:      a    NA</span>
<span class="c1"># 3:      b     2</span>
<span class="c1"># 4:      b    NA</span>

<span class="n">DT</span><span class="p">[,</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="n">A</span><span class="p">]</span><span class="w">  </span><span class="c1"># no change in behavior (no all-NA groups yet)</span>
<span class="c1">#         A    V1</span>
<span class="c1">#    &lt;char&gt; &lt;int&gt;</span>
<span class="c1"># 1:      a     1</span>
<span class="c1"># 2:      b     2</span>

<span class="n">DT</span><span class="p">[</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="o">:=</span><span class="kc">NA</span><span class="p">]</span><span class="w">                   </span><span class="c1"># make an all-NA group</span>
<span class="n">DT</span>
<span class="c1">#         A     B</span>
<span class="c1">#    &lt;char&gt; &lt;int&gt;</span>
<span class="c1"># 1:      a     1</span>
<span class="c1"># 2:      a    NA</span>
<span class="c1"># 3:      b    NA</span>
<span class="c1"># 4:      b    NA</span>

<span class="n">DT</span><span class="p">[,</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="n">A</span><span class="p">]</span><span class="w">  </span><span class="c1"># old result</span>
<span class="c1">#         A    V1</span>
<span class="c1">#    &lt;char&gt; &lt;num&gt;              # V1&#39;s type changed to numeric (inconsistent)</span>
<span class="c1"># 1:      a     1</span>
<span class="c1"># 2:      b   Inf              # Inf surprising</span>
<span class="c1"># Warning message:             # warning inconvenient</span>
<span class="c1"># In gmin(B, na.rm = TRUE) :</span>
<span class="c1">#   No non-missing values found in at least one group. Coercing to numeric</span>
<span class="c1">#   type and returning &#39;Inf&#39; for such groups to be consistent with base</span>

<span class="n">DT</span><span class="p">[,</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="n">A</span><span class="p">]</span><span class="w">  </span><span class="c1"># new result</span>
<span class="c1">#         A    V1</span>
<span class="c1">#    &lt;char&gt; &lt;int&gt;              # V1&#39;s type remains integer (consistent)</span>
<span class="c1"># 1:      a     1</span>
<span class="c1"># 2:      b    NA              # NA because there are no non-NA, naturally</span>
<span class="w">                               </span><span class="c1"># no inconvenient warning</span>
</pre></div>
</div>
<p>On the same basis, <code class="docutils literal notranslate"><span class="pre">min</span></code> and <code class="docutils literal notranslate"><span class="pre">max</span></code> methods for empty <code class="docutils literal notranslate"><span class="pre">IDate</span></code> input now return <code class="docutils literal notranslate"><span class="pre">NA_integer_</span></code> of class <code class="docutils literal notranslate"><span class="pre">IDate</span></code>, rather than <code class="docutils literal notranslate"><span class="pre">NA_double_</span></code> of class <code class="docutils literal notranslate"><span class="pre">IDate</span></code> together with base R’s warning <code class="docutils literal notranslate"><span class="pre">no</span> <span class="pre">non-missing</span> <span class="pre">arguments</span> <span class="pre">to</span> <span class="pre">min;</span> <span class="pre">returning</span> <span class="pre">Inf</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2256">#2256</a>. The type change and warning would cause an error in grouping, see example below. Since <code class="docutils literal notranslate"><span class="pre">NA</span></code> was returned before it seems clear that still returning <code class="docutils literal notranslate"><span class="pre">NA</span></code> but of the correct type and with no warning is appropriate, backwards compatible, and a bug fix. Thanks to Frank Narf for reporting, and Matt Dowle for fixing.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span>
<span class="c1">#             d      g</span>
<span class="c1">#        &lt;IDat&gt; &lt;char&gt;</span>
<span class="c1"># 1: 2020-01-01      a</span>
<span class="c1"># 2: 2020-01-02      a</span>
<span class="c1"># 3: 2019-12-31      b</span>

<span class="n">DT</span><span class="p">[,</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">d</span><span class="o">&gt;</span><span class="s">&quot;2020-01-01&quot;</span><span class="p">]),</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="n">g</span><span class="p">]</span>

<span class="c1"># was:</span>

<span class="c1"># Error in `[.data.table`(DT, , min(d[d &gt; &quot;2020-01-01&quot;]), by = g) :</span>
<span class="c1">#   Column 1 of result for group 2 is type &#39;double&#39; but expecting type</span>
<span class="c1">#   &#39;integer&#39;. Column types must be consistent for each group.</span>
<span class="c1"># In addition: Warning message:</span>
<span class="c1"># In min.default(integer(0), na.rm = FALSE) :</span>
<span class="c1">#   no non-missing arguments to min; returning Inf</span>

<span class="c1"># now :</span>

<span class="c1">#         g         V1</span>
<span class="c1">#    &lt;char&gt;     &lt;IDat&gt;</span>
<span class="c1"># 1:      a 2020-01-02</span>
<span class="c1"># 2:      b       &lt;NA&gt;</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">min(int64Col),</span> <span class="pre">by=grp]</span></code> (and <code class="docutils literal notranslate"><span class="pre">max</span></code>) would return incorrect results for <code class="docutils literal notranslate"><span class="pre">bit64::integer64</span></code> columns, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4444">#4444</a>. Thanks to &#64;go-see for reporting, and Michael Chirico for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread(dec=',')</span></code> was able to guess <code class="docutils literal notranslate"><span class="pre">sep=','</span></code> and return an incorrect result, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4483">#4483</a>. Thanks to Michael Chirico for reporting and fixing. It was already an error to provide both <code class="docutils literal notranslate"><span class="pre">sep=','</span></code> and <code class="docutils literal notranslate"><span class="pre">dec=','</span></code> manually.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">fread</span><span class="p">(</span><span class="s">&#39;A|B|C\n1|0,4|a\n2|0,5|b\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">dec</span><span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">)</span><span class="w">  </span><span class="c1"># no problem</span>

<span class="c1">#        A     B      C</span>
<span class="c1">#    &lt;int&gt; &lt;num&gt; &lt;char&gt;</span>
<span class="c1"># 1:     1   0.4      a</span>
<span class="c1"># 2:     2   0.5      b</span>

<span class="nf">fread</span><span class="p">(</span><span class="s">&#39;A|B,C\n1|0,4\n2|0,5\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">dec</span><span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">)</span>

<span class="c1">#       A|B     C    # old result guessed sep=&#39;,&#39; despite dec=&#39;,&#39;</span>
<span class="c1">#    &lt;char&gt; &lt;int&gt;</span>
<span class="c1"># 1:    1|0     4</span>
<span class="c1"># 2:    2|0     5</span>

<span class="c1">#        A   B,C     # now detects sep=&#39;|&#39; correctly</span>
<span class="c1">#    &lt;int&gt; &lt;num&gt;</span>
<span class="c1"># 1:     1   0.4</span>
<span class="c1"># 2:     2   0.5</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">IDateTime()</span></code> ignored the <code class="docutils literal notranslate"><span class="pre">tz=</span></code> and <code class="docutils literal notranslate"><span class="pre">format=</span></code> arguments because <code class="docutils literal notranslate"><span class="pre">...</span></code> was not passed through to submethods, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/2402">#2402</a>. Thanks to Frank Narf for reporting, and Jens Peder Meldgaard for the PR.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IDateTime</span><span class="p">(</span><span class="s2">&quot;20171002095500&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>

<span class="c1"># was :</span>
<span class="c1"># Error in charToDate(x) :</span>
<span class="c1">#   character string is not in a standard unambiguous format</span>

<span class="c1"># now :</span>
<span class="c1">#         idate    itime</span>
<span class="c1">#        &lt;IDat&gt;  &lt;ITime&gt;</span>
<span class="c1"># 1: 2017-10-02 09:55:00</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[i,</span> <span class="pre">sum(b),</span> <span class="pre">by=grp]</span></code> (and other optimized-by-group aggregates: <code class="docutils literal notranslate"><span class="pre">mean</span></code>, <code class="docutils literal notranslate"><span class="pre">var</span></code>, <code class="docutils literal notranslate"><span class="pre">sd</span></code>, <code class="docutils literal notranslate"><span class="pre">median</span></code>, <code class="docutils literal notranslate"><span class="pre">prod</span></code>, <code class="docutils literal notranslate"><span class="pre">min</span></code>, <code class="docutils literal notranslate"><span class="pre">max</span></code>, <code class="docutils literal notranslate"><span class="pre">first</span></code>, <code class="docutils literal notranslate"><span class="pre">last</span></code>, <code class="docutils literal notranslate"><span class="pre">head</span></code> and <code class="docutils literal notranslate"><span class="pre">tail</span></code>) could segfault if <code class="docutils literal notranslate"><span class="pre">i</span></code> contained row numbers and one or more were NA, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1994">#1994</a>. Thanks to Arun Srinivasan for reporting, and Benjamin Schwendinger for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">identical(fread(text=&quot;A\n0.8060667366\n&quot;)$A,</span> <span class="pre">0.8060667366)</span></code> is now TRUE, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4461">#4461</a>. This is one of 13 numbers in the set of 100,000 between 0.80606 and 0.80607 in 0.0000000001 increments that were not already identical. In all 13 cases R’s parser (same as <code class="docutils literal notranslate"><span class="pre">read.table</span></code>) and <code class="docutils literal notranslate"><span class="pre">fread</span></code> straddled the true value by a very similar small amount. <code class="docutils literal notranslate"><span class="pre">fread</span></code> now uses <code class="docutils literal notranslate"><span class="pre">/10^n</span></code> rather than <code class="docutils literal notranslate"><span class="pre">*10^-n</span></code> to match R identically in all cases. Thanks to Gabe Becker for requesting consistency, and Michael Chirico for the PR.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="kr">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="m">0</span><span class="o">:</span><span class="m">99999</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;0.80606%05d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span>
<span class="w">  </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">eval</span><span class="p">(</span><span class="nf">parse</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">s</span><span class="p">))</span>
<span class="w">  </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">fread</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nf">paste0</span><span class="p">(</span><span class="s">&quot;A\n&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="s">&quot;\n&quot;</span><span class="p">))</span><span class="o">$</span><span class="n">A</span>
<span class="w">  </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nf">identical</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">))</span>
<span class="w">    </span><span class="nf">cat</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%1.18f&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">)),</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">#        input    eval &amp; read.table         fread before            fread now</span>
<span class="c1"># 0.8060603509 0.806060350899999944 0.806060350900000055 0.806060350899999944</span>
<span class="c1"># 0.8060614740 0.806061473999999945 0.806061474000000056 0.806061473999999945</span>
<span class="c1"># 0.8060623757 0.806062375699999945 0.806062375700000056 0.806062375699999945</span>
<span class="c1"># 0.8060629084 0.806062908399999944 0.806062908400000055 0.806062908399999944</span>
<span class="c1"># 0.8060632774 0.806063277399999945 0.806063277400000056 0.806063277399999945</span>
<span class="c1"># 0.8060638101 0.806063810099999944 0.806063810100000055 0.806063810099999944</span>
<span class="c1"># 0.8060647118 0.806064711799999944 0.806064711800000055 0.806064711799999944</span>
<span class="c1"># 0.8060658349 0.806065834899999945 0.806065834900000056 0.806065834899999945</span>
<span class="c1"># 0.8060667366 0.806066736599999945 0.806066736600000056 0.806066736599999945</span>
<span class="c1"># 0.8060672693 0.806067269299999944 0.806067269300000055 0.806067269299999944</span>
<span class="c1"># 0.8060676383 0.806067638299999945 0.806067638300000056 0.806067638299999945</span>
<span class="c1"># 0.8060681710 0.806068170999999944 0.806068171000000055 0.806068170999999944</span>
<span class="c1"># 0.8060690727 0.806069072699999944 0.806069072700000055 0.806069072699999944</span>
<span class="c1">#</span>
<span class="c1"># remaining 99,987 of these 100,000 were already identical</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">dcast(empty-DT)</span></code> now returns an empty <code class="docutils literal notranslate"><span class="pre">data.table</span></code> rather than error <code class="docutils literal notranslate"><span class="pre">Cannot</span> <span class="pre">cast</span> <span class="pre">an</span> <span class="pre">empty</span> <span class="pre">data.table</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1215">#1215</a>. Thanks to Damian Betebenner for reporting, and Matt Dowle for fixing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[factor(&quot;id&quot;)]</span></code> now works rather than error <code class="docutils literal notranslate"><span class="pre">i</span> <span class="pre">has</span> <span class="pre">evaluated</span> <span class="pre">to</span> <span class="pre">type</span> <span class="pre">integer.</span> <span class="pre">Expecting</span> <span class="pre">logical,</span> <span class="pre">integer</span> <span class="pre">or</span> <span class="pre">double</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1632">#1632</a>. <code class="docutils literal notranslate"><span class="pre">DT[&quot;id&quot;]</span></code> has worked forever by automatically converting to <code class="docutils literal notranslate"><span class="pre">DT[.(&quot;id&quot;)]</span></code> for convenience, and joins have worked forever between char/fact, fact/char and fact/fact even when levels mismatch, so it was unfortunate that <code class="docutils literal notranslate"><span class="pre">DT[factor(&quot;id&quot;)]</span></code> managed to escape the simple automatic conversion to <code class="docutils literal notranslate"><span class="pre">DT[.(factor(&quot;id&quot;))]</span></code> which is now in place. Thanks to &#64;aushev for reporting, and Matt Dowle for the fix.</p></li>
<li><p>All-NA character key columns could segfault, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5070">#5070</a>. Thanks to &#64;JorisChau for reporting and Benjamin Schwendinger for the fix.</p></li>
<li><p>In v1.13.2 a version of an old bug was reintroduced where during a grouping operation list columns could retain a pointer to the last group. This affected only attributes of list elements and only if those were updated during the grouping operation, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4963">#4963</a>. Thanks to &#64;fujiaxiang for reporting and &#64;avimallu and Václav Tlapák for investigating and the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shift(xInt64,</span> <span class="pre">fill=0)</span></code> and <code class="docutils literal notranslate"><span class="pre">shift(xInt64,</span> <span class="pre">fill=as.integer64(0))</span></code> (but not <code class="docutils literal notranslate"><span class="pre">shift(xInt64,</span> <span class="pre">fill=0L)</span></code>) would error with <code class="docutils literal notranslate"><span class="pre">INTEGER()</span> <span class="pre">can</span> <span class="pre">only</span> <span class="pre">be</span> <span class="pre">applied</span> <span class="pre">to</span> <span class="pre">a</span> <span class="pre">'integer',</span> <span class="pre">not</span> <span class="pre">a</span> <span class="pre">'double'</span></code> where <code class="docutils literal notranslate"><span class="pre">xInt64</span></code> conveys <code class="docutils literal notranslate"><span class="pre">bit64::integer64</span></code>, <code class="docutils literal notranslate"><span class="pre">0</span></code> is type <code class="docutils literal notranslate"><span class="pre">double</span></code> and <code class="docutils literal notranslate"><span class="pre">0L</span></code> is type integer, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4865">#4865</a>. Thanks to &#64;peterlittlejohn for reporting and Benjamin Schwendinger for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[i,</span> <span class="pre">strCol:=classVal]</span></code> did not coerce using the <code class="docutils literal notranslate"><span class="pre">as.character</span></code> method for the class, resulting in either an unexpected string value or an error such as <code class="docutils literal notranslate"><span class="pre">To</span> <span class="pre">assign</span> <span class="pre">integer64</span> <span class="pre">to</span> <span class="pre">a</span> <span class="pre">target</span> <span class="pre">of</span> <span class="pre">type</span> <span class="pre">character,</span> <span class="pre">please</span> <span class="pre">use</span> <span class="pre">as.character()</span> <span class="pre">for</span> <span class="pre">clarity</span></code>. Discovered during work on the previous issue, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/5189">#5189</a>.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span>
<span class="c1">#         A</span>
<span class="c1">#    &lt;char&gt;</span>
<span class="c1"># 1:      a</span>
<span class="c1"># 2:      b</span>
<span class="c1"># 3:      c</span>
<span class="n">DT</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">:=</span><span class="nf">as.IDate</span><span class="p">(</span><span class="s">&quot;2021-02-03&quot;</span><span class="p">)]</span>
<span class="n">DT</span><span class="p">[</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">:=</span><span class="n">bit64</span><span class="o">::</span><span class="nf">as.integer64</span><span class="p">(</span><span class="s">&quot;4611686018427387906&quot;</span><span class="p">)]</span>
<span class="n">DT</span>
<span class="c1">#                      A</span>
<span class="c1">#                 &lt;char&gt;</span>
<span class="c1"># 1:                   a</span>
<span class="c1"># 2:          2021-02-03  # was 18661</span>
<span class="c1"># 3: 4611686018427387906  # was error &#39;please use as.character&#39;</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">tables()</span></code> failed with <code class="docutils literal notranslate"><span class="pre">argument</span> <span class="pre">&quot;...&quot;</span> <span class="pre">is</span> <span class="pre">missing</span></code> when called from within a function taking <code class="docutils literal notranslate"><span class="pre">...</span></code>; e.g. <code class="docutils literal notranslate"><span class="pre">function(...)</span> <span class="pre">{</span> <span class="pre">tables()</span> <span class="pre">}</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5197">#5197</a>. Thanks &#64;greg-minshall for the report and &#64;michaelchirico for the fix.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">prod(int64Col),</span> <span class="pre">by=grp]</span></code> produced wrong results for <code class="docutils literal notranslate"><span class="pre">bit64::integer64</span></code> due to incorrect optimization, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5225">#5225</a>. Thanks to Benjamin Schwendinger for reporting and fixing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fintersect(...,</span> <span class="pre">all=TRUE)</span></code> and <code class="docutils literal notranslate"><span class="pre">fsetdiff(...,</span> <span class="pre">all=TRUE)</span></code> could return incorrect results when the inputs had columns named <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5255">#5255</a>. Thanks &#64;Fpadt for the report, and &#64;ben-schwen for the fix.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fwrite()</span></code> could produce not-ISO-compliant timestamps such as <code class="docutils literal notranslate"><span class="pre">2023-03-08T17:22:32.:00Z</span></code> when under a whole second by less than numerical tolerance of one microsecond, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5238">#5238</a>. Thanks to &#64;avraam-inside for the report and Václav Tlapák for the fix.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">merge.data.table()</span></code> silently ignored the <code class="docutils literal notranslate"><span class="pre">incomparables</span></code> argument, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2587">#2587</a>. It is now implemented and any other ignored arguments (e.g. misspellings) are now warned about. Thanks to &#64;GBsuperman for the report and &#64;ben-schwen for the fix.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">c('z','x')</span> <span class="pre">:=</span> <span class="pre">{x=NULL;</span> <span class="pre">list(2,NULL)}]</span></code> now removes column <code class="docutils literal notranslate"><span class="pre">x</span></code> as expected rather than incorrectly assigning <code class="docutils literal notranslate"><span class="pre">2</span></code> to <code class="docutils literal notranslate"><span class="pre">x</span></code> as well as <code class="docutils literal notranslate"><span class="pre">z</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5284">#5284</a>. The <code class="docutils literal notranslate"><span class="pre">x=NULL</span></code> is superfluous while the <code class="docutils literal notranslate"><span class="pre">list(2,NULL)</span></code> is the final value of <code class="docutils literal notranslate"><span class="pre">{}</span></code> whose items correspond to <code class="docutils literal notranslate"><span class="pre">c('z','x')</span></code>. Thanks &#64;eutwt for the report, and &#64;ben-schwen for the fix.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">as.data.frame(DT,</span> <span class="pre">row.names=)</span></code> no longer silently ignores <code class="docutils literal notranslate"><span class="pre">row.names</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5319">#5319</a>. Thanks to &#64;dereckdemezquita for the fix and PR, and &#64;ben-schwen for guidance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data.table(...)</span></code> unnamed arguments are deparsed in an attempt to name the columns but when called from <code class="docutils literal notranslate"><span class="pre">do.call()</span></code> the input data itself was deparsed taking a very long time, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/5501">#5501</a>. Many thanks to &#64;OfekShilon for the report and fix, and &#64;michaelchirico for guidance. Unnamed arguments to <code class="docutils literal notranslate"><span class="pre">data.table(...)</span></code> may now be faster in other cases not involving <code class="docutils literal notranslate"><span class="pre">do.call()</span></code> too; e.g. expressions spanning a lot of lines or other function call constructions that led to the data itself being deparsed.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">DF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="nf">runif</span><span class="p">(</span><span class="m">1e6</span><span class="p">),</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="nf">runif</span><span class="p">(</span><span class="m">1e6</span><span class="p">))</span>
<span class="n">DT1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">data.table</span><span class="p">(</span><span class="n">DF</span><span class="p">)</span><span class="w">                 </span><span class="c1"># 0.02s before and after</span>
<span class="n">DT2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">do.call</span><span class="p">(</span><span class="n">data.table</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">DF</span><span class="p">))</span><span class="w">  </span><span class="c1"># 3.07s before, 0.02s after</span>
<span class="nf">identical</span><span class="p">(</span><span class="n">DT1</span><span class="p">,</span><span class="w"> </span><span class="n">DT2</span><span class="p">)</span><span class="w">                  </span><span class="c1"># TRUE</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">fread(URL)</span></code> with <code class="docutils literal notranslate"><span class="pre">https:</span></code> and <code class="docutils literal notranslate"><span class="pre">ftps:</span></code> could timeout if proxy settings were not guessed right by <code class="docutils literal notranslate"><span class="pre">curl::curl_download</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1686">#1686</a>. <code class="docutils literal notranslate"><span class="pre">fread(URL)</span></code> now uses <code class="docutils literal notranslate"><span class="pre">download.file()</span></code> as default for downloading files from urls. Thanks to &#64;cderv for the report and Benjamin Schwendinger for the fix.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">split.data.table()</span></code> works for downstream methods that don’t implement <code class="docutils literal notranslate"><span class="pre">DT[i]</span></code> form (i.e., requiring <code class="docutils literal notranslate"><span class="pre">DT[i,</span> <span class="pre">j]</span></code> form, like plain <code class="docutils literal notranslate"><span class="pre">data.frame</span></code>s), for example <code class="docutils literal notranslate"><span class="pre">sf</span></code>’s <code class="docutils literal notranslate"><span class="pre">[.sf</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5365">#5365</a>. Thanks &#64;barryrowlingson for the report and &#64;michaelchirico for the fix.</p></li>
</ol>
</section>
<section id="id9">
<h2>NOTES<a class="headerlink" href="#id9" title="Link to this heading">#</a></h2>
<ol class="arabic">
<li><p>New feature 29 in v1.12.4 (Oct 2019) introduced zero-copy coercion. Our thinking is that requiring you to get the type right in the case of <code class="docutils literal notranslate"><span class="pre">0</span></code> (type double) vs <code class="docutils literal notranslate"><span class="pre">0L</span></code> (type integer) is too inconvenient for you the user. So such coercions happen in <code class="docutils literal notranslate"><span class="pre">data.table</span></code> automatically without warning. Thanks to zero-copy coercion there is no speed penalty, even when calling <code class="docutils literal notranslate"><span class="pre">set()</span></code> many times in a loop, so there’s no speed penalty to warn you about either. However, we believe that assigning a character value such as <code class="docutils literal notranslate"><span class="pre">&quot;2&quot;</span></code> into an integer column is more likely to be a user mistake that you would like to be warned about. The type difference (character vs integer) may be the only clue that you have selected the wrong column, or typed the wrong variable to be assigned to that column. For this reason we view character to numeric-like coercion differently and will warn about it. If it is correct, then the warning is intended to nudge you to wrap the RHS with <code class="docutils literal notranslate"><span class="pre">as.&lt;type&gt;()</span></code> so that it is clear to readers of your code that a coercion from character to that type is intended. For example :</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2L</span><span class="p">,</span><span class="kc">NA</span><span class="p">,</span><span class="m">4L</span><span class="p">,</span><span class="m">5L</span><span class="p">)</span>
<span class="nf">nafill</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">                 </span><span class="c1"># no warning; requiring 3L too inconvenient</span>
<span class="nf">nafill</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;3&quot;</span><span class="p">)</span><span class="w">               </span><span class="c1"># warns in case either x or &quot;3&quot; was a mistake</span>
<span class="nf">nafill</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="m">3.14</span><span class="p">)</span><span class="w">              </span><span class="c1"># warns that precision has been lost</span>
<span class="nf">nafill</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="nf">as.integer</span><span class="p">(</span><span class="m">3.14</span><span class="p">))</span><span class="w">  </span><span class="c1"># no warning; the as.&lt;type&gt; conveys intent</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">CsubsetDT</span></code> exported C function has been renamed to <code class="docutils literal notranslate"><span class="pre">DT_subsetDT</span></code>. This requires <code class="docutils literal notranslate"><span class="pre">R_GetCCallable(&quot;data.table&quot;,</span> <span class="pre">&quot;CsubsetDT&quot;)</span></code> to be updated to <code class="docutils literal notranslate"><span class="pre">R_GetCCallable(&quot;data.table&quot;,</span> <span class="pre">&quot;DT_subsetDT&quot;)</span></code>. Additionally there is now a dedicated header file for data.table C exports <code class="docutils literal notranslate"><span class="pre">include/datatableAPI.h</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4643">#4643</a>, thanks to &#64;eddelbuettel, which makes it easier to <em>import</em> data.table C functions.</p></li>
<li><p>In v1.12.4, fractional <code class="docutils literal notranslate"><span class="pre">fread(...,</span> <span class="pre">stringsAsFactors=)</span></code> was added. For example if <code class="docutils literal notranslate"><span class="pre">stringsAsFactors=0.2</span></code>, any character column with fewer than 20% unique strings would be cast as <code class="docutils literal notranslate"><span class="pre">factor</span></code>. This is now documented in <code class="docutils literal notranslate"><span class="pre">?fread</span></code> as well, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4706">#4706</a>. Thanks to &#64;markderry for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cube(DT,</span> <span class="pre">by=&quot;a&quot;)</span></code> now gives a more helpful error that <code class="docutils literal notranslate"><span class="pre">j</span></code> is missing, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/4282">#4282</a>.</p></li>
<li><p>v1.13.0 (July 2020) fixed a segfault/corruption/error (depending on version of R and circumstances) in <code class="docutils literal notranslate"><span class="pre">dcast()</span></code> when <code class="docutils literal notranslate"><span class="pre">fun.aggregate</span></code> returned <code class="docutils literal notranslate"><span class="pre">NA</span></code> (type <code class="docutils literal notranslate"><span class="pre">logical</span></code>) in an otherwise <code class="docutils literal notranslate"><span class="pre">character</span></code> result, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2394">#2394</a>. This fix was the result of other internal rework and there was no news item at the time. A new test to cover this case has now been added. Thanks Vadim Khotilovich for reporting, and Michael Chirico for investigating, pinpointing when the fix occurred and adding the test.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[subset]</span></code> where <code class="docutils literal notranslate"><span class="pre">DT[(subset)]</span></code> or <code class="docutils literal notranslate"><span class="pre">DT[subset==TRUE]</span></code> was intended; i.e., subsetting by a logical column whose name conflicts with an existing function, now gives a friendlier error message, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5014">#5014</a>. Thanks &#64;michaelchirico for the suggestion and PR, and &#64;ColeMiller1 for helping with the fix.</p></li>
<li><p>Grouping by a <code class="docutils literal notranslate"><span class="pre">list</span></code> column has its error message improved stating this is unsupported, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4308">#4308</a>. Thanks &#64;sindribaldur for filing, and &#64;michaelchirico for the PR. Please add your vote and especially use cases to the <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/1597">#1597</a> feature request.</p></li>
<li><p>OpenBSD 6.9 released May 2021 uses a 16 year old version of zlib (v1.2.3 from 2005) plus cherry-picked bug fixes (i.e. a semi-fork of zlib) which induces <code class="docutils literal notranslate"><span class="pre">Compress</span> <span class="pre">gzip</span> <span class="pre">error:</span> <span class="pre">-9</span></code> from <code class="docutils literal notranslate"><span class="pre">fwrite()</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5048">#5048</a>. Thanks to Philippe Chataignon for investigating and fixing. Matt asked on OpenBSD’s mailing list if zlib could be upgraded to 4 year old zlib 1.2.11 but forgot his tin hat: <a class="reference external" href="https://marc.info/?l=openbsd-misc&amp;amp;m=162455479311886&amp;amp;w=1">https://marc.info/?l=openbsd-misc&amp;m=162455479311886&amp;w=1</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">?&quot;.&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">?&quot;..&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">?&quot;.(&quot;</span></code>, and <code class="docutils literal notranslate"><span class="pre">?&quot;.()&quot;</span></code> now point to <code class="docutils literal notranslate"><span class="pre">?data.table</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4385">#4385</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4407">#4407</a>. To help users find the documentation for these convenience features available inside <code class="docutils literal notranslate"><span class="pre">DT[...]</span></code>. Recall that <code class="docutils literal notranslate"><span class="pre">.</span></code> is an alias for <code class="docutils literal notranslate"><span class="pre">list</span></code>, and <code class="docutils literal notranslate"><span class="pre">..var</span></code> tells <code class="docutils literal notranslate"><span class="pre">data.table</span></code> to look for <code class="docutils literal notranslate"><span class="pre">var</span></code> in the calling environment as opposed to a column of the table.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">lhs:=rhs]</span></code> and <code class="docutils literal notranslate"><span class="pre">set(DT,</span> <span class="pre">,</span> <span class="pre">lhs,</span> <span class="pre">rhs)</span></code> no longer raise a warning on zero length <code class="docutils literal notranslate"><span class="pre">lhs</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/4086">#4086</a>. Thanks to Jan Gorecki for the suggestion and PR. For example, <code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">grep(&quot;foo&quot;,</span> <span class="pre">names(dt))</span> <span class="pre">:=</span> <span class="pre">NULL]</span></code> no longer warns if there are no column names containing <code class="docutils literal notranslate"><span class="pre">&quot;foo&quot;</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">melt()</span></code>’s internal C code is now more memory efficient, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/5054">#5054</a>. Thanks to Toby Dylan Hocking for the PR.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">?merge</span></code> and <code class="docutils literal notranslate"><span class="pre">?setkey</span></code> have been updated to clarify that the row order is retained when <code class="docutils literal notranslate"><span class="pre">sort=FALSE</span></code>, and why <code class="docutils literal notranslate"><span class="pre">NA</span></code>s are always first when <code class="docutils literal notranslate"><span class="pre">sort=TRUE</span></code>, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2574">#2574</a> <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/2594">#2594</a>. Thanks to Davor Josipovic and Markus Bonsch for the reports, and Jan Gorecki for the PR.</p></li>
<li><p>For nearly two years, since v1.12.4 (Oct 2019) (note 11 below in this NEWS file), using <code class="docutils literal notranslate"><span class="pre">options(datatable.nomatch=0)</span></code> has produced the following message :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>The option &#39;datatable.nomatch&#39; is being used and is not set to the default NA. This option
is still honored for now but will be deprecated in future. Please see NEWS for 1.12.4 for
detailed information and motivation. To specify inner join, please specify `nomatch=NULL`
explicitly in your calls rather than changing the default using this option.
</pre></div>
</div>
<p>The message is now upgraded to warning that the option is now ignored.</p>
</li>
<li><p>The options <code class="docutils literal notranslate"><span class="pre">datatable.print.class</span></code> and <code class="docutils literal notranslate"><span class="pre">datatable.print.keys</span></code> are now <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> by default. They have been available since v1.9.8 (Nov 2016) and v1.11.0 (May 2018) respectively.</p></li>
<li><p>Thanks to &#64;ssh352, Václav Tlapák, Cole Miller, András Svraka and Toby Dylan Hocking for reporting and bisecting a significant performance regression in dev. This was fixed before release thanks to a PR by Jan Gorecki, <a class="reference external" href="https://github.com/Rdatatable/data.table/pull/5463">#5463</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key(x)</span> <span class="pre">&lt;-</span> <span class="pre">value</span></code> is now fully deprecated (from warning to error). Use <code class="docutils literal notranslate"><span class="pre">setkey()</span></code> to set a table’s key. We started warning not to use this approach in 2012, with a stronger warning starting in 2019 (1.12.2). This function will be removed in the next release.</p></li>
<li><p>Argument <code class="docutils literal notranslate"><span class="pre">logicalAsInt</span></code> to <code class="docutils literal notranslate"><span class="pre">fwrite()</span></code> now warns. Use <code class="docutils literal notranslate"><span class="pre">logical01</span></code> instead. We stated the intention to begin removing this option in 2018 (v1.11.0). It will be upgraded to an error in the next release before being removed in the subsequent release.</p></li>
<li><p>Option <code class="docutils literal notranslate"><span class="pre">datatable.CJ.names</span></code> no longer has any effect, after becoming <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> by default in v1.12.2 (2019). Setting it now gives a warning, which will be dropped in the next release.</p></li>
<li><p>In the NEWS for v1.11.0 (May 2018), section “NOTICE OF INTENDED FUTURE POTENTIAL BREAKING CHANGES” item 2, we stated the intention to eventually change <code class="docutils literal notranslate"><span class="pre">logical01</span></code> to be <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> by default. After some consideration, reflection, and community input, we have decided not to move forward with this plan, i.e., <code class="docutils literal notranslate"><span class="pre">logical01</span></code> will remain <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> by default in both <code class="docutils literal notranslate"><span class="pre">fread()</span></code> and <code class="docutils literal notranslate"><span class="pre">fwrite()</span></code>. See discussion in #5856; most importantly, we think changing the default would be a major disruption to reading “sharded” CSVs where data with the same schema is split into many files, some of which could be converted to <code class="docutils literal notranslate"><span class="pre">logical</span></code> while others remain <code class="docutils literal notranslate"><span class="pre">integer</span></code>. We will retain the option <code class="docutils literal notranslate"><span class="pre">datatable.logical01</span></code> for users who wish to use a different default – for example, if you are doing input/output on tables with a large number of logical columns, where writing ‘0’/’1’ to the CSV many millions of times is preferable to writing ‘TRUE’/’FALSE’.</p></li>
<li><p>Some clarity is added to <code class="docutils literal notranslate"><span class="pre">?GForce</span></code> for the case when subtle changes to <code class="docutils literal notranslate"><span class="pre">j</span></code> produce different results because of differences in locale. Because <code class="docutils literal notranslate"><span class="pre">data.table</span></code> <em>always</em> uses the “C” locale, small changes to queries which activate/deactivate GForce might cause confusingly different results when sorting is involved, <a class="reference external" href="https://github.com/Rdatatable/data.table/issues/5331">#5331</a>. The inspirational example compared <code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">.(max(a),</span> <span class="pre">max(b)),</span> <span class="pre">by=grp]</span></code> and <code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">.(max(a),</span> <span class="pre">max(tolower(b))),</span> <span class="pre">by=grp]</span></code> – in the latter case, GForce is deactivated owing to the <em>ad-hoc</em> column, so the result for <code class="docutils literal notranslate"><span class="pre">max(a)</span></code> might differ for the two queries. An example is added to <code class="docutils literal notranslate"><span class="pre">?GForce</span></code>. As always, there are several options to guarantee consistency, for example (1) use namespace qualification to deactivate GForce: <code class="docutils literal notranslate"><span class="pre">DT[,</span> <span class="pre">.(base::max(a),</span> <span class="pre">base::max(b)),</span> <span class="pre">by=grp]</span></code>; (2) turn off all optimizations with <code class="docutils literal notranslate"><span class="pre">options(datatable.optimize</span> <span class="pre">=</span> <span class="pre">0)</span></code>; or (3) set your R session to always sort in C locale with <code class="docutils literal notranslate"><span class="pre">Sys.setlocale(&quot;LC_COLLATE&quot;,</span> <span class="pre">&quot;C&quot;)</span></code> (or temporarily with e.g. <code class="docutils literal notranslate"><span class="pre">withr::with_locale()</span></code>). Thanks &#64;markseeto for the example and &#64;michaelchirico for the improved documentation.</p></li>
</ol>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="data-table-v1-14-10-dec-2023-back-to-v1-10-0-dec-2016-has-been-moved-to-news-1-md">
<h1>data.table v1.14.10 (Dec 2023) back to v1.10.0 (Dec 2016) has been moved to <a class="reference external" href="https://github.com/Rdatatable/data.table/blob/master/NEWS.1.md">NEWS.1.md</a><a class="headerlink" href="#data-table-v1-14-10-dec-2023-back-to-v1-10-0-dec-2016-has-been-moved-to-news-1-md" title="Link to this heading">#</a></h1>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./renv\library\windows\R-4.4\x86_64-w64-mingw32\data.table"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">data.table v1.16.4 4 December 2024</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bug-fixes">BUG FIXES</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-table-v1-16-2-9-october-2024">data.table v1.16.2 (9 October 2024)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">BUG FIXES</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#notes">NOTES</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-table-v1-16-0-25-august-2024">data.table v1.16.0  (25 August 2024)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#breaking-changes">BREAKING CHANGES</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#new-features">NEW FEATURES</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">BUG FIXES</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">NOTES</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#translations">TRANSLATIONS</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-table-v1-15-4-27-march-2024">data.table v1.15.4 (27 March 2024)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">BUG FIXES</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">NOTES</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-table-v1-15-2-27-feb-2024">data.table v1.15.2 (27 Feb 2024)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">BUG FIXES</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-table-v1-15-0-30-jan-2024">data.table v1.15.0  (30 Jan 2024)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#breaking-change">BREAKING CHANGE</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">NEW FEATURES</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">BUG FIXES</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">NOTES</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#data-table-v1-14-10-dec-2023-back-to-v1-10-0-dec-2016-has-been-moved-to-news-1-md">data.table v1.14.10 (Dec 2023) back to v1.10.0 (Dec 2016) has been moved to NEWS.1.md</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Brittany Cummings
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>